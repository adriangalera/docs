"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6676],{4569:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Machines/Linux/easy/Artificial","title":"Enumeration","description":"A simple nmap scan reveals interesting stuff:","source":"@site/docs/Hacking/Write-ups/Hack the box/Machines/Linux/easy/Artificial.md","sourceDirName":"Hacking/Write-ups/Hack the box/Machines/Linux/easy","slug":"/write-up/htb/machines/easy/artificial","permalink":"/docs/write-up/htb/machines/easy/artificial","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/machines/easy/artificial","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var r=n(4848),a=n(8453);const o={slug:"/write-up/htb/machines/easy/artificial",pagination_next:null,pagination_prev:null},i="Enumeration",c={},l=[];function h(e){const t={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"enumeration",children:"Enumeration"})}),"\n",(0,r.jsx)(t.p,{children:"A simple nmap scan reveals interesting stuff:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"\u2514\u2500$ nmap 10.10.11.74                          \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-29 11:16 CEST\nNmap scan report for 10.10.11.74\nHost is up (0.035s latency).\nNot shown: 997 closed tcp ports (reset)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n8000/tcp open  http-alt\n\nNmap done: 1 IP address (1 host up) scanned in 0.88 seconds\n"})}),"\n",(0,r.jsxs)(t.p,{children:["In port 80 is a nginx server redirecting to ",(0,r.jsx)(t.a,{href:"http://artificial.htb",children:"http://artificial.htb"})]}),"\n",(0,r.jsxs)(t.p,{children:["In port 8000 is a python ",(0,r.jsx)(t.code,{children:"SimpleHTTP"})," server:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"0000: Server: SimpleHTTP/0.6 Python/3.8.10\n"})}),"\n",(0,r.jsx)(t.p,{children:"It's displaying the directory contents of some python application"}),"\n",(0,r.jsxs)(t.p,{children:["Exploring the nginx server, we come up with a login page: ",(0,r.jsx)(t.a,{href:"http://artificial.htb/register",children:"http://artificial.htb/register"})," we can try to explore SQL injections and so on."]}),"\n",(0,r.jsx)(t.p,{children:"We can register a user and login to see a form that allows to upload an AI model in h5 (????) format"}),"\n",(0,r.jsx)(t.h1,{id:"foothold",children:"Foothold"}),"\n",(0,r.jsx)(t.p,{children:"In the 8000 we can see the app source code and the database. We can explore the database to see if we see something interesting."}),"\n",(0,r.jsxs)(t.p,{children:["Looks like there are user/password stored hashed only with md5 (and no salt), we can try to do a rainbow tables attack to reveal the passwords. Maybe one of the passwords of the ",(0,r.jsx)(t.a,{href:"mailto:xx@artificial.htb",children:"xx@artificial.htb"})," users will grant us access via ssh to the machine:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"hashcat --show -m 0 -a 0 hashes.txt rockyou.txt\n"})}),"\n",(0,r.jsxs)(t.p,{children:["We got lucky and got two user/password from artificial.htb, let's try SSH. Bingo! User ",(0,r.jsx)(t.code,{children:"gael"})," give us access to the user flag."]}),"\n",(0,r.jsx)(t.h1,{id:"lateral-movement",children:"Lateral movement"}),"\n",(0,r.jsx)(t.p,{children:"Now, we have a user to try to escalate privileges."}),"\n",(0,r.jsxs)(t.p,{children:["Running ",(0,r.jsx)(t.code,{children:"ps aux"})," shows some weird usage of ",(0,r.jsx)(t.code,{children:"xxd"})," command. Nothing important, looks like it's something related with the internal usage of DNS."]}),"\n",(0,r.jsx)(t.p,{children:"Checking what's listening in the server, we got some weird service ports:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN     \ntcp        0      0 127.0.0.1:5000          0.0.0.0:*               LISTEN     \ntcp        0      0 127.0.0.1:9898          0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN     \ntcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN    \n"})}),"\n",(0,r.jsx)(t.p,{children:"WTF is listening in 5000 and 9898?"}),"\n",(0,r.jsx)(t.p,{children:"In 5000 it's the application running, most likely proxied somehow to port 80\nIn 9898 it's running something service a small gzip file. Let's try to download it and see what's inside."}),"\n",(0,r.jsx)(t.p,{children:"Let's do a SSH port forwarding to check the website from our attacker machine:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"ssh -L  5000:localhost:5000 gael@artificial.htb\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Interesting, in 9898 there's something called ",(0,r.jsx)(t.code,{children:"Backrest"})," version 1.7.2 running and asking for user/password. Potentially is this: ",(0,r.jsx)(t.a,{href:"https://github.com/garethgeorge/backrest",children:"https://github.com/garethgeorge/backrest"}),". Let's try to log in with the default credentials or the credentials we extracted before."]}),"\n",(0,r.jsx)(t.p,{children:"Everything looks good with backrest."}),"\n",(0,r.jsx)(t.p,{children:"Another potential vector is abusing of the h5 file model:"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://hiddenlayer.com/innovation-hub/models-are-code/",children:"https://hiddenlayer.com/innovation-hub/models-are-code/"}),"\n",(0,r.jsx)(t.a,{href:"https://splint.gitbook.io/cyberblog/security-research/tensorflow-remote-code-execution-with-malicious-model",children:"https://splint.gitbook.io/cyberblog/security-research/tensorflow-remote-code-execution-with-malicious-model"})]}),"\n",(0,r.jsxs)(t.p,{children:["So, now we can prepare a reverse shell to get RCE with ",(0,r.jsx)(t.code,{children:"app"})," user and later do privilege escalation."]}),"\n",(0,r.jsx)(t.p,{children:"With the most basic reverse shell it works."}),"\n",(0,r.jsx)(t.h1,{id:"privilege-escalation",children:"Privilege escalation"}),"\n",(0,r.jsxs)(t.p,{children:["Backrest handles backups, looks like there's a ",(0,r.jsx)(t.code,{children:"/var/backups/"})," folder that contains one file owned by the same group as ",(0,r.jsx)(t.code,{children:"gael"})," user:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"gael@artificial:/var/backups$ ls -l\ntotal 51220\n-rw-r--r-- 1 root root      38602 Jun  9 10:48 apt.extended_states.0\n-rw-r--r-- 1 root root       4253 Jun  9 09:02 apt.extended_states.1.gz\n-rw-r--r-- 1 root root       4206 Jun  2 07:42 apt.extended_states.2.gz\n-rw-r--r-- 1 root root       4190 May 27 13:07 apt.extended_states.3.gz\n-rw-r--r-- 1 root root       4383 Oct 27  2024 apt.extended_states.4.gz\n-rw-r--r-- 1 root root       4379 Oct 19  2024 apt.extended_states.5.gz\n-rw-r--r-- 1 root root       4367 Oct 14  2024 apt.extended_states.6.gz\n-rw-r----- 1 root sysadm 52357120 Mar  4 22:19 backrest_backup.tar.gz\ngael@artificial:/var/backups$ id\nuid=1000(gael) gid=1000(gael) groups=1000(gael),1007(sysadm)\n"})}),"\n",(0,r.jsxs)(t.p,{children:["When we decompress that file, we found out a file ",(0,r.jsx)(t.code,{children:"backrest/.config/backrest/config.json"})," which contains the password with bcrypt:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'    "users": [\n      {\n        "name": "backrest_root",\n        "passwordBcrypt": "JDJhJDEwJGNWR0l5OVZNWFFkMGdNNWdpbkNtamVpMmtaUi9BQ01Na1Nzc3BiUnV0WVA1OEVCWnovMFFP"\n      }\n    ]\n'})}),"\n",(0,r.jsx)(t.p,{children:"We can do base64 decode and do a hashcat attack to guess the password:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"hashcat -a 0 -m 3200 hashes-backrest.txt /usr/share/wordlists/rockyou.txt\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Now we have access to backrest as the ",(0,r.jsx)(t.code,{children:"root"})," user. According to ",(0,r.jsx)(t.a,{href:"https://gtfobins.github.io/gtfobins/restic",children:"https://gtfobins.github.io/gtfobins/restic"}),", we can configure backrest to send a backup to a server we own. We just need to configure it to send the contents of /root folder to a server we control."]}),"\n",(0,r.jsxs)(t.p,{children:["Followed this approach running ",(0,r.jsx)(t.a,{href:"https://github.com/restic/rest-server",children:"https://github.com/restic/rest-server"})," in Docker and the backup is created. Later, you need to restore it with ",(0,r.jsx)(t.code,{children:"restic"})," and you'll get the root flag, plus the SSH keys for the root user."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var s=n(6540);const r={},a=s.createContext(r);function o(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);