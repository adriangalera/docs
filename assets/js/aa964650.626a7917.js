"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4893],{4366:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Hacking/Playbooks/DFIR","title":"Digital Forensics and Incident Response","description":"This files contains general guidelines to provide support for DFIR activities. This knowledge comes from solving the Sherlock challenges from HTB.","source":"@site/docs/Hacking/Playbooks/DFIR.md","sourceDirName":"Hacking/Playbooks","slug":"/Hacking/Playbooks/DFIR","permalink":"/docs/Hacking/Playbooks/DFIR","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Active Directory","permalink":"/docs/playbooks/active-directory"},"next":{"title":"File transfer","permalink":"/docs/playbooks/file-transfer"}}');var t=n(4848),a=n(8453);const o={},r="Digital Forensics and Incident Response",l={},c=[{value:"auth.log and wtmp",id:"authlog-and-wtmp",level:2},{value:"evtx",id:"evtx",level:2},{value:"prefetch files",id:"prefetch-files",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"digital-forensics-and-incident-response",children:"Digital Forensics and Incident Response"})}),"\n",(0,t.jsx)(s.p,{children:"This files contains general guidelines to provide support for DFIR activities. This knowledge comes from solving the Sherlock challenges from HTB."}),"\n",(0,t.jsx)(s.h2,{id:"authlog-and-wtmp",children:"auth.log and wtmp"}),"\n",(0,t.jsx)(s.p,{children:"The auth.log file is primarily used for tracking authentication mechanisms. Whenever a\nuser attempts to log in, switch users, or perform any task that requires authentication, an\nentry is made in this log file. This includes activities involving sshd (SSH daemon), sudo\nactions, and cron jobs requiring authentication."}),"\n",(0,t.jsx)(s.p,{children:"An example entry has been detailed below:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'The entry above shows a failed password attempt for a user named "admin" on\nexampleserver from a source IP of 192.168.1.101 over port 22 (SSH). \n'})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"auth.log"})," is human readable."]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"wtmp"})," file logs all login and logout events on the system. It's a binary file, typically\nlocated at /var/log/wtmp . The last command can be used to read this file, providing a\nhistory of user logins and logouts, system reboots, and runlevel changes."]}),"\n",(0,t.jsxs)(s.p,{children:["Since it's a binary file, it worth considering that the arch of the victim might be different from the arch of the researcher, so you might want to use some kind of script such as ",(0,t.jsx)(s.a,{href:"https://gist.github.com/4n6ist/99241df331bb06f393be935f82f036a5",children:"https://gist.github.com/4n6ist/99241df331bb06f393be935f82f036a5"})," to perform the research."]}),"\n",(0,t.jsx)(s.h2,{id:"evtx",children:"evtx"}),"\n",(0,t.jsxs)(s.p,{children:["Windows event logs are provided with ",(0,t.jsx)(s.code,{children:"evtx"})," format. Is is a binary format, in order to read it and process it, you can use chainsaw and sigma-rules to detect possible threats."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/WithSecureLabs/chainsaw",children:"https://github.com/WithSecureLabs/chainsaw"})," a tool to search what happened inside Windows Forensic artifacts"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/SigmaHQ/sigma",children:"https://github.com/SigmaHQ/sigma"})," rules to detect threats"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"e.g:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"./chainsaw hunt ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller -s ~/workspace/tools/sigma --mapping mappings/sigma-event-logs-all.yml -r ~/workspace/tools/sigma/rules --csv --output ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller/chainsaw\n"})}),"\n",(0,t.jsx)(s.p,{children:"and it can generate CSV output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"./chainsaw hunt ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller -s ~/workspace/tools/sigma --mapping mappings/sigma-event-logs-all.yml -r ~/workspace/tools/sigma/rules --csv --output ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller/chainsaw\n"})}),"\n",(0,t.jsx)(s.h2,{id:"prefetch-files",children:"prefetch files"}),"\n",(0,t.jsxs)(s.p,{children:["Windows can be configured to generate a file the first time a binary is executed. This can be very helpful while collecting evidences of attacks. You can analyze them on a Windows machine using the following tools from  ",(0,t.jsx)(s.a,{href:"https://ericzimmerman.github.io/#!index.md",children:"https://ericzimmerman.github.io/#!index.md"}),":"]}),"\n",(0,t.jsxs)(s.p,{children:["-",(0,t.jsx)(s.code,{children:"PECmd"}),": analyze the prefetch files and outputs a CSV:"]}),"\n",(0,t.jsx)(s.p,{children:".\\PECmd.exe -d C:\\Users\\gal\\Desktop\\campfire1\\Workstation\\2024-05-21T033012_triage_asset\\ --csv . --csvf C:\\Users\\gal\\Desktop\\prefetch.csv"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"Timeline Explorer"}),": Load the generated CSV and it will display the CSV data visually."]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>r});var i=n(6540);const t={},a=i.createContext(t);function o(e){const s=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:s},e.children)}}}]);