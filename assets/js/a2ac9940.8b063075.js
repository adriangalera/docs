"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6760],{8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(6540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}},8856:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/easy/Analytics","title":"Analytics","description":"Enumeration","source":"@site/docs/Hacking/Write-ups/Hack the box/easy/Analytics.md","sourceDirName":"Hacking/Write-ups/Hack the box/easy","slug":"/write-up/htb/easy/analytics","permalink":"/docs/write-up/htb/easy/analytics","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/easy/analytics","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var s=t(4848),i=t(8453);const o={slug:"/write-up/htb/easy/analytics",pagination_next:null,pagination_prev:null},r=void 0,c={},l=[{value:"Enumeration",id:"enumeration",level:2},{value:"Foothold",id:"foothold",level:2},{value:"Privilege escalation",id:"privilege-escalation",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nmap 10.10.11.233 -A -oA machines/analytics/enumeration/scans/all-ports -p- --min-rate 1000\n"})}),"\n",(0,s.jsx)(n.p,{children:"Shows ports 22 and 80."}),"\n",(0,s.jsx)(n.p,{children:"SSH version looks quite recent, let's focus on port 80:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"http://analytical.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[demo@analytical.com,due@analytical.com], Frame, HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.233], JQuery[3.0.0], Script, Title[Analytical], X-UA-Compatible[IE=edge], nginx[1.18.0]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Checking the website, I see a ",(0,s.jsx)(n.code,{children:"Login"})," section that redirects to another subdomain: ",(0,s.jsx)(n.code,{children:"data.analytical.htb"}),". Let's add it to the /etc/hosts. It shows the login page of Metabase, let's try some default credentials."]}),"\n",(0,s.jsx)(n.p,{children:"The metabase version looks like it's v0.46.6."}),"\n",(0,s.jsx)(n.h2,{id:"foothold",children:"Foothold"}),"\n",(0,s.jsxs)(n.p,{children:["Found a POC for this precise version: ",(0,s.jsx)(n.a,{href:"https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/",children:"https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/"})]}),"\n",(0,s.jsx)(n.p,{children:"With the payload in the description and modifying it with our local IP,port we got foothold!"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"e4396eead2c0:/$ id\nid\nuid=2000(metabase) gid=2000(metabase) groups=2000(metabase),2000(metabase)\n"})}),"\n",(0,s.jsx)(n.p,{children:"However, we cannot see any relevant users:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'e4396eead2c0:~$ cat /etc/passwd|grep "home"\ncat /etc/passwd|grep "home"\nmetabase:x:2000:2000:Linux User,,,:/home/metabase:/bin/ash\n'})}),"\n",(0,s.jsxs)(n.p,{children:["In that ",(0,s.jsx)(n.code,{children:"/home/metabase"})," folder there's nothing and we see it's using ",(0,s.jsx)(n.code,{children:"/bin/ash"}),", there's a high chance this is running inside a docker container. We'll need to investigate how to bypass it."]}),"\n",(0,s.jsx)(n.p,{children:"Right now we have access to the docker container, but we cannot exit it."}),"\n",(0,s.jsx)(n.p,{children:"We can exfil the database which looks like a H2 instance."}),"\n",(0,s.jsx)(n.p,{children:"We can check the environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"5d711b9d670a:/metabase.db$ env\nenv\nSHELL=/bin/sh\nMB_DB_PASS=\nHOSTNAME=5d711b9d670a\nLANGUAGE=en_US:en\nMB_JETTY_HOST=0.0.0.0\nJAVA_HOME=/opt/java/openjdk\nMB_DB_FILE=//metabase.db/metabase.db\nPWD=/metabase.db\nLOGNAME=metabase\nMB_EMAIL_SMTP_USERNAME=\nHOME=/home/metabase\nLANG=en_US.UTF-8\nMETA_USER=metalytics\nMETA_PASS=An4lytics_dsXXXX#\nMB_EMAIL_SMTP_PASSWORD=\nUSER=metabase\nSHLVL=4\nMB_DB_USER=\nFC_LANG=en-US\nLD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib\nLC_CTYPE=en_US.UTF-8\nMB_LDAP_BIND_DN=\nLC_ALL=en_US.UTF-8\nMB_LDAP_PASSWORD=\nPATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nMB_DB_CONNECTION_URI=\nJAVA_VERSION=jdk-11.0.19+7\n_=/usr/bin/env\nOLDPWD=/\n"})}),"\n",(0,s.jsx)(n.p,{children:"We tried to use the user/password in env var and boom, we got user access."}),"\n",(0,s.jsx)(n.h2,{id:"privilege-escalation",children:"Privilege escalation"}),"\n",(0,s.jsx)(n.p,{children:"Search OS version and kernel for CVEs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"uname -a\nLinux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If we look in Google for ",(0,s.jsx)(n.code,{children:"6.2.0-25-generic #25~22.04.2-Ubuntu CVE"})," you'll see this link: ",(0,s.jsx)(n.a,{href:"https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability",children:"https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability"})," and this link ",(0,s.jsx)(n.a,{href:"https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629",children:"https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629"})]}),"\n",(0,s.jsxs)(n.p,{children:["Now it's just a matter of cloning the repo and run the exploit and you get ",(0,s.jsx)(n.code,{children:"root"})," access directly and pwned!"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);