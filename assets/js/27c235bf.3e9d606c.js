"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[389],{2757:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Challenges/Distract and destroy","title":"Distract and destroy","description":"After defeating her first monster, Alex stood frozen, staring up at another massive, hulking creature that loomed over her. She knew that this was a fight she couldn\'t win on her own. She turned to her guildmates, trying to come up with a plan. \\"We need to distract it,\\" Alex said. \\"If we can get it off balance, we might be able to take it down.\\" Her guildmates nodded, their eyes narrowed in determination. They quickly came up with a plan to lure the monster away from their position, using a combination of noise and movement to distract it. As they put their plan into action, Alex drew her sword and waited for her chance.","source":"@site/docs/Hacking/Write-ups/Hack the box/Challenges/Distract and destroy.md","sourceDirName":"Hacking/Write-ups/Hack the box/Challenges","slug":"/write-up/htb/challenges/distract-and-destroy","permalink":"/docs/write-up/htb/challenges/distract-and-destroy","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/challenges/distract-and-destroy","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var r=n(4848),i=n(8453);const s={slug:"/write-up/htb/challenges/distract-and-destroy",pagination_next:null,pagination_prev:null},o="Distract and destroy",c={},d=[{value:"Intro to Ethereum",id:"intro-to-ethereum",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"distract-and-destroy",children:"Distract and destroy"})}),"\n",(0,r.jsx)(t.p,{children:'After defeating her first monster, Alex stood frozen, staring up at another massive, hulking creature that loomed over her. She knew that this was a fight she couldn\'t win on her own. She turned to her guildmates, trying to come up with a plan. "We need to distract it," Alex said. "If we can get it off balance, we might be able to take it down." Her guildmates nodded, their eyes narrowed in determination. They quickly came up with a plan to lure the monster away from their position, using a combination of noise and movement to distract it. As they put their plan into action, Alex drew her sword and waited for her chance.'}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://app.hackthebox.com/challenges/Distract%2520and%2520Destroy",children:"https://app.hackthebox.com/challenges/Distract%2520and%2520Destroy"})}),"\n",(0,r.jsx)(t.h2,{id:"intro-to-ethereum",children:"Intro to Ethereum"}),"\n",(0,r.jsx)(t.p,{children:"In Ethereum network, there are two types of accounts:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Externally Owned Account (EOA): human powered that has a private key and can initiate transactions"}),"\n",(0,r.jsx)(t.li,{children:"Smart contract: It is controller by code. Only can respond to calls, cannot initiate transactions and does not have a private key."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"When a transaction is made:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"EOA Call:"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"msg.sender = your EOA address\ntx.origin = your EOA address"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Contract Call (via another contract):"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"You call Contract A (as an EOA), and it calls Contract B."}),"\n",(0,r.jsx)(t.p,{children:"In Contract B:"}),"\n",(0,r.jsx)(t.p,{children:"msg.sender = Contract A\ntx.origin = your EOA address"}),"\n",(0,r.jsxs)(t.p,{children:["In our case, the first caller set the ",(0,r.jsx)(t.code,{children:"aggro"})," address:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-solidity",children:"if (aggro == address(0)) {\n    aggro = msg.sender;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Life points are only drained if ",(0,r.jsx)(t.code,{children:"offBalance"})," and the sender is different that the first attacker"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-solidity",children:"if (_isOffBalance() && aggro != msg.sender) {\n    lifePoints -= _damage;\n} else {\n    lifePoints -= 0;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"offBalance"})," happens on this case:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-solidity",children:"  function _isOffBalance() private view returns (bool) {\n        return tx.origin != msg.sender;\n    }\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"tx.origin"})," is transaction origin, since transactions can only be initiated by EOA,\nthis is true only if the call is made from a contract (i.e., not directly from an EOA). So only contract calls (not direct user transactions) can damage the Creature."]}),"\n",(0,r.jsx)(t.p,{children:"So, we need to create two things:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["A EOA that calls attack and sets ",(0,r.jsx)(t.code,{children:"aggro"})," to the EOA. No damage will happen because ",(0,r.jsx)(t.code,{children:"isOffBalance"})," will be false."]}),"\n",(0,r.jsx)(t.li,{children:"A smart contract that calls the attack and drain the life points."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Once the life points are done, we can use the UI to perform the attack and reveal the flag."})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var a=n(6540);const r={},i=a.createContext(r);function s(e){const t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);