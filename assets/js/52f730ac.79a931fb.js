"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3078],{235:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Challenges/The last dance","title":"The last dance","description":"https://app.hackthebox.com/challenges/The%2520Last%2520Dance","source":"@site/docs/Hacking/Write-ups/Hack the box/Challenges/The last dance.md","sourceDirName":"Hacking/Write-ups/Hack the box/Challenges","slug":"/write-up/htb/challenges/the-last-dance","permalink":"/docs/write-up/htb/challenges/the-last-dance","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/challenges/the-last-dance","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var s=t(4848),r=t(8453);const i={slug:"/write-up/htb/challenges/the-last-dance",pagination_next:null,pagination_prev:null},c="The last dance",l={},o=[];function h(e){const n={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"the-last-dance",children:"The last dance"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://app.hackthebox.com/challenges/The%2520Last%2520Dance",children:"https://app.hackthebox.com/challenges/The%2520Last%2520Dance"})}),"\n",(0,s.jsx)(n.p,{children:"To be accepted into the upper class of the Berford Empire, you had to attend the annual Cha-Cha Ball at the High Court. Little did you know that among the many aristocrats invited, you would find a burned enemy spy. Your goal quickly became to capture him, which you succeeded in doing after putting something in his drink. Many hours passed in your agency's interrogation room, and you eventually learned important information about the enemy agency's secret communications. Can you use what you learned to decrypt the rest of the messages?"}),"\n",(0,s.jsx)(n.p,{children:"We are given two files:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"out.txt"}),"\n",(0,s.jsx)(n.li,{children:"source.py"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"After reading the source code, we know the contents of out.txt:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Initialization vector"}),"\n",(0,s.jsx)(n.li,{children:"Encrypted message"}),"\n",(0,s.jsx)(n.li,{children:"Encrypted flag"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The encryption is ChaCha20"}),"\n",(0,s.jsx)(n.p,{children:"ChaCha20 is a stream cipher, meaning it encrypts data by XORing the plaintext with a keystream derived from:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A key"}),"\n",(0,s.jsx)(n.li,{children:"A nonce/IV"}),"\n",(0,s.jsx)(n.li,{children:"A counter (which increments for each block)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The keystream is deterministic and only depends on the key and IV (and counter), not the plaintext. So if the same key and IV are reused, the same keystream is reused."}),"\n",(0,s.jsx)(n.p,{children:"In order to retriev the flag, we'lll do the following:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Derive the keystream from the encrypted message by doing:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"keystream = encrypted message XOR plaintext\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Extract the flag by doing:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"flag = keystream XOR encrypted flag\n"})}),"\n",(0,s.jsx)(n.p,{children:"Remember that for XOR both inputs need to be of the same size!"})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var a=t(6540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);