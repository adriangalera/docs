"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4677],{5124:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Challenges/Simple Encryptor","title":"Simple Encryptor","description":"https://app.hackthebox.com/challenges/Simple%2520Encryptor","source":"@site/docs/Hacking/Write-ups/Hack the box/Challenges/Simple Encryptor.md","sourceDirName":"Hacking/Write-ups/Hack the box/Challenges","slug":"/write-up/htb/challenges/simple-encryptor","permalink":"/docs/write-up/htb/challenges/simple-encryptor","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/challenges/simple-encryptor","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var i=t(4848),s=t(8453);const c={slug:"/write-up/htb/challenges/simple-encryptor",pagination_next:null,pagination_prev:null},o="Simple Encryptor",a={},l=[];function h(e){const n={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"simple-encryptor",children:"Simple Encryptor"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://app.hackthebox.com/challenges/Simple%2520Encryptor",children:"https://app.hackthebox.com/challenges/Simple%2520Encryptor"})}),"\n",(0,i.jsx)(n.p,{children:"On our regular checkups of our secret flag storage server we found out that we were hit by ransomware! The original flag data is nowhere to be found, but luckily we not only have the encrypted file but also the encryption program itself."}),"\n",(0,i.jsxs)(n.p,{children:["We are given a binary file called ",(0,i.jsx)(n.code,{children:"encrypt"})," and the file ",(0,i.jsx)(n.code,{children:"flag.enc"})]}),"\n",(0,i.jsxs)(n.p,{children:["We need to reverse the binary, the main function expects the file ",(0,i.jsx)(n.code,{children:"flag"})," to be present. If so, it encrypts the contents and generates the file ",(0,i.jsx)(n.code,{children:"flag.enc"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The first 4 bytes in the file and the 32-bit truncated system-time used for the encryption\nThe next content in the content of ",(0,i.jsx)(n.code,{children:"flag"})," file shifted somehow:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"-rw-rw-r-- 1 gal gal    11 Aug 16 15:10 flag\n-rw-rw-r-- 1 gal gal    15 Aug 16 15:10 flag.enc\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Whatever content you write in ",(0,i.jsx)(n.code,{children:"flag"}),", ",(0,i.jsx)(n.code,{children:"flag.enc"})," is the same size plus 4 bytes (32-bit truncated unix time)"]}),"\n",(0,i.jsx)(n.p,{children:"The next content is encrypted doing some bitwise operations:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Computes a random integer, take the lowest 8 bits and do XOR with the byte at position i"}),"\n",(0,i.jsx)(n.li,{children:"Computes another random integer restricted from 0 to 7."}),"\n",(0,i.jsx)(n.li,{children:"Perform left bitwise shift by the number determined by the random number, perform the right bitwise shit by (8-random number) and finally perform the bitwise OR of the two shifted values"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In order to revert the encryption, first we need to be able to generate exactly the same sequence of random number. Since computers use pseudo-random number generators (",(0,i.jsx)(n.code,{children:"PRNG"}),") and we have the seed, we can generate exactly the same sequence of random number. But, there's one caveat: ",(0,i.jsx)(n.code,{children:"python"})," and ",(0,i.jsx)(n.code,{children:"c"})," uses different ",(0,i.jsx)(n.code,{children:"PRNG"})," implementations."]}),"\n",(0,i.jsx)(n.p,{children:"Having said that, the first starting point is trying to write our own encryption program in python and make sure another file is generated with exactly the same content:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ python reencrypt.py # generates flag.reenc from python implementation\n\u2514\u2500$ md5sum flag.enc flag.reenc \n4c5c95630c496b16c9977521647d5d6a  flag.enc\n4c5c95630c496b16c9977521647d5d6a  flag.reenc\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The key to do this was to used ",(0,i.jsx)(n.code,{children:"ctypes"})," library to actually call ",(0,i.jsx)(n.code,{children:"libc"})," ",(0,i.jsx)(n.code,{children:"srand()"})," and ",(0,i.jsx)(n.code,{children:"rand()"})," functions to generate the same sequence of random numbers."]}),"\n",(0,i.jsx)(n.p,{children:"Once we have the encryption mechanism written in python, we can write the decryption mechanism. Just remember to invert the order of the algorithm:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Request the random number for the XOR"}),"\n",(0,i.jsx)(n.li,{children:"Request the random number for the bit shifting"}),"\n",(0,i.jsx)(n.li,{children:"Revert the bit shifting: what was shifted left, now is shifter right and vice versa"}),"\n",(0,i.jsx)(n.li,{children:"Revert the XOR"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"And voil\xe0, you will get the flag!"})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var r=t(6540);const i={},s=r.createContext(i);function c(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);