<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Hacking/HTB Academy/Windows fundamentals" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Windows fundamentals | agalera.eu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.agalera.eu/docs/Hacking/HTB Academy/Windows fundamentals"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Windows fundamentals | agalera.eu"><meta data-rh="true" name="description" content="Windows OS have many different versions. In order to determine the version in PowerShell, we can use this command:"><meta data-rh="true" property="og:description" content="Windows OS have many different versions. In order to determine the version in PowerShell, we can use this command:"><link data-rh="true" rel="canonical" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Windows fundamentals"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Windows fundamentals" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Windows fundamentals" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Windows fundamentals","item":"https://www.agalera.eu/docs/Hacking/HTB Academy/Windows fundamentals"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8VGYBN25C",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.f96ca0f1.css">
<script src="/docs/assets/js/runtime~main.12d8fb52.js" defer="defer"></script>
<script src="/docs/assets/js/main.f31a7f51.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">agalera.eu</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/flight-sim/dcs/f5e">Flight Simulators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Hacking/HTB Academy/Android Fundamentals">Hacking</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/Hacking/HTB Academy/Android Fundamentals">HTB Academy</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Android Fundamentals">Android Fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/File inclusion">File inclusion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/File transfers">File transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Introduction to Active Directory">Introduction to Active Directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Introduction to Hardware attacks">Introduction to hardware attacks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Introduction to Purple team">Introduction to Purple team</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Javascript deobfuscation">Javascript deobfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Linux fundamentals">Linux fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Pentest In a Nutshell">Pentest in a nutshell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/SQL injections">SQL injections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Stack-based buffer overflow on Linux">Stack based buffer overflow on Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Stack-based buffer overflow on Windows">Stack based buffer overflow on Windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Web fuzzing">Web fuzzing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Hacking/HTB Academy/Windows fundamentals">Windows fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/ffuf">Fuzzing with ffuf</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/languages/bash">Language security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/playbooks/active-directory">Playbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/tooling/crackmapexec">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/useful-links">Useful links</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/write-up/htb/challenges/critical-ops">Write-ups</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux-useful-commands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Shortcuts/Chrome">Shortcuts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Welcome</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Hacking</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HTB Academy</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Windows fundamentals</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Windows fundamentals</h1></header>
<p>Windows OS have many different versions. In order to determine the version in PowerShell, we can use this command:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Get-WmiObject -Class win32_OperatingSystem | select Version,BuildNumber</span><br></span></code></pre></div></div>
<p>There are many ways to access remotely to a Windows server:</p>
<ul>
<li>Secure Shell: <code>SSH</code></li>
<li>File transfer protocol: <code>FTP</code></li>
<li>Virtual Network Computing: <code>VNC</code></li>
<li>Windows Remote Management (or Powershell Remoting): <code>WinRM</code></li>
<li>Remote Desktop Protocol: <code>RDP</code></li>
</ul>
<p>We can use RDP to connect to a Windows target from an attack host running Linux or Windows. In Linux, we&#x27;ll use any RDP client such as <code>xfreerdp</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xfreerdp /v:&lt;targetIp&gt; /u:htb-student /p:Password</span><br></span></code></pre></div></div>
<p>While in Windows, we&#x27;ll use the builtin Remote Desktop Connection (mstsc.exe). For this to work, remote access must already be allowed on the target Windows system.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="os-structure">OS Structure<a href="#os-structure" class="hash-link" aria-label="Direct link to OS Structure" title="Direct link to OS Structure">​</a></h2>
<p>In Windows operating systems, the root directory is <code>&lt;drive_letter&gt;:\</code> (commonly C drive). The root directory (also known as the boot partition) is where the operating system is installed. Other physical and virtual drives are assigned other letters, for example, Data (E:). The directory structure of the boot partition is as follows:</p>
<table><thead><tr><th><strong>Folder</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>Perflogs</strong></td><td>Can hold Windows performance logs but is empty by default.</td></tr><tr><td><strong>Program Files</strong></td><td>On 32-bit systems, all 16-bit and 32-bit programs are installed here. On 64-bit systems, only 64-bit programs are installed here.</td></tr><tr><td><strong>Program Files (x86)</strong></td><td>32-bit and 16-bit programs are installed here on 64-bit editions of Windows.</td></tr><tr><td><strong>ProgramData</strong></td><td>A hidden folder that contains data essential for certain installed programs to run. This data is accessible by the program regardless of which user is running it.</td></tr><tr><td><strong>Users</strong></td><td>Contains user profiles for each user who logs onto the system. Includes the <strong>Public</strong> and <strong>Default</strong> folders.</td></tr><tr><td><strong>Default</strong></td><td>Default user profile template used when a new user is created. The new profile is based on this template.</td></tr><tr><td><strong>Public</strong></td><td>Used to share files among all users. Accessible by all users and shared over the network by default (requires a valid network account).</td></tr><tr><td><strong>AppData</strong></td><td>Hidden per-user application data folder (e.g., <code>cliff.moore\AppData</code>) containing: <br> - <strong>Roaming</strong>: Machine-independent data (e.g., custom dictionaries).<br> - <strong>Local</strong>: Machine-specific data, not synchronized.<br> - <strong>LocalLow</strong>: Lower integrity level, used by apps in safe mode (e.g., browsers).</td></tr><tr><td><strong>Windows</strong></td><td>Contains most files required for the Windows operating system.</td></tr><tr><td><strong>System, System32, SysWOW64</strong></td><td>Contains essential DLLs for Windows and the Windows API. These folders are searched when programs load DLLs without an absolute path.</td></tr><tr><td><strong>WinSxS</strong></td><td>The Windows Component Store. Contains copies of all Windows components, updates, and service packs.</td></tr></tbody></table>
<p>We can use the <code>dir</code> command to list the contents of a folder. Also <code>ls</code> will work in modern Windows.</p>
<p><code>tree</code> command is very useful to see the directory structure. <code>tree</code> command can be piped to <code>more</code> to page the output: <code>tree c:\ /f | more</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="file-system">File system<a href="#file-system" class="hash-link" aria-label="Direct link to File system" title="Direct link to File system">​</a></h2>
<p>There are 5 types of Windows file systems: FAT12, FAT16, FAT32, NTFS, and exFAT. FAT12 and FAT16 are no longer used on modern Windows operating systems.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fat32">FAT32<a href="#fat32" class="hash-link" aria-label="Direct link to FAT32" title="Direct link to FAT32">​</a></h3>
<p>FAT32 (File Allocation Table) is widely used across many types of storage devices such as USB memory sticks and SD cards but can also be used to format hard drives. The &quot;32&quot; in the name refers to the fact that FAT32 uses 32 bits of data for identifying data clusters on a storage device.</p>
<p>Pros of FAT32:</p>
<ul>
<li>Device compatibility - it can be used on computers, digital cameras, gaming consoles, smartphones, tablets, and more.</li>
<li>Operating system cross-compatibility - It works on all Windows operating systems starting from Windows 95 and is also supported by MacOS and Linux.</li>
</ul>
<p>Cons of FAT32:</p>
<ul>
<li>Can only be used with files that are less than 4GB.</li>
<li>No built-in data protection or file compression features.</li>
<li>Must use third-party tools for file encryption.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ntfs">NTFS<a href="#ntfs" class="hash-link" aria-label="Direct link to NTFS" title="Direct link to NTFS">​</a></h3>
<p>NTFS (New Technology File System) is the default Windows file system since Windows NT 3.1. In addition to making up for the shortcomings of FAT32, NTFS also has better support for metadata and better performance due to improved data structuring.</p>
<p>Pros of NTFS:</p>
<ul>
<li>NTFS is reliable and can restore the consistency of the file system in the event of a system failure or power loss.</li>
<li>Provides security by allowing us to set granular permissions on both files and folders.</li>
<li>Supports very large-sized partitions.</li>
<li>Has journaling built-in, meaning that file modifications (addition, modification, deletion) are logged.</li>
</ul>
<p>Cons of NTFS:</p>
<ul>
<li>Most mobile devices do not support NTFS natively.</li>
<li>Older media devices such as TVs and digital cameras do not offer support for NTFS storage devices.</li>
</ul>
<p>The NTFS file system has many basic and advanced permissions. Some of the key permission types are:</p>
<table><thead><tr><th><strong>Permission</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>Full Control</strong></td><td>Allows reading, writing, changing, and deleting of files/folders.</td></tr><tr><td><strong>Modify</strong></td><td>Allows reading, writing, and deleting of files/folders.</td></tr><tr><td><strong>List Folder Contents</strong></td><td>Allows viewing and listing folders and subfolders, as well as executing files. Folders only inherit this permission.</td></tr><tr><td><strong>Read and Execute</strong></td><td>Allows viewing and listing files and subfolders, as well as executing files. Inherited by both files and folders.</td></tr><tr><td><strong>Write</strong></td><td>Allows adding files to folders/subfolders and writing to files.</td></tr><tr><td><strong>Read</strong></td><td>Allows viewing and listing of folders/subfolders and viewing file contents.</td></tr><tr><td><strong>Traverse Folder</strong></td><td>Allows moving through folders to reach other files/folders without needing permission to list folder contents. For example, with this permission, a user can access a file like <code>c:\users\bsmith\documents\webapps\backups\backup_02042020.zip</code> even without access to intermediate folders.</td></tr></tbody></table>
<p>Files and folders inherit the NTFS permissions of their parent folder for ease of administration. If permissions do need to be set explicitly, an administrator can disable permissions inheritance for the necessary files and folders and then set the permissions directly on each.</p>
<p>We can use the UI to setup the permissions, or the <code>icacls</code> command:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; icacls c:\windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\windows NT SERVICE\TrustedInstaller:(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           NT SERVICE\TrustedInstaller:(CI)(IO)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           NT AUTHORITY\SYSTEM:(M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           NT AUTHORITY\SYSTEM:(OI)(CI)(IO)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           BUILTIN\Administrators:(M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           BUILTIN\Administrators:(OI)(CI)(IO)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           BUILTIN\Users:(RX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           BUILTIN\Users:(OI)(CI)(IO)(GR,GE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           CREATOR OWNER:(OI)(CI)(IO)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(RX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(OI)(CI)(IO)(GR,GE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(RX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(OI)(CI)(IO)(GR,GE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully processed 1 files; Failed processing 0 files</span><br></span></code></pre></div></div>
<p>The codes at the end mean:</p>
<ul>
<li>(CI): container inherit</li>
<li>(OI): object inherit</li>
<li>(IO): inherit only</li>
<li>(NP): do not propagate inherit</li>
<li>(I): permission inherited from parent container</li>
<li>F : full access</li>
<li>D :  delete access</li>
<li>N :  no access</li>
<li>M :  modify access</li>
<li>RX :  read and execute access</li>
<li>R :  read-only access</li>
<li>W :  write-only access</li>
</ul>
<p>Refer to <a href="https://ss64.com/nt/icacls.html" target="_blank" rel="noopener noreferrer">https://ss64.com/nt/icacls.html</a> for a full guide on the <code>icacls</code> command.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sharing">Sharing<a href="#sharing" class="hash-link" aria-label="Direct link to Sharing" title="Direct link to Sharing">​</a></h2>
<p>The Server Message Block protocol (SMB) is used in Windows to connect shared resources like files and printers.</p>
<p>NTFS permissions and share permissions are often understood to be the same. Please know that they are not the same but often apply to the same shared resource.</p>
<ul>
<li>Share permissions:</li>
</ul>
<table><thead><tr><th><strong>Permission</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>Full Control</strong></td><td>Users are permitted to perform all actions given by <strong>Change</strong> and <strong>Read</strong> permissions, as well as change permissions for NTFS files and subfolders.</td></tr><tr><td><strong>Change</strong></td><td>Users are permitted to read, edit, delete, and add files and subfolders.</td></tr><tr><td><strong>Read</strong></td><td>Users are allowed to view file and subfolder contents.</td></tr></tbody></table>
<ul>
<li>NTFS permissions:</li>
</ul>
<table><thead><tr><th><strong>Permission</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>Full Control</strong></td><td>Users are permitted to add, edit, move, and delete files &amp; folders, as well as change NTFS permissions that apply to all allowed folders.</td></tr><tr><td><strong>Modify</strong></td><td>Users are permitted or denied permissions to view and modify files and folders, including adding or deleting files.</td></tr><tr><td><strong>Read &amp; Execute</strong></td><td>Users are permitted or denied permissions to read the contents of files and execute programs.</td></tr><tr><td><strong>List Folder Contents</strong></td><td>Users are permitted or denied permissions to view a listing of files and subfolders.</td></tr><tr><td><strong>Read</strong></td><td>Users are permitted or denied permissions to read the contents of files.</td></tr><tr><td><strong>Write</strong></td><td>Users are permitted or denied permissions to write changes to a file and add new files to a folder.</td></tr><tr><td><strong>Traverse Folder / Execute File</strong></td><td>Users are permitted or denied permissions to access a subfolder within a directory structure even if access to the parent folder is denied. Also allows execution of programs.</td></tr><tr><td><strong>List Folder / Read Data</strong></td><td>Users are permitted or denied permissions to view files and folders in the parent folder. Also allows opening and viewing files.</td></tr><tr><td><strong>Read Attributes</strong></td><td>Users are permitted or denied permissions to view basic attributes of a file or folder (e.g., system, archive, read-only, hidden).</td></tr><tr><td><strong>Read Extended Attributes</strong></td><td>Users are permitted or denied permissions to view extended attributes of a file or folder. These vary by program.</td></tr><tr><td><strong>Create Files / Write Data</strong></td><td>Users are permitted or denied permissions to create files within a folder and modify file contents.</td></tr><tr><td><strong>Create Folders / Append Data</strong></td><td>Users are permitted or denied permissions to create subfolders. Allows data to be appended to existing files without overwriting.</td></tr><tr><td><strong>Write Attributes</strong></td><td>Users are permitted or denied permissions to change file attributes. Does not allow creating files or folders.</td></tr><tr><td><strong>Write Extended Attributes</strong></td><td>Users are permitted or denied permissions to change extended attributes of a file or folder. These vary by program.</td></tr><tr><td><strong>Delete Subfolders and Files</strong></td><td>Users are permitted or denied permissions to delete subfolders and files, but not the parent folder itself.</td></tr><tr><td><strong>Delete</strong></td><td>Users are permitted or denied permissions to delete parent folders, subfolders, and files.</td></tr><tr><td><strong>Read Permissions</strong></td><td>Users are permitted or denied permissions to read the permissions set on a file or folder.</td></tr><tr><td><strong>Change Permissions</strong></td><td>Users are permitted or denied permissions to change the permissions on a file or folder.</td></tr><tr><td><strong>Take Ownership</strong></td><td>Users are permitted or denied permissions to take ownership of a file or folder. File owners can change any permissions.</td></tr></tbody></table>
<p>Keep in mind that NTFS permissions apply to the system where the folder and files are hosted. Folders created in NTFS inherit permissions from parent folders by default.</p>
<p>The share permissions apply when the folder is being accessed through SMB, typically from a different system over the network.</p>
<p>This means someone logged in locally to the machine or via RDP can access the shared folder and files by simply navigating to the location on the file system and only need to consider NTFS permissions.</p>
<p>The permissions at the NTFS level provide administrators much more granular control over what users can do within a folder or file.</p>
<blockquote>
<p>Windows Defender Firewall Considerations:</p>
<p>The Windows Defender Firewall could potentially be blocking access to the SMB share. If we are connecting from a Linux-based system the firewall will block access since it will block access from any device that is not joined to the same workgroup.</p>
<p>It is also important to note that when a Windows system is part of a workgroup, all <code>netlogon</code> requests are authenticated against that particular Windows system&#x27;s SAM database. When a Windows system is joined to a Windows Domain environment, all <code>netlogon</code> requests are authenticated against Active Directory.</p>
<ul>
<li>Local SAM database is used for login with workgroup</li>
<li>Active Directory is used for login with Windows Domain</li>
</ul>
</blockquote>
<p>Once a SMB share is ready, we can mount it in a Linux machine by running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mount -t cifs -o username=htb-student,password=Academy_WinFun! //ipaddoftarget/&quot;Company Data&quot; /home/user/Desktop/</span><br></span></code></pre></div></div>
<p>In Windows, we can use <code>net share</code> command to see what is actually sharing. Surprisingly, we see that C:\ is shared:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Users\htb-student&gt; net share</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Share name   Resource                        Remark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C$           C:\                             Default share</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPC$                                         Remote IPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN$       C:\WINDOWS                      Remote Admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Company Data C:\Users\htb-student\Desktop\Company Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre></div></div>
<p>We didn&#x27;t manually share C:. The most important drive with the most critical files on a Windows system is shared via SMB at install. This means anyone with the proper access could remotely access the entire C:\ of each Windows system on a network.</p>
<p>You can also use <code>Computer Management</code> if you want a GUI to manage Shares, Sessions or Open files.</p>
<p>You can view access logs of the shared data in <code>Event Viewer</code>. For example, we can view the logs created for every action we performed when accessing the Windows 10 target box, as well as when creating, editing and accessing the shared folder.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-services-and-processes">Windows Services and processes<a href="#windows-services-and-processes" class="hash-link" aria-label="Direct link to Windows Services and processes" title="Direct link to Windows Services and processes">​</a></h2>
<p>Services are a major component of the Windows operating system. They allow for the creation and management of long-running processes. Windows services can be started automatically at system boot without user intervention. These services can continue to run in the background even after the user logs out of their account on the system.</p>
<p>Windows services are managed via the Service Control Manager (SCM) system, accessible via the services.msc MMC add-in. It is also possible to query and manage services via the command line using sc.exe using PowerShell cmdlets such as Get-Service.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  PS C:\htb&gt; Get-Service | ? {$_.Status -eq &quot;Running&quot;} | select -First 2 |fl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                : AdobeARMservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DisplayName         : Adobe Acrobat Update Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status              : Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DependentServices   : {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServicesDependedOn  : {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanPauseAndContinue : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanShutdown         : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanStop             : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServiceType         : Win32OwnProcess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                : Appinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DisplayName         : Application Information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status              : Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DependentServices   : {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServicesDependedOn  : {RpcSs, ProfSvc}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanPauseAndContinue : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanShutdown         : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanStop             : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServiceType         : Win32OwnProcess, Win32ShareProcess</span><br></span></code></pre></div></div>
<p>Service statuses can appear as Running, Stopped, or Paused, and they can be set to start manually, automatically, or on a delay at system boot. Services can also be shown in the state of Starting or Stopping if some action has triggered them to either start or stop. Windows has three categories of services: Local Services, Network Services, and System Services. Services can usually only be created, modified, and deleted by users with administrative privileges.</p>
<p><strong>Misconfigurations around service permissions are a common privilege escalation vector on Windows systems.</strong></p>
<p>You can see a list of services here: <a href="https://en.wikipedia.org/wiki/List_of_Microsoft_Windows_components#Services" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/List_of_Microsoft_Windows_components#Services</a></p>
<p>Think of services as the <code>daemon</code> equivalent of Linux.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="processes">Processes<a href="#processes" class="hash-link" aria-label="Direct link to Processes" title="Direct link to Processes">​</a></h3>
<p>Processes run in the background on Windows systems. They either run automatically as part of the Windows operating system or are started by other installed applications.</p>
<p>Processes run in the background on Windows systems. They either run automatically as part of the Windows operating system or are started by other installed applications.</p>
<p>Processes associated with installed applications can often be terminated without causing a severe impact on the operating system. Certain processes are critical and, if terminated, will stop certain components of the operating system from running properly. Some examples include the Windows Logon Application, System, System Idle Process, Windows Start-Up Application, Client Server Runtime, Windows Session Manager, Service Host, and Local Security Authority Subsystem Service (LSASS) process.</p>
<p><code>lsass.exe</code> is the process that is responsible for enforcing the security policy on Windows systems. When a user attempts to log on to the system, this process verifies their log on attempt and creates access tokens based on the user&#x27;s permission levels. LSASS is also responsible for user account password changes. All events associated with this process (logon/logoff attempts, etc.) are logged within the Windows Security Log. LSASS is an extremely high-value target as several tools exist to extract both cleartext and hashed credentials stored in memory by this process.</p>
<p>There are some tools provided by Microsoft that allow pentester to explore processes and discover possible privilege escalation paths as well as lateral movements.</p>
<p>The tools are called <code>SysInternals Tools Suite</code> and can be downloaded here: <a href="https://docs.microsoft.com/en-us/sysinternals" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/sysinternals</a>.</p>
<p>They even can be accessed via a Public share without the need to download them:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; \\live.sysinternals.com\tools\procdump.exe -accepteula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProcDump v9.0 - Sysinternals process dump utility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright (C) 2009-2017 Mark Russinovich and Andrew Richards</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sysinternals - www.sysinternals.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Monitors a process and writes a dump file when the process exceeds the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">specified criteria or has an exception.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Capture Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   procdump.exe [-mm] [-ma] [-mp] [-mc Mask] [-md Callback_DLL] [-mk]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [-n Count]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [-s Seconds]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [-c|-cl CPU_Usage [-u]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div>
<p>We can see the processes running using the <code>Task Manager</code>. The typical CTRL + ALT + DEL or running <code>taskmgr</code> from shell.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-permissions">Service permissions<a href="#service-permissions" class="hash-link" aria-label="Direct link to Service permissions" title="Direct link to Service permissions">​</a></h2>
<p>Services usually can be abused for privilege escalations due to permission miss-configurations, put in place by 3rd party software and easy to make mistakes by admins during install processes.</p>
<p>We can use services.msc to view and manage just about every detail regarding all services. Here we can see things like <code>Service name</code>, <code>Path to the executable</code>, <code>Log on account</code>.</p>
<p>Knowing the service name is especially useful when using command-line tools to examine and manage services.</p>
<p>Path to the executable is the full path to the program and command to execute when the service starts. If the NTFS permissions of the destination directory are configured with weak permissions, an attacker could replace the original executable with one created for malicious purposes.</p>
<p>Most services run with LocalSystem privileges by default which is the highest level of access allowed on an individual Windows OS. Not all applications need Local System account-level permissions</p>
<p>The recovery tab allows steps to be configured should a service fail. Notice how this service can be set to run a program after the first failure. This is yet another vector that an attacker could use to run malicious programs by utilizing a legitimate service.</p>
<p>We can do the same with <code>sc</code> command line utility:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Users\htb-student&gt;sc qc wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SC] QueryServiceConfig SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE_NAME: wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TYPE               : 20  WIN32_SHARE_PROCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       START_TYPE         : 3   DEMAND_START</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ERROR_CONTROL      : 1   NORMAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       BINARY_PATH_NAME   : C:\WINDOWS\system32\svchost.exe -k netsvcs -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       LOAD_ORDER_GROUP   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TAG                : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DISPLAY_NAME       : Windows Update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DEPENDENCIES       : rpcss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       SERVICE_START_NAME : LocalSystem</span><br></span></code></pre></div></div>
<ul>
<li><code>qc</code> is for querying</li>
</ul>
<p>We can run it in network:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc //hostname or ip of box query ServiceName</span><br></span></code></pre></div></div>
<p>Or, we can use it to manage services:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Users\htb-student&gt; sc stop wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SC] OpenService FAILED 5:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access is denied.</span><br></span></code></pre></div></div>
<p>or modify the config of the services:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\WINDOWS\system32&gt; sc config wuauserv binPath=C:\Winbows\Perfectlylegitprogram.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SC] ChangeServiceConfig SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\WINDOWS\system32&gt; sc qc wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SC] QueryServiceConfig SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE_NAME: wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TYPE               : 20  WIN32_SHARE_PROCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        START_TYPE         : 3   DEMAND_START</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERROR_CONTROL      : 1   NORMAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BINARY_PATH_NAME   : C:\Winbows\Perfectlylegitprogram.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LOAD_ORDER_GROUP   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TAG                : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DISPLAY_NAME       : Windows Update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DEPENDENCIES       : rpcss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SERVICE_START_NAME : LocalSystem</span><br></span></code></pre></div></div>
<p>Another helpful way we can examine service permissions using sc is through the sdshow command:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\WINDOWS\system32&gt; sc sdshow wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)S:(AU;FA;CCDCLCSWRPWPDTLOSDRCWDWO;;;WD)</span><br></span></code></pre></div></div>
<p>This gibberish is the <code>security descriptor (SD)</code> of the service and uses <code>Security Descriptor Definition Language (SDDL)</code> which describes an access control list of the service.</p>
<p>Similarly, we can run <code>Get-Acl</code> in Powershell:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\htb-student&gt; Get-ACL -Path HKLM:\System\CurrentControlSet\Services\wuauserv | Format-List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Path   : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\wuauserv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner  : NT AUTHORITY\SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group  : NT AUTHORITY\SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access : BUILTIN\Users Allow  ReadKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Users Allow  -2147483648</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Administrators Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Administrators Allow  268435456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         NT AUTHORITY\SYSTEM Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         NT AUTHORITY\SYSTEM Allow  268435456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         CREATOR OWNER Allow  268435456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES Allow  ReadKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES Allow  -2147483648</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         S-1-15-3-1024-1065365936-1281604716-3511738428-1654721687-432734479-3232135806-4053264122-3456934681 Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ReadKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         S-1-15-3-1024-1065365936-1281604716-3511738428-1654721687-432734479-3232135806-4053264122-3456934681 Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -2147483648</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Audit  :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sddl   : O:SYG:SYD:AI(A;ID;KR;;;BU)(A;CIIOID;GR;;;BU)(A;ID;KA;;;BA)(A;CIIOID;GA;;;BA)(A;ID;KA;;;SY)(A;CIIOID;GA;;;SY)(A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ;CIIOID;GA;;;CO)(A;ID;KR;;;AC)(A;CIIOID;GR;;;AC)(A;ID;KR;;;S-1-15-3-1024-1065365936-1281604716-3511738428-1654</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         721687-432734479-3232135806-4053264122-3456934681)(A;CIIOID;GR;;;S-1-15-3-1024-1065365936-1281604716-351173842</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         8-1654721687-432734479-3232135806-4053264122-3456934681)</span><br></span></code></pre></div></div>
<p>Notice how this command returns specific account permissions in an easy-to-read format and in SDDL. Also, the SID that represents each security principal (User and/or Group) is present in the SDDL. This is something we do not get when running sc from the command prompt.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-sessions">Windows Sessions<a href="#windows-sessions" class="hash-link" aria-label="Direct link to Windows Sessions" title="Direct link to Windows Sessions">​</a></h2>
<ul>
<li>
<p>Interactive: An interactive, or local logon session, is initiated by a user authenticating to a local or domain system by entering their credentials. An interactive logon can be initiated by logging directly into the system, by requesting a secondary logon session using the <code>runas</code> command via the command line, or through a Remote Desktop connection.</p>
</li>
<li>
<p>Non-interactive: they do not require login credentials. on-interactive accounts are generally used by the Windows operating system to automatically start services and applications without requiring user interaction. These accounts have no password associated with them and are usually used to start services when the system boots or to run scheduled tasks.</p>
</li>
</ul>
<p>There are three types:</p>
<ul>
<li>Local System Account or (<code>NT AUTHORITY\SYSTEM </code>):  It is used for a variety of OS-related tasks, such as starting Windows services. This account is more powerful than accounts in the local administrators group.</li>
<li>Local Service Account	or (<code>NT AUTHORITY\LocalService</code>): this is a less privileged version of the SYSTEM account and has similar privileges to a local user account. It is granted limited functionality and can start some services.</li>
<li>Network Service Account or (<code>NT AUTHORITY\NetworkService</code>): similar to a standard domain user account. It has similar privileges to the Local Service Account on the local machine. It can establish authenticated sessions for certain network services.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interacting-with-windows">Interacting with Windows<a href="#interacting-with-windows" class="hash-link" aria-label="Direct link to Interacting with Windows" title="Direct link to Interacting with Windows">​</a></h2>
<ul>
<li>GUI: using mouse and keyboard.</li>
<li>RDP: access the GUI from another networked device</li>
<li>Windows Command Line: automate things, create scripts, etc. We can distinguish two types of command lines:<!-- -->
<ul>
<li>CMD: The Command Prompt (cmd.exe) is used to enter and execute commands.</li>
<li>Powershell: built on top of the .NET Framework, which is used for building and running applications on Windows. This makes it a very powerful tool for interfacing directly with the operating system. PowerShell utilizes cmdlets, which are small single-function tools built into the shell.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Many cmdlets in PowerShell also have aliases. For example, the aliases for the cmdlet <code>Set-Location</code>, to change directories, is either <code>cd</code> or <code>sl</code>. Meanwhile, the aliases for <code>Get-ChildItem</code> are <code>ls</code> and <code>gci</code>. We can view all available aliases by typing <code>Get-Alias</code>.</p>
</blockquote>
<p>One common way to work with a script in PowerShell is to import it so that all functions are then available within our current PowerShell console session: Import-Module .\PowerView.ps1.</p>
<p>Sometimes we will find that we are unable to run scripts on a system. This is due to a security feature called the <code>execution policy</code>. Here, there are the different values:</p>
<table><thead><tr><th><strong>Policy</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>AllSigned</strong></td><td>All scripts can run, but a trusted publisher must sign scripts and configuration files (both remote and local). A prompt appears before running scripts signed by publishers not yet marked as trusted or untrusted.</td></tr><tr><td><strong>Bypass</strong></td><td>No scripts or configuration files are blocked, and the user receives no warnings or prompts.</td></tr><tr><td><strong>Default</strong></td><td>Sets the default execution policy: <strong>Restricted</strong> on Windows desktop systems, <strong>RemoteSigned</strong> on Windows Server systems.</td></tr><tr><td><strong>RemoteSigned</strong></td><td>Scripts can run, but downloaded scripts must be digitally signed. Locally written scripts do not require signatures.</td></tr><tr><td><strong>Restricted</strong></td><td>Only individual commands are allowed; scripts are blocked. Blocks all script file types (e.g., <code>.ps1xml</code>, <code>.psm1</code>, <code>.ps1</code>).</td></tr><tr><td><strong>Undefined</strong></td><td>No execution policy is set for the current scope. If all scopes are set to undefined, the system defaults to <strong>Restricted</strong>.</td></tr><tr><td><strong>Unrestricted</strong></td><td>Default for non-Windows computers and cannot be changed. Allows all scripts to run.</td></tr></tbody></table>
<p>The execution policy is not meant to be a security control that restricts user actions. A user can easily bypass the policy by either typing the script contents directly into the PowerShell window, downloading and invoking the script, or specifying the script as an encoded command. It can also be bypassed by adjusting the execution policy (if the user has the proper rights) or setting the execution policy for the current process scope (which can be done by almost any user as it does not require a configuration change and will only be set for the duration of the user&#x27;s session).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-management-instrumentation-wmi">Windows Management Instrumentation (WMI)<a href="#windows-management-instrumentation-wmi" class="hash-link" aria-label="Direct link to Windows Management Instrumentation (WMI)" title="Direct link to Windows Management Instrumentation (WMI)">​</a></h2>
<p>WMI is a subsystem of PowerShell that provides system administrators with powerful tools for system monitoring. Some of the uses for WMI are:</p>
<ul>
<li>Status information for local/remote systems</li>
<li>Configuring security settings on remote machines/applications</li>
<li>Setting and changing user and group permissions</li>
<li>Setting/modifying system properties</li>
<li>Code execution</li>
<li>Scheduling processes</li>
<li>Setting up logging</li>
</ul>
<p>For example:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wmic os list brief</span><br></span></code></pre></div></div>
<p>To use it from PowerShell, we can use <code>Get-WmiObject</code>:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -Class Win32_OperatingSystem | select SystemDirectory,BuildNumber,SerialNumber,Version | ft</span><br></span></code></pre></div></div>
<p>and <code>Invoke-WmiObject</code>:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-WmiMethod -Path &quot;CIM_DataFile.Name=&#x27;C:\users\public\spns.csv&#x27;&quot; -Name Rename -ArgumentList &quot;C:\Users\Public\kerberoasted_users.csv&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-management-console-mmc">Microsoft Management Console (MMC)<a href="#microsoft-management-console-mmc" class="hash-link" aria-label="Direct link to Microsoft Management Console (MMC)" title="Direct link to Microsoft Management Console (MMC)">​</a></h2>
<p>The MMC can be used to group snap-ins, or administrative tools, to manage hardware, software, and network components within a Windows host. To start it, type <code>mmc</code> in the Start Menu.</p>
<p>From here, we can browse to File --&gt; Add or Remove Snap-ins, and begin customizing our administrative console.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-subsystem-for-linux-wsl">Windows Subsystem for Linux (WSL)<a href="#windows-subsystem-for-linux-wsl" class="hash-link" aria-label="Direct link to Windows Subsystem for Linux (WSL)" title="Direct link to Windows Subsystem for Linux (WSL)">​</a></h2>
<p>WSL is a feature that allows Linux binaries to be run natively on Windows 10 and Windows Server 2019.</p>
<p>WSL can be installed by running the PowerShell command Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux as an Administrator.</p>
<p>WSL installs an application called Bash.exe, which can be run by merely typing bash into a Windows console to spawn a Bash shell.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-security">Windows security<a href="#windows-security" class="hash-link" aria-label="Direct link to Windows security" title="Direct link to Windows security">​</a></h2>
<p>Security is a critical topic in Windows operating systems. Windows systems have many moving parts that present a vast attack surface. Due to the many built-in applications, features, and layers of settings, Windows systems can be easily misconfigured, thus opening them up to attack even if they are fully patched.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-identifier-sid">Security Identifier (SID)<a href="#security-identifier-sid" class="hash-link" aria-label="Direct link to Security Identifier (SID)" title="Direct link to Security Identifier (SID)">​</a></h3>
<p>Each of the security principals on the system has a unique security identifier (SID). The system automatically generates SIDs. This means that even if, for example, we have two identical users on the system, Windows can distinguish the two and their rights based on their SIDs. SIDs are string values with different lengths, which are stored in the security database. These SIDs are added to the user&#x27;s access token to identify all actions that the user is authorized to take.</p>
<p>A SID consists of the Identifier Authority and the Relative ID (RID). In an Active Directory (AD) domain environment, the SID also includes the domain SID.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; whoami /user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER INFORMATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Name           SID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================== =============================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ws01\bob S-1-5-21-674899381-4069889467-2080702030-1002</span><br></span></code></pre></div></div>
<p>The format is <code>(SID)-(revision level)-(identifier-authority)-(subauthority1)-(subauthority2)-(etc)</code>.</p>
<p>In this example:</p>
<table><thead><tr><th><strong>Number</strong></th><th><strong>Meaning</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong>S</strong></td><td><strong>SID</strong></td><td>Identifies the string as a SID.</td></tr><tr><td><strong>1</strong></td><td><strong>Revision Level</strong></td><td>To date, this has never changed and has always been 1.</td></tr><tr><td><strong>5</strong></td><td><strong>Identifier Authority</strong></td><td>A 48-bit string that identifies the authority (the computer or network) that created the SID.</td></tr><tr><td><strong>21</strong></td><td><strong>Subauthority1</strong></td><td>A variable number identifying the user&#x27;s relation or group to the authority that created the SID. Indicates the order in which the account was created.</td></tr><tr><td><strong>674899381-4069889467-2080702030</strong></td><td><strong>Subauthority2</strong></td><td>Identifies which computer or domain created the number.</td></tr><tr><td><strong>1002</strong></td><td><strong>Subauthority3</strong></td><td>The RID (Relative Identifier) that distinguishes one account from another. Indicates whether the user is a normal user, guest, administrator, or part of another group.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-accounts-manager-sam-and-access-control-entries-ace">Security Accounts Manager (SAM) and Access Control Entries (ACE)<a href="#security-accounts-manager-sam-and-access-control-entries-ace" class="hash-link" aria-label="Direct link to Security Accounts Manager (SAM) and Access Control Entries (ACE)" title="Direct link to Security Accounts Manager (SAM) and Access Control Entries (ACE)">​</a></h3>
<p>SAM grants rights to a network to execute specific processes.</p>
<p>The access rights themselves are managed by Access Control Entries (ACE) in Access Control Lists (ACL). The ACLs contain ACEs that define which users, groups, or processes have access to a file or to execute a process, for example.</p>
<p>The permissions to access a securable object are given by the security descriptor, classified into two types of ACLs: the Discretionary Access Control List (DACL) or System Access Control List (SACL). Every thread and process started or initiated by a user goes through an authorization process. An integral part of this process is access tokens, validated by the Local Security Authority (LSA). In addition to the SID, these access tokens contain other security-relevant information. Understanding these functionalities is an essential part of learning how to use and work around these security mechanisms during the privilege escalation phase.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-account-control-uac">User Account Control (UAC)<a href="#user-account-control-uac" class="hash-link" aria-label="Direct link to User Account Control (UAC)" title="Direct link to User Account Control (UAC)">​</a></h3>
<p>User Account Control (UAC) is a security feature in Windows to prevent malware from running or manipulating processes that could damage the computer or its contents.</p>
<p>There is the Admin Approval Mode in UAC, which is designed to prevent unwanted software from being installed without the administrator&#x27;s knowledge or to prevent system-wide changes from being made.</p>
<p>This is the typical display that ask for consent to install a software on Windows because the install process requires Admin privileges.</p>
<p>You can find how the UAC works here: <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="registry">Registry<a href="#registry" class="hash-link" aria-label="Direct link to Registry" title="Direct link to Registry">​</a></h3>
<p>The Registry is a hierarchical database in Windows critical for the operating system. It stores low-level settings for the Windows operating system and applications that choose to use it. To see, you just need to execute <code>regedit</code> command. It has a tree structure.</p>
<p>Each folder under Computer is a key. The root keys all start with HKEY. A key such as HKEY-LOCAL-MACHINE is abbreviated to HKLM.</p>
<p>The following keys:</p>
<ul>
<li>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</li>
<li>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</li>
<li>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</li>
<li>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</li>
</ul>
<p>are useful for maintaining access to the system. For example:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OneDrive    REG_SZ    &quot;C:\Users\bob\AppData\Local\Microsoft\OneDrive\OneDrive.exe&quot; /background</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPENVPN-GUI    REG_SZ    C:\Program Files\OpenVPN\bin\openvpn-gui.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Docker Desktop    REG_SZ    C:\Program Files\Docker\Docker\Docker Desktop.exe</span><br></span></code></pre></div></div>
<p>Shows the current applications ran by the user.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applocker-application-whitelist">AppLocker: Application Whitelist<a href="#applocker-application-whitelist" class="hash-link" aria-label="Direct link to AppLocker: Application Whitelist" title="Direct link to AppLocker: Application Whitelist">​</a></h3>
<p>An application whitelist is a list of approved software applications or executables allowed to be present and run on a system.</p>
<p>Applocker is the Windows whitelist mechanism. AppLocker gives system administrators control over which applications and files users can run. It gives granular control over executables, scripts, Windows installer files, DLLs, packaged apps, and packed app installers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-group-policy">Local Group Policy<a href="#local-group-policy" class="hash-link" aria-label="Direct link to Local Group Policy" title="Direct link to Local Group Policy">​</a></h3>
<p>Group Policy allows administrators to set, configure, and adjust a variety of settings. In a domain environment, group policies are pushed down from a Domain Controller onto all domain-joined machines that Group Policy objects (GPOs) are linked to. These settings can also be defined on individual machines using Local Group Policy.</p>
<p>Local Group Policy can be used to tweak certain graphical and network settings that are otherwise not accessible via the Control Panel. It can also be used to lock down an individual computer policy with stringent security settings, such as only allowing certain programs to be installed/run or enforcing strict user account password requirements.</p>
<p>The editor can be opened with <code>gpedit.msc</code> command.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-defender-antivirus">Windows Defender Antivirus<a href="#windows-defender-antivirus" class="hash-link" aria-label="Direct link to Windows Defender Antivirus" title="Direct link to Windows Defender Antivirus">​</a></h3>
<p>Modern windows comes with Windows Defender Antivirus enabled by default.</p>
<p>We can use the PowerShell cmdlet <code>Get-MpComputerStatus</code> to check which protection settings are enabled:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Get-MpComputerStatus | findstr &quot;True&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMServiceEnabled                : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AntispywareEnabled              : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AntivirusEnabled                : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BehaviorMonitorEnabled          : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IoavProtectionEnabled           : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IsTamperProtected               : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NISEnabled                      : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OnAccessProtectionEnabled       : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RealTimeProtectionEnabled       : True</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Hacking/HTB Academy/Web fuzzing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Web fuzzing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Hacking/HTB Academy/ffuf"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fuzzing with ffuf</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#os-structure" class="table-of-contents__link toc-highlight">OS Structure</a></li><li><a href="#file-system" class="table-of-contents__link toc-highlight">File system</a><ul><li><a href="#fat32" class="table-of-contents__link toc-highlight">FAT32</a></li><li><a href="#ntfs" class="table-of-contents__link toc-highlight">NTFS</a></li></ul></li><li><a href="#sharing" class="table-of-contents__link toc-highlight">Sharing</a></li><li><a href="#windows-services-and-processes" class="table-of-contents__link toc-highlight">Windows Services and processes</a><ul><li><a href="#processes" class="table-of-contents__link toc-highlight">Processes</a></li></ul></li><li><a href="#service-permissions" class="table-of-contents__link toc-highlight">Service permissions</a></li><li><a href="#windows-sessions" class="table-of-contents__link toc-highlight">Windows Sessions</a></li><li><a href="#interacting-with-windows" class="table-of-contents__link toc-highlight">Interacting with Windows</a></li><li><a href="#windows-management-instrumentation-wmi" class="table-of-contents__link toc-highlight">Windows Management Instrumentation (WMI)</a></li><li><a href="#microsoft-management-console-mmc" class="table-of-contents__link toc-highlight">Microsoft Management Console (MMC)</a></li><li><a href="#windows-subsystem-for-linux-wsl" class="table-of-contents__link toc-highlight">Windows Subsystem for Linux (WSL)</a></li><li><a href="#windows-security" class="table-of-contents__link toc-highlight">Windows security</a><ul><li><a href="#security-identifier-sid" class="table-of-contents__link toc-highlight">Security Identifier (SID)</a></li><li><a href="#security-accounts-manager-sam-and-access-control-entries-ace" class="table-of-contents__link toc-highlight">Security Accounts Manager (SAM) and Access Control Entries (ACE)</a></li><li><a href="#user-account-control-uac" class="table-of-contents__link toc-highlight">User Account Control (UAC)</a></li><li><a href="#registry" class="table-of-contents__link toc-highlight">Registry</a></li><li><a href="#applocker-application-whitelist" class="table-of-contents__link toc-highlight">AppLocker: Application Whitelist</a></li><li><a href="#local-group-policy" class="table-of-contents__link toc-highlight">Local Group Policy</a></li><li><a href="#windows-defender-antivirus" class="table-of-contents__link toc-highlight">Windows Defender Antivirus</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>